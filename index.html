<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ALTECH AI Assistant</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#007bff">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* --- MODERN THEME VARIABLES --- */
        :root {
            --primary: #007bff;
            --primary-dark: #0056b3;
            --primary-light: rgba(0, 123, 255, 0.1);
            --secondary: #6c757d;
            --success: #28a745;
            --warning: #ffc107;
            --danger: #dc3545;
            --info: #17a2b8;
            --light: #f8f9fa;
            --dark: #343a40;
            --surface: #ffffff;
            --background: #f4f7f9;
            --text: #2c3e50;
            --text-secondary: #6c757d;
            --shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            --shadow-lg: 0 8px 30px rgba(0, 0, 0, 0.12);
            --radius: 16px;
            --radius-sm: 8px;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        body.dark-mode {
            --primary: #6200ea;
            --primary-dark: #3700b3;
            --primary-light: rgba(98, 0, 234, 0.1);
            --secondary: #9e9e9e;
            --surface: #1e1e1e;
            --background: #121212;
            --text: #e0e0e0;
            --text-secondary: #b0b0b0;
            --shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            --shadow-lg: 0 8px 30px rgba(0, 0, 0, 0.4);
        }

        /* --- BASE STYLES --- */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Segoe UI', Oxygen, Ubuntu, sans-serif;
            background: var(--background);
            color: var(--text);
            line-height: 1.6;
            height: 100vh;
            overflow: hidden;
            transition: var(--transition);
        }

        /* --- APP CONTAINER --- */
        .app-container {
            display: flex;
            flex-direction: column;
            height: 100vh;
            max-width: 1200px;
            margin: 0 auto;
            position: relative;
        }

        /* --- HEADER --- */
        .header {
            padding: 20px;
            background: var(--surface);
            box-shadow: var(--shadow);
            border-bottom: 1px solid rgba(0,0,0,0.05);
            position: relative;
            z-index: 100;
        }

        .header-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 20px;
        }

        .app-title {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary);
        }

        .app-title i {
            font-size: 1.8rem;
        }

        .header-controls {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .theme-toggle, .ai-toggle {
            background: var(--primary);
            color: white;
            border: none;
            width: 44px;
            height: 44px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }

        .theme-toggle:hover, .ai-toggle:hover {
            background: var(--primary-dark);
            transform: scale(1.05);
        }

        .ai-toggle.active {
            background: var(--success);
            box-shadow: 0 0 20px rgba(40, 167, 69, 0.3);
        }

        /* --- MAIN CONTENT AREA --- */
        .main-content {
            display: flex;
            flex: 1;
            overflow: hidden;
            gap: 20px;
            padding: 20px;
        }

        /* --- SIDEBAR --- */
        .sidebar {
            width: 280px;
            background: var(--surface);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 20px;
            overflow-y: auto;
        }

        @media (max-width: 768px) {
            .sidebar {
                display: none;
            }
        }

        /* --- VOICE INTERFACE --- */
        .voice-section {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            background: linear-gradient(135deg, var(--background) 0%, var(--primary-light) 100%);
            border-radius: var(--radius);
            position: relative;
            overflow: hidden;
        }

        .voice-section::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, var(--primary-light) 0%, transparent 70%);
            opacity: 0.3;
        }

        .voice-orb {
            width: 140px;
            height: 140px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 20px 40px rgba(0, 123, 255, 0.3);
            transition: var(--transition);
            margin-bottom: 30px;
            position: relative;
            z-index: 1;
            border: 4px solid rgba(255, 255, 255, 0.2);
        }

        .voice-orb::before {
            content: '';
            position: absolute;
            top: -10px;
            left: -10px;
            right: -10px;
            bottom: -10px;
            background: conic-gradient(transparent, var(--primary), transparent 30%);
            animation: rotate 4s linear infinite;
            border-radius: 50%;
            z-index: -1;
        }

        @keyframes rotate {
            100% { transform: rotate(360deg); }
        }

        .voice-orb.listening {
            animation: pulse 1.5s infinite alternate;
            box-shadow: 0 0 60px rgba(0, 123, 255, 0.6);
        }

        @keyframes pulse {
            0% { transform: scale(1); box-shadow: 0 20px 40px rgba(0, 123, 255, 0.3); }
            100% { transform: scale(1.08); box-shadow: 0 30px 60px rgba(0, 123, 255, 0.5); }
        }

        .voice-orb i {
            font-size: 3rem;
            color: white;
        }

        .voice-status {
            text-align: center;
            margin-bottom: 30px;
            position: relative;
            z-index: 1;
        }

        #status {
            font-size: 1rem;
            color: var(--secondary);
            margin-bottom: 8px;
            font-weight: 500;
        }

        #transcript {
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--text);
            min-height: 40px;
            padding: 15px 25px;
            background: var(--surface);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            margin: 15px auto;
            max-width: 700px;
            width: 100%;
            border-left: 4px solid var(--primary);
        }

        /* --- AI RESPONSE AREA --- */
        .ai-response {
            background: var(--surface);
            padding: 25px;
            border-radius: var(--radius);
            box-shadow: var(--shadow-lg);
            margin: 20px auto;
            max-width: 700px;
            width: 100%;
            border-left: 4px solid var(--primary);
            position: relative;
            z-index: 1;
        }

        .ai-response h3 {
            display: flex;
            align-items: center;
            gap: 10px;
            color: var(--primary);
            margin-bottom: 15px;
            font-size: 1.2rem;
        }

        #aiOutput {
            font-size: 1.1rem;
            line-height: 1.7;
            min-height: 80px;
            display: flex;
            align-items: center;
        }

        /* --- QUICK ACTIONS --- */
        .quick-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin: 20px auto;
            max-width: 700px;
            width: 100%;
        }

        .action-btn {
            background: var(--surface);
            border: 2px solid var(--primary);
            border-radius: 12px;
            padding: 15px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            transition: var(--transition);
            color: var(--text);
        }

        .action-btn:hover {
            background: var(--primary);
            color: white;
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(0, 123, 255, 0.2);
        }

        .action-btn i {
            font-size: 1.5rem;
        }

        .action-btn span {
            font-size: 0.9rem;
            font-weight: 500;
            text-align: center;
        }

        /* --- TABS --- */
        .tabs-nav {
            display: flex;
            background: var(--surface);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            overflow: hidden;
            margin-bottom: 20px;
        }

        .tab-btn {
            flex: 1;
            padding: 18px;
            background: none;
            border: none;
            color: var(--secondary);
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            border-bottom: 3px solid transparent;
        }

        .tab-btn.active {
            color: var(--primary);
            background: var(--primary-light);
            border-bottom-color: var(--primary);
        }

        /* --- TAB CONTENT --- */
        .tab-content {
            flex: 1;
            overflow-y: auto;
            padding-right: 10px;
        }

        .tab-pane {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .tab-pane.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* --- CARDS --- */
        .card {
            background: var(--surface);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            padding: 25px;
            margin-bottom: 20px;
            transition: var(--transition);
            border: 1px solid rgba(0,0,0,0.05);
        }

        .card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .card h2 {
            color: var(--primary);
            margin-bottom: 20px;
            font-size: 1.4rem;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        /* --- CONTACTS LIST --- */
        .contacts-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .contact-item {
            display: flex;
            align-items: center;
            padding: 15px;
            background: var(--primary-light);
            border-radius: var(--radius-sm);
            transition: var(--transition);
            cursor: pointer;
        }

        .contact-item:hover {
            background: var(--primary);
            color: white;
        }

        .contact-avatar {
            width: 50px;
            height: 50px;
            background: var(--primary);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.2rem;
            margin-right: 15px;
        }

        .contact-info {
            flex: 1;
        }

        .contact-name {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .contact-phone {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        /* --- REMINDERS --- */
        .reminders-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .reminder-item {
            background: var(--primary-light);
            border-radius: var(--radius-sm);
            padding: 15px;
            border-left: 4px solid var(--warning);
        }

        .reminder-item.due {
            border-left-color: var(--danger);
            background: rgba(220, 53, 69, 0.1);
        }

        .reminder-text {
            font-weight: 500;
            margin-bottom: 8px;
        }

        .reminder-time {
            font-size: 0.9rem;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: 5px;
        }

        /* --- NOTES --- */
        .notes-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .note-item {
            background: var(--primary-light);
            border-radius: var(--radius-sm);
            padding: 15px;
            position: relative;
        }

        .note-content {
            margin-bottom: 10px;
        }

        .note-time {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        /* --- AI PROVIDER SELECTOR --- */
        .ai-provider-selector {
            background: var(--surface);
            border-radius: var(--radius-sm);
            padding: 15px;
            margin-bottom: 20px;
        }

        .provider-select {
            width: 100%;
            padding: 12px;
            border-radius: var(--radius-sm);
            border: 2px solid var(--primary);
            background: var(--background);
            color: var(--text);
            font-size: 1rem;
            margin-top: 10px;
        }

        /* --- COMMAND SUGGESTIONS --- */
        .command-suggestions {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 20px;
        }

        .command-chip {
            background: var(--primary-light);
            color: var(--primary);
            padding: 10px 18px;
            border-radius: 50px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: var(--transition);
            border: 1px solid var(--primary);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .command-chip:hover {
            background: var(--primary);
            color: white;
            transform: translateY(-2px);
        }

        /* --- WHATSAPP FLOATING BUTTON --- */
        .whatsapp-float {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            background: #25D366;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 10px 25px rgba(37, 211, 102, 0.3);
            cursor: pointer;
            z-index: 1000;
            transition: all 0.3s ease;
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .whatsapp-float:hover {
            background: #128C7E;
            transform: scale(1.1);
            box-shadow: 0 15px 30px rgba(37, 211, 102, 0.4);
        }

        .whatsapp-float i {
            font-size: 1.8rem;
        }

        .whatsapp-modal {
            position: fixed;
            bottom: 100px;
            right: 30px;
            background: var(--surface);
            border-radius: var(--radius);
            box-shadow: var(--shadow-lg);
            padding: 25px;
            width: 320px;
            z-index: 1001;
            display: none;
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* --- LOADING ANIMATIONS --- */
        .loading {
            display: inline-block;
            width: 24px;
            height: 24px;
            border: 3px solid rgba(0,123,255,0.2);
            border-radius: 50%;
            border-top-color: var(--primary);
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .typing-indicator {
            display: inline-flex;
            gap: 4px;
            align-items: center;
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            background: var(--primary);
            border-radius: 50%;
            animation: typing 1.4s ease-in-out infinite;
        }

        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }

        @keyframes typing {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        /* --- RESPONSIVE DESIGN --- */
        @media (max-width: 1024px) {
            .main-content {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
            }
        }

        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                text-align: center;
            }
            
            .voice-orb {
                width: 120px;
                height: 120px;
            }
            
            .quick-actions {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .whatsapp-float {
                bottom: 20px;
                right: 20px;
                width: 55px;
                height: 55px;
            }
            
            .whatsapp-modal {
                bottom: 90px;
                right: 20px;
                width: 280px;
            }
        }

        @media (max-width: 480px) {
            .tab-btn {
                padding: 15px 10px;
                font-size: 0.85rem;
            }
            
            .voice-orb {
                width: 100px;
                height: 100px;
            }
            
            .voice-orb i {
                font-size: 2.5rem;
            }
            
            .quick-actions {
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
            }
        }

        /* --- UTILITY CLASSES --- */
        .hidden {
            display: none !important;
        }

        .text-center {
            text-align: center;
        }

        .mt-20 {
            margin-top: 20px;
        }

        .mb-20 {
            margin-bottom: 20px;
        }

        .pulse-success {
            animation: pulseSuccess 2s infinite;
        }

        @keyframes pulseSuccess {
            0%, 100% { box-shadow: 0 0 0 0 rgba(40, 167, 69, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(40, 167, 69, 0); }
            100% { box-shadow: 0 0 0 0 rgba(40, 167, 69, 0); }
        }
    </style>
</head>
<body class="dark-mode">
    <!-- WhatsApp Floating Button -->
    <div class="whatsapp-float" onclick="toggleWhatsAppModal()">
        <i class="fab fa-whatsapp"></i>
    </div>
    
    <div class="whatsapp-modal" id="whatsappModal">
        <h3><i class="fab fa-whatsapp"></i> Get Help</h3>
        <p style="margin: 15px 0; color: var(--text-secondary);">Need assistance with the AI Assistant?</p>
        <button class="action-btn" onclick="openWhatsApp('help')" style="width: 100%; margin: 10px 0;">
            <i class="fas fa-question-circle"></i> Technical Support
        </button>
        <button class="action-btn" onclick="openWhatsApp('feedback')" style="width: 100%; margin: 10px 0;">
            <i class="fas fa-comment-alt"></i> Send Feedback
        </button>
        <button class="action-btn" onclick="openWhatsApp('feature')" style="width: 100%; margin: 10px 0;">
            <i class="fas fa-lightbulb"></i> Request Feature
        </button>
        <button class="action-btn" onclick="openWhatsApp('demo')" style="width: 100%; margin: 10px 0; background: var(--success);">
            <i class="fas fa-phone-alt"></i> Schedule Demo Call
        </button>
        <button class="action-btn" onclick="toggleWhatsAppModal()" 
                style="width: 100%; margin-top: 15px; background: var(--secondary);">
            <i class="fas fa-times"></i> Close
        </button>
    </div>

    <div class="app-container">
        <!-- HEADER -->
        <div class="header">
            <div class="header-content">
                <div class="app-title">
                    <i class="fas fa-robot"></i>
                    <span>ALTECH AI Assistant</span>
                </div>
                
                <div class="header-controls">
                    <button class="ai-toggle active" id="aiToggleBtn" onclick="toggleAIMode()">
                        <i class="fas fa-brain"></i>
                    </button>
                    <button class="theme-toggle" onclick="toggleTheme()">
                        <i class="fas fa-moon"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- MAIN CONTENT -->
        <div class="main-content">
            <!-- SIDEBAR -->
            <div class="sidebar">
                <div class="ai-provider-selector">
                    <h3><i class="fas fa-cogs"></i> AI Settings</h3>
                    <select id="aiProvider" class="provider-select" onchange="changeAIProvider(this.value)">
                        <option value="smart">ðŸ¤– Smart Mode</option>
                        <option value="chatgpt">ðŸ’¬ ChatGPT</option>
                        <option value="llama">ðŸ¦™ Llama 2</option>
                        <option value="gemini">ðŸ”· Gemini</option>
                        <option value="local">ðŸ’¡ Local Only</option>
                    </select>
                    <div id="aiStatus" style="margin-top: 10px; font-size: 0.9rem; color: var(--success);">
                        <i class="fas fa-check-circle"></i> AI Ready
                    </div>
                </div>

                <div class="card">
                    <h2><i class="fas fa-history"></i> Recent Commands</h2>
                    <div id="commandHistory">
                        <p style="color: var(--text-secondary); text-align: center; padding: 10px;">
                            No commands yet
                        </p>
                    </div>
                </div>

                <div class="card">
                    <h2><i class="fas fa-bolt"></i> Quick Stats</h2>
                    <div style="display: flex; flex-direction: column; gap: 10px; margin-top: 15px;">
                        <div style="display: flex; justify-content: space-between;">
                            <span>Contacts:</span>
                            <span id="contactCount">0</span>
                        </div>
                        <div style="display: flex; justify-content: space-between;">
                            <span>Reminders:</span>
                            <span id="reminderCount">0</span>
                        </div>
                        <div style="display: flex; justify-content: space-between;">
                            <span>Notes:</span>
                            <span id="noteCount">0</span>
                        </div>
                        <div style="display: flex; justify-content: space-between;">
                            <span>AI Responses:</span>
                            <span id="aiResponseCount">0</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- MAIN AREA -->
            <div style="flex: 1; display: flex; flex-direction: column; overflow: hidden;">
                <!-- TABS -->
                <div class="tabs-nav">
                    <button class="tab-btn active" onclick="openTab('assistant')">
                        <i class="fas fa-robot"></i> Assistant
                    </button>
                    <button class="tab-btn" onclick="openTab('contacts')">
                        <i class="fas fa-address-book"></i> Contacts
                    </button>
                    <button class="tab-btn" onclick="openTab('reminders')">
                        <i class="fas fa-bell"></i> Reminders
                    </button>
                    <button class="tab-btn" onclick="openTab('notes')">
                        <i class="fas fa-sticky-note"></i> Notes
                    </button>
                    <button class="tab-btn" onclick="openTab('settings')">
                        <i class="fas fa-cog"></i> Settings
                    </button>
                </div>

                <!-- TAB CONTENT -->
                <div class="tab-content">
                    <!-- ASSISTANT TAB -->
                    <div id="assistant" class="tab-pane active">
                        <div class="voice-section">
                            <div class="voice-orb" onclick="toggleListening()">
                                <i class="fas fa-microphone"></i>
                            </div>
                            
                            <div class="voice-status">
                                <div id="status">Ready to listen</div>
                                <div id="transcript">Tap the orb and speak a command...</div>
                            </div>

                            <div class="ai-response">
                                <h3><i class="fas fa-brain"></i> AI Assistant</h3>
                                <div id="aiOutput">
                                    <div class="typing-indicator">
                                        <div class="typing-dot"></div>
                                        <div class="typing-dot"></div>
                                        <div class="typing-dot"></div>
                                    </div>
                                    Loading AI Assistant...
                                </div>
                            </div>

                            <!-- Quick Actions -->
                            <div class="quick-actions">
                                <button class="action-btn" onclick="quickAction('call_last')">
                                    <i class="fas fa-phone"></i>
                                    <span>Call Last</span>
                                </button>
                                <button class="action-btn" onclick="quickAction('add_note')">
                                    <i class="fas fa-sticky-note"></i>
                                    <span>Quick Note</span>
                                </button>
                                <button class="action-btn" onclick="quickAction('weather')">
                                    <i class="fas fa-cloud-sun"></i>
                                    <span>Weather</span>
                                </button>
                                <button class="action-btn" onclick="quickAction('search')">
                                    <i class="fas fa-search"></i>
                                    <span>Web Search</span>
                                </button>
                                <button class="action-btn" onclick="quickAction('joke')">
                                    <i class="fas fa-laugh"></i>
                                    <span>Tell Joke</span>
                                </button>
                                <button class="action-btn" onclick="quickAction('time')">
                                    <i class="fas fa-clock"></i>
                                    <span>What Time?</span>
                                </button>
                            </div>

                            <!-- Command Suggestions -->
                            <div class="command-suggestions">
                                <div class="command-chip" onclick="speakCommand('Add note meeting at 3 PM')">
                                    <i class="fas fa-edit"></i> Add Note
                                </div>
                                <div class="command-chip" onclick="speakCommand('Remind me to call mom tomorrow')">
                                    <i class="fas fa-bell"></i> Set Reminder
                                </div>
                                <div class="command-chip" onclick="speakCommand('Search for latest news')">
                                    <i class="fas fa-search"></i> Search Web
                                </div>
                                <div class="command-chip" onclick="speakCommand('What time is it')">
                                    <i class="fas fa-clock"></i> Current Time
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- CONTACTS TAB -->
                    <div id="contacts" class="tab-pane">
                        <div class="card">
                            <h2><i class="fas fa-users"></i> Contact Management</h2>
                            <p style="color: var(--text-secondary); margin-bottom: 20px;">
                                Add your contacts manually or sync from device. All data is stored locally for privacy.
                            </p>
                            <div style="display: flex; gap: 15px; margin-bottom: 20px;">
                                <button class="action-btn" onclick="trySyncContacts()" style="flex: 1;">
                                    <i class="fas fa-sync"></i> Sync Contacts
                                </button>
                                <button class="action-btn" onclick="showAddContactModal()" style="flex: 1;">
                                    <i class="fas fa-plus"></i> Add Contact
                                </button>
                            </div>
                            
                            <div id="contactsList" class="contacts-list">
                                <p style="color: var(--text-secondary); text-align: center; padding: 40px;">
                                    No contacts yet. Add your first contact!
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- REMINDERS TAB -->
                    <div id="reminders" class="tab-pane">
                        <div class="card">
                            <h2><i class="fas fa-clock"></i> Active Reminders</h2>
                            <button class="action-btn" onclick="showAddReminderModal()" style="margin-bottom: 20px;">
                                <i class="fas fa-plus"></i> Add New Reminder
                            </button>
                            
                            <div id="remindersList" class="reminders-list">
                                <p style="color: var(--text-secondary); text-align: center; padding: 40px;">
                                    No reminders scheduled
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- NOTES TAB -->
                    <div id="notes" class="tab-pane">
                        <div class="card">
                            <h2><i class="fas fa-edit"></i> Quick Notes</h2>
                            <textarea id="quickNotes" rows="10" placeholder="Type your notes here or use voice commands... Your notes are automatically saved locally."></textarea>
                            <div style="display: flex; gap: 15px; margin-top: 20px;">
                                <button class="action-btn" onclick="saveNotes()">
                                    <i class="fas fa-save"></i> Save Notes
                                </button>
                                <button class="action-btn" onclick="clearNotes()" style="background: var(--danger);">
                                    <i class="fas fa-trash"></i> Clear All
                                </button>
                            </div>
                        </div>

                        <div class="card">
                            <h2><i class="fas fa-history"></i> Recent Notes</h2>
                            <div id="notesHistory" class="notes-container">
                                <p style="color: var(--text-secondary); text-align: center; padding: 40px;">
                                    No recent notes
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- SETTINGS TAB -->
                    <div id="settings" class="tab-pane">
                        <div class="card">
                            <h2><i class="fas fa-user-cog"></i> Preferences</h2>
                            <div style="margin-top: 20px;">
                                <div style="margin-bottom: 15px;">
                                    <label style="display: block; margin-bottom: 8px;">Voice Speed</label>
                                    <input type="range" id="voiceSpeed" min="0.5" max="2" step="0.1" value="1" 
                                           oninput="updateVoiceSpeed(this.value)" style="width: 100%;">
                                    <div style="display: flex; justify-content: space-between; margin-top: 5px;">
                                        <span>Slow</span>
                                        <span id="speedValue">Normal</span>
                                        <span>Fast</span>
                                    </div>
                                </div>
                                
                                <div style="margin-bottom: 15px;">
                                    <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                                        <input type="checkbox" id="autoSave" checked>
                                        Auto-save notes
                                    </label>
                                </div>
                                
                                <div style="margin-bottom: 15px;">
                                    <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                                        <input type="checkbox" id="enableNotifications" checked>
                                        Enable notifications
                                    </label>
                                </div>
                                
                                <button class="action-btn" onclick="exportData()" style="width: 100%; margin-top: 10px;">
                                    <i class="fas fa-download"></i> Export All Data
                                </button>
                                
                                <button class="action-btn" onclick="clearAllData()" style="width: 100%; margin-top: 10px; background: var(--danger);">
                                    <i class="fas fa-trash-alt"></i> Clear All Data
                                </button>
                            </div>
                        </div>

                        <div class="card">
                            <h2><i class="fas fa-info-circle"></i> About</h2>
                            <p style="margin-top: 15px;"><strong>ALTECH AI Assistant v2.0</strong></p>
                            <p>Powered by advanced AI with voice recognition</p>
                            <div style="margin-top: 15px; padding: 15px; background: var(--primary-light); border-radius: var(--radius-sm);">
                                <p style="font-size: 0.9rem; color: var(--text-secondary);">
                                    <i class="fas fa-shield-alt"></i> <strong>Privacy First:</strong> All data is stored locally on your device. No data is sent to external servers unless you use AI features.
                                </p>
                            </div>
                            <p style="margin-top: 15px; font-size: 0.9rem; color: var(--text-secondary);">
                                <i class="fas fa-code"></i> Built with modern web technologies
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- MODALS -->
    <div id="addContactModal" class="whatsapp-modal" style="width: 400px;">
        <h3><i class="fas fa-user-plus"></i> Add Contact</h3>
        <input type="text" id="newContactName" placeholder="Contact Name" style="width: 100%; margin: 15px 0;">
        <input type="tel" id="newContactPhone" placeholder="Phone Number (e.g., 0712345678)" style="width: 100%; margin-bottom: 20px;">
        <div style="display: flex; gap: 15px;">
            <button class="action-btn" onclick="addNewContact()" style="flex: 1;">
                <i class="fas fa-save"></i> Save
            </button>
            <button class="action-btn" onclick="closeModal('addContactModal')" style="flex: 1; background: var(--secondary);">
                <i class="fas fa-times"></i> Cancel
            </button>
        </div>
    </div>

    <div id="addReminderModal" class="whatsapp-modal" style="width: 400px;">
        <h3><i class="fas fa-bell"></i> Add Reminder</h3>
        <input type="text" id="newReminderText" placeholder="What to remind?" style="width: 100%; margin: 15px 0;">
        <input type="datetime-local" id="newReminderTime" style="width: 100%; margin-bottom: 20px;">
        <div style="display: flex; gap: 15px;">
            <button class="action-btn" onclick="addNewReminder()" style="flex: 1;">
                <i class="fas fa-save"></i> Save
            </button>
            <button class="action-btn" onclick="closeModal('addReminderModal')" style="flex: 1; background: var(--secondary);">
                <i class="fas fa-times"></i> Cancel
            </button>
        </div>
    </div>

    <script>
        // ================ CORE VARIABLES ================
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        const recognition = new SpeechRecognition();
        recognition.lang = 'en-US';
        recognition.interimResults = false;
        recognition.continuous = false;

        // DOM Elements
        const voiceOrb = document.querySelector('.voice-orb');
        const statusEl = document.getElementById('status');
        const transcriptEl = document.getElementById('transcript');
        const aiOutputEl = document.getElementById('aiOutput');
        const quickNotesEl = document.getElementById('quickNotes');
        const aiToggleBtn = document.getElementById('aiToggleBtn');
        const aiProviderSelect = document.getElementById('aiProvider');
        const aiStatusEl = document.getElementById('aiStatus');

        // Data Storage
        let myContacts = JSON.parse(localStorage.getItem('altech_contacts') || '[]');
        let reminders = JSON.parse(localStorage.getItem('altech_reminders') || '[]');
        let conversationHistory = JSON.parse(localStorage.getItem('altech_history') || '[]');
        let notesHistory = JSON.parse(localStorage.getItem('altech_notes_history') || '[]');
        let isListening = false;
        let aiEnabled = true;
        let currentAIProvider = 'smart';
        let voiceSpeed = parseFloat(localStorage.getItem('voiceSpeed') || '1');
        let aiResponseCount = parseInt(localStorage.getItem('aiResponseCount') || '0');

        // Conversation Context
        let conversationContext = {
            lastTopic: '',
            lastContact: null,
            lastAction: '',
            userPreferences: JSON.parse(localStorage.getItem('user_prefs') || '{}')
        };

        // ================ INITIALIZATION ================
        document.addEventListener('DOMContentLoaded', () => {
            initApp();
        });

        async function initApp() {
            loadTheme();
            loadNotes();
            loadStats();
            renderContacts();
            renderReminders();
            renderNotesHistory();
            renderCommandHistory();
            setupVoiceRecognition();
            updateVoiceSpeed(voiceSpeed);
            checkAndSetReminderInterval();
            
            // Setup notes auto-save
            const autoSave = document.getElementById('autoSave');
            if (autoSave) {
                autoSave.checked = localStorage.getItem('autoSave') !== 'false';
                autoSave.addEventListener('change', () => {
                    localStorage.setItem('autoSave', autoSave.checked);
                });
            }
            
            quickNotesEl.addEventListener('input', () => {
                if (document.getElementById('autoSave')?.checked) {
                    saveNotes();
                }
            });
            
            // Enable notifications if checked
            const enableNotifications = document.getElementById('enableNotifications');
            if (enableNotifications) {
                enableNotifications.checked = localStorage.getItem('enableNotifications') !== 'false';
                enableNotifications.addEventListener('change', () => {
                    localStorage.setItem('enableNotifications', enableNotifications.checked);
                    if (enableNotifications.checked) {
                        requestNotificationPermission();
                    }
                });
            }
            
            // Initial greeting
            setTimeout(() => {
                speakResponse("ALTECH AI Assistant is ready. Your privacy is protected.");
                updateAIResponse("Hello! I'm your ALTECH AI Assistant. All your data is stored locally. Try adding contacts or saying 'Add note meeting today'");
            }, 1000);
        }

        // ================ THEME MANAGEMENT ================
        function loadTheme() {
            const savedTheme = localStorage.getItem('theme') || 'dark-mode';
            document.body.className = savedTheme;
            updateThemeIcon(savedTheme);
        }

        function toggleTheme() {
            const currentTheme = document.body.className;
            const newTheme = currentTheme === 'dark-mode' ? 'light-mode' : 'dark-mode';
            document.body.className = newTheme;
            localStorage.setItem('theme', newTheme);
            updateThemeIcon(newTheme);
        }

        function updateThemeIcon(theme) {
            const icon = document.querySelector('.theme-toggle i');
            icon.className = theme === 'dark-mode' ? 'fas fa-moon' : 'fas fa-sun';
        }

        // ================ VOICE RECOGNITION ================
        function setupVoiceRecognition() {
            recognition.onstart = () => {
                isListening = true;
                voiceOrb.classList.add('listening');
                statusEl.textContent = 'Listening...';
                updateAIResponse('<div class="typing-indicator"><div class="typing-dot"></div><div class="typing-dot"></div><div class="typing-dot"></div></div> Listening...');
            };

            recognition.onend = () => {
                isListening = false;
                voiceOrb.classList.remove('listening');
                statusEl.textContent = 'Processing...';
                setTimeout(() => statusEl.textContent = 'Ready to listen', 2000);
            };

            recognition.onresult = async (event) => {
                const command = event.results[0][0].transcript;
                transcriptEl.textContent = `"${command}"`;
                await handleCommand(command);
            };

            recognition.onerror = (event) => {
                console.error('Speech recognition error:', event.error);
                updateAIResponse('Error: ' + event.error);
                voiceOrb.classList.remove('listening');
                isListening = false;
            };
        }

        function toggleListening() {
            if (isListening) {
                recognition.stop();
                voiceOrb.classList.remove('listening');
                statusEl.textContent = 'Stopped listening';
                isListening = false;
            } else {
                try {
                    recognition.start();
                } catch (error) {
                    console.error('Speech recognition error:', error);
                    updateAIResponse('Speech recognition not available. Please try again.');
                }
            }
        }

        // ================ AI INTEGRATION ================
        async function getAIResponse(userMessage) {
            if (!aiEnabled) {
                return "AI is disabled. Enable it to get intelligent responses.";
            }

            aiResponseCount++;
            localStorage.setItem('aiResponseCount', aiResponseCount.toString());
            updateStats();

            try {
                let response;
                
                switch(currentAIProvider) {
                    case 'smart':
                        // Smart mode tries multiple free APIs
                        response = await smartAIResponse(userMessage);
                        break;
                    case 'chatgpt':
                        response = await chatGPTResponse(userMessage);
                        break;
                    case 'llama':
                        response = await llamaResponse(userMessage);
                        break;
                    case 'gemini':
                        response = await geminiResponse(userMessage);
                        break;
                    default:
                        response = await localAIResponse(userMessage);
                }
                
                return response || "I'm having trouble connecting to the AI. Please try again.";
            } catch (error) {
                console.error('AI Error:', error);
                return await localAIResponse(userMessage);
            }
        }

        // Smart AI - tries multiple free endpoints
        async function smartAIResponse(prompt) {
            const endpoints = [
                { name: 'ChatGPT', func: chatGPTResponse },
                { name: 'Llama', func: llamaResponse },
                { name: 'Gemini', func: geminiResponse }
            ];
            
            for (const endpoint of endpoints) {
                try {
                    const response = await endpoint.func(prompt);
                    if (response && response.length > 10) {
                        console.log(`Using ${endpoint.name} response`);
                        return response;
                    }
                } catch (error) {
                    continue;
                }
            }
            
            return localAIResponse(prompt);
        }

        // Free ChatGPT API (No key needed)
        async function chatGPTResponse(prompt) {
            try {
                // Using a free reverse proxy
                const response = await fetch('https://chatgpt-api.shn.hk/v1/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        model: "gpt-3.5-turbo",
                        messages: [{ role: "user", content: prompt }],
                        max_tokens: 150
                    })
                });
                
                if (response.ok) {
                    const data = await response.json();
                    return data.choices[0].message.content;
                }
            } catch (error) {
                console.log('ChatGPT failed, trying backup...');
            }
            
            // Backup endpoint
            try {
                const response = await fetch('https://free.churchless.tech/v1/chat/completions', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        model: "gpt-3.5-turbo",
                        messages: [{ role: "user", content: prompt }],
                        stream: false
                    })
                });
                const data = await response.json();
                return data.choices?.[0]?.message?.content;
            } catch {
                return null;
            }
        }

        // Llama 2 Free API
        async function llamaResponse(prompt) {
            try {
                // Using free Llama API endpoint
                const response = await fetch('https://api.llama-api.com/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Authorization': 'Bearer LL-4Y0hrXyX4Haxakg7LQz3QQTMoCQR7cFKh1DO7uAfxt2bifz5KEU8I2D65rqPpCoy',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        model: "llama-13b-chat",
                        messages: [{ role: "user", content: prompt }]
                    })
                });
                
                if (response.ok) {
                    const data = await response.json();
                    return data.choices[0].message.content;
                }
            } catch (error) {
                console.log('Llama API failed');
            }
            return null;
        }

        // Google Gemini Free API
        async function geminiResponse(prompt) {
            try {
                // Using free Gemini API
                const response = await fetch('https://gemini-proxy.vercel.app/api/generate', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        prompt: prompt,
                        model: "gemini-pro"
                    })
                });
                
                if (response.ok) {
                    const data = await response.json();
                    return data.text;
                }
            } catch (error) {
                console.log('Gemini failed');
            }
            return null;
        }

        // Local AI responses
        function localAIResponse(command) {
            const responses = {
                greeting: ["Hello! How can I assist you today?", "Hi there! Ready to help.", "Hey! What can I do for you?"],
                time: [`The current time is ${new Date().toLocaleTimeString()}`],
                date: [`Today is ${new Date().toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}`],
                weather: ["I can't check weather right now. Try saying 'search for weather in [your city]'."],
                joke: ["Why don't scientists trust atoms? Because they make up everything!", "What do you call a fake noodle? An impasta!"],
                help: ["I can help you with: Calling contacts, Setting reminders, Taking notes, Web search, Time and date, Weather information"],
                privacy: ["Your data is stored locally on your device. No personal information is shared with external servers."]
            };
            
            const lowerCmd = command.toLowerCase();
            
            if (lowerCmd.includes('hello') || lowerCmd.includes('hi') || lowerCmd.includes('hey')) {
                return responses.greeting[Math.floor(Math.random() * responses.greeting.length)];
            }
            if (lowerCmd.includes('time')) {
                return responses.time[0];
            }
            if (lowerCmd.includes('date')) {
                return responses.date[0];
            }
            if (lowerCmd.includes('weather')) {
                return responses.weather[0];
            }
            if (lowerCmd.includes('joke')) {
                return responses.joke[Math.floor(Math.random() * responses.joke.length)];
            }
            if (lowerCmd.includes('help') || lowerCmd.includes('what can you do')) {
                return responses.help[0];
            }
            if (lowerCmd.includes('privacy') || lowerCmd.includes('data')) {
                return responses.privacy[0];
            }
            
            return `I heard: "${command}". Try saying: "Call [Name]", "Add note [your note]", "Remind me [task]", or "Search [query]"`;
        }

        function changeAIProvider(provider) {
            currentAIProvider = provider;
            localStorage.setItem('aiProvider', provider);
            updateAIStatus();
            updateAIResponse(`Switched to ${provider} mode`);
        }

        function toggleAIMode() {
            aiEnabled = !aiEnabled;
            aiToggleBtn.classList.toggle('active', aiEnabled);
            aiToggleBtn.innerHTML = `<i class="fas fa-${aiEnabled ? 'brain' : 'ban'}"></i>`;
            localStorage.setItem('aiEnabled', aiEnabled);
            updateAIResponse(`AI ${aiEnabled ? 'enabled' : 'disabled'}`);
        }

        function updateAIStatus() {
            aiStatusEl.innerHTML = aiEnabled ? 
                `<i class="fas fa-check-circle"></i> ${currentAIProvider.toUpperCase()} Active` :
                `<i class="fas fa-times-circle"></i> AI Disabled`;
        }

        // ================ COMMAND HANDLER ================
        async function handleCommand(command) {
            updateAIResponse('<div class="loading"></div> Processing...');
            
            // Save to history
            addToHistory(command);
            
            // Check for specific commands first
            const specificResult = await handleSpecificCommand(command);
            if (specificResult) return;
            
            // If AI is enabled, use it for general queries
            if (aiEnabled) {
                const aiResponse = await getAIResponse(command);
                speakResponse(aiResponse);
                updateAIResponse(aiResponse);
            } else {
                const localResponse = localAIResponse(command);
                speakResponse(localResponse);
                updateAIResponse(localResponse);
            }
        }

        async function handleSpecificCommand(command) {
            const lowerCmd = command.toLowerCase();
            
            // Call contact
            if (lowerCmd.includes('call')) {
                const nameMatch = lowerCmd.match(/call\s+(\w+)/);
                if (nameMatch) {
                    const name = nameMatch[1];
                    const contact = findContact(name);
                    if (contact) {
                        speakResponse(`Calling ${contact.name}...`);
                        updateAIResponse(`ðŸ“ž Calling <strong>${contact.name}</strong> at ${contact.phone}`);
                        conversationContext.lastContact = contact;
                        
                        // ACTUAL CALL - Uncomment for real calls
                        // window.location.href = `tel:${contact.phone}`;
                        
                        // For demo purposes on desktop
                        if (!/Mobi|Android/i.test(navigator.userAgent)) {
                            updateAIResponse(`ðŸ“ž Would call: <strong>${contact.name}</strong> at ${contact.phone}<br><small><i>On mobile, this would initiate a real call.</i></small>`);
                        }
                        return true;
                    } else {
                        updateAIResponse(`Contact "${name}" not found. Add contacts in the Contacts tab.`);
                        return true;
                    }
                }
            }
            
            // WhatsApp to contact
            if (lowerCmd.includes('whatsapp') || lowerCmd.includes('send message')) {
                let contactName = '';
                
                if (lowerCmd.includes('whatsapp to')) {
                    contactName = command.split('whatsapp to')[1]?.trim();
                } else if (lowerCmd.includes('send whatsapp to')) {
                    contactName = command.split('send whatsapp to')[1]?.trim();
                } else if (lowerCmd.includes('whatsapp')) {
                    contactName = command.split('whatsapp')[1]?.trim();
                }
                
                if (contactName) {
                    const contact = findContact(contactName);
                    if (contact) {
                        // Clean phone number (remove spaces, non-digits)
                        const cleanPhone = contact.phone.replace(/\D/g, '');
                        
                        // Get message from command or use default
                        let message = "Hello from ALTECH AI Assistant!";
                        const messageMatch = lowerCmd.match(/saying (.+)$/);
                        if (messageMatch) {
                            message = messageMatch[1];
                        } else {
                            const userMessage = prompt(`What message to ${contactName}?`, "Hello!");
                            if (userMessage) message = userMessage;
                        }
                        
                        // Open WhatsApp
                        const encodedMessage = encodeURIComponent(message);
                        const whatsappUrl = `https://wa.me/${cleanPhone}?text=${encodedMessage}`;
                        window.open(whatsappUrl, '_blank');
                        
                        speakResponse(`Opening WhatsApp to ${contact.name}`);
                        updateAIResponse(`ðŸ’¬ Opening WhatsApp to <strong>${contact.name}</strong>`);
                        return true;
                    } else {
                        updateAIResponse(`Contact "${contactName}" not found.`);
                        return true;
                    }
                }
            }
            
            // Add note
            if (lowerCmd.includes('add note') || lowerCmd.includes('note that') || lowerCmd.includes('remember')) {
                let noteContent = '';
                
                if (lowerCmd.includes('saying')) {
                    noteContent = command.split('saying')[1]?.trim();
                } else if (lowerCmd.includes('that')) {
                    noteContent = command.split('that')[1]?.trim();
                } else if (lowerCmd.includes('note:')) {
                    noteContent = command.split('note:')[1]?.trim();
                } else {
                    noteContent = command.replace(/add note|note|remember/gi, '').trim();
                }
                
                if (noteContent) {
                    addNoteToHistory(noteContent);
                    speakResponse(`Note added: ${noteContent.substring(0, 50)}...`);
                    updateAIResponse(`ðŸ“ Note added: <strong>"${noteContent}"</strong>`);
                    return true;
                }
            }
            
            // Set reminder
            if (lowerCmd.includes('remind') || lowerCmd.includes('reminder')) {
                let task = '';
                let timeText = '';
                
                if (lowerCmd.includes('remind me to')) {
                    task = command.split('remind me to')[1]?.trim();
                } else if (lowerCmd.includes('reminder for')) {
                    task = command.split('reminder for')[1]?.trim();
                }
                
                if (task) {
                    // Simple time parsing
                    const time = new Date();
                    if (lowerCmd.includes('tomorrow')) {
                        time.setDate(time.getDate() + 1);
                    }
                    if (lowerCmd.includes('next week')) {
                        time.setDate(time.getDate() + 7);
                    }
                    if (lowerCmd.includes('in 1 hour') || lowerCmd.includes('in one hour')) {
                        time.setHours(time.getHours() + 1);
                    }
                    
                    addReminder(task, time.toISOString());
                    const timeStr = time.toLocaleString();
                    speakResponse(`Reminder set: ${task}`);
                    updateAIResponse(`â° Reminder set: <strong>${task}</strong><br><small>Due: ${timeStr}</small>`);
                    return true;
                }
            }
            
            // Search web
            if (lowerCmd.includes('search') || lowerCmd.includes('google')) {
                let query = '';
                if (lowerCmd.includes('search for')) {
                    query = command.split('search for')[1]?.trim();
                } else if (lowerCmd.includes('google')) {
                    query = command.split('google')[1]?.trim();
                }
                
                if (query) {
                    speakResponse(`Searching for ${query}...`);
                    updateAIResponse(`ðŸ” Searching: <strong>${query}</strong>`);
                    window.open(`https://www.google.com/search?q=${encodeURIComponent(query)}`, '_blank');
                    return true;
                }
            }
            
            // Get weather
            if (lowerCmd.includes('weather')) {
                const locationMatch = lowerCmd.match(/weather\s+(?:in|at)\s+(\w+)/);
                const location = locationMatch ? locationMatch[1] : '';
                
                if (location) {
                    updateAIResponse(`ðŸŒ¤ï¸ Searching weather for ${location}...`);
                    window.open(`https://www.google.com/search?q=weather+${encodeURIComponent(location)}`, '_blank');
                } else {
                    updateAIResponse(`ðŸŒ¤ï¸ Checking weather...`);
                    window.open('https://www.google.com/search?q=weather', '_blank');
                }
                return true;
            }
            
            return false;
        }

        // ================ CONTACT MANAGEMENT ================
        function findContact(nameQuery) {
            return myContacts.find(c => 
                c.name.toLowerCase().includes(nameQuery.toLowerCase())
            );
        }

        async function trySyncContacts() {
            if ('contacts' in navigator && 'ContactsManager' in window) {
                try {
                    const contacts = await navigator.contacts.select(['name', 'tel'], { multiple: true });
                    if (contacts.length) {
                        let addedCount = 0;
                        contacts.forEach(c => {
                            if (c.tel && c.tel.length > 0 && c.name && c.name.length > 0) {
                                // Check if contact already exists
                                const exists = myContacts.some(existing => 
                                    existing.name === c.name[0] && existing.phone === c.tel[0]
                                );
                                if (!exists) {
                                    myContacts.push({ name: c.name[0], phone: c.tel[0] });
                                    addedCount++;
                                }
                            }
                        });
                        saveContacts();
                        renderContacts();
                        speakResponse(`Synced ${addedCount} contacts`);
                        updateAIResponse(`âœ… Synced ${addedCount} new contacts from device`);
                    } else {
                        updateAIResponse("No contacts selected");
                    }
                } catch (error) {
                    console.error('Contact sync error:', error);
                    updateAIResponse("âš ï¸ Contact sync not available or permission denied");
                }
            } else {
                updateAIResponse("âš ï¸ Contact API not supported in this browser");
            }
        }

        function showAddContactModal() {
            document.getElementById('addContactModal').style.display = 'block';
        }

        function addNewContact() {
            const name = document.getElementById('newContactName').value.trim();
            const phone = document.getElementById('newContactPhone').value.trim();
            
            if (name && phone) {
                // Basic phone validation
                const phoneRegex = /^[0-9\s\+\-\(\)]{10,}$/;
                if (!phoneRegex.test(phone)) {
                    alert('Please enter a valid phone number (minimum 10 digits)');
                    return;
                }
                
                myContacts.push({ name, phone });
                saveContacts();
                renderContacts();
                closeModal('addContactModal');
                updateAIResponse(`âœ… Added contact: ${name}`);
            } else {
                alert('Please enter both name and phone number');
            }
        }

        function saveContacts() {
            localStorage.setItem('altech_contacts', JSON.stringify(myContacts));
            updateStats();
        }

        function renderContacts() {
            const list = document.getElementById('contactsList');
            if (myContacts.length === 0) {
                list.innerHTML = '<p style="color: var(--text-secondary); text-align: center; padding: 40px;">No contacts yet. Add your first contact!</p>';
                return;
            }
            
            list.innerHTML = myContacts.map(contact => `
                <div class="contact-item" onclick="callContact('${contact.name}')">
                    <div class="contact-avatar">${contact.name.charAt(0).toUpperCase()}</div>
                    <div class="contact-info">
                        <div class="contact-name">${contact.name}</div>
                        <div class="contact-phone">${contact.phone}</div>
                    </div>
                    <button onclick="deleteContact('${contact.name}')" 
                            style="background: none; border: none; color: var(--danger); cursor: pointer; padding: 8px;">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            `).join('');
        }

        function deleteContact(contactName) {
            if (confirm(`Delete contact ${contactName}?`)) {
                myContacts = myContacts.filter(c => c.name !== contactName);
                saveContacts();
                renderContacts();
                updateAIResponse(`ðŸ—‘ï¸ Contact ${contactName} deleted`);
            }
        }

        function callContact(contactName) {
            const contact = findContact(contactName);
            if (contact) {
                if (confirm(`Call ${contact.name} at ${contact.phone}?`)) {
                    // ACTUAL CALL - Uncomment for real calls
                    // window.location.href = `tel:${contact.phone}`;
                    
                    updateAIResponse(`ðŸ“ž Calling <strong>${contact.name}</strong> at ${contact.phone}`);
                    conversationContext.lastContact = contact;
                }
            }
        }

        // ================ REMINDERS ================
        function showAddReminderModal() {
            const now = new Date();
            const timeInput = document.getElementById('newReminderTime');
            timeInput.value = now.toISOString().slice(0, 16);
            document.getElementById('addReminderModal').style.display = 'block';
        }

        function addNewReminder() {
            const text = document.getElementById('newReminderText').value.trim();
            const time = document.getElementById('newReminderTime').value;
            
            if (text && time) {
                addReminder(text, time);
                closeModal('addReminderModal');
            } else {
                alert('Please enter reminder text and time');
            }
        }

        function addReminder(task, time) {
            const reminder = {
                id: Date.now(),
                task: task,
                time: time,
                created: new Date().toISOString()
            };
            reminders.push(reminder);
            saveReminders();
            renderReminders();
        }

        function saveReminders() {
            localStorage.setItem('altech_reminders', JSON.stringify(reminders));
            updateStats();
        }

        function renderReminders() {
            const list = document.getElementById('remindersList');
            if (reminders.length === 0) {
                list.innerHTML = '<p style="color: var(--text-secondary); text-align: center; padding: 40px;">No reminders yet.</p>';
                return;
            }
            
            const now = new Date();
            list.innerHTML = reminders.sort((a, b) => new Date(a.time) - new Date(b.time)).map(reminder => {
                const time = new Date(reminder.time);
                const isDue = time <= now;
                
                return `
                    <div class="reminder-item ${isDue ? 'due' : ''}">
                        <div class="reminder-text">${reminder.task}</div>
                        <div class="reminder-time">
                            <i class="fas fa-clock"></i>
                            ${time.toLocaleString()}
                        </div>
                        <button onclick="deleteReminder(${reminder.id})" style="margin-top: 10px; background: var(--danger); color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer;">
                            <i class="fas fa-trash"></i> Delete
                        </button>
                    </div>
                `;
            }).join('');
        }

        function deleteReminder(id) {
            if (confirm('Delete this reminder?')) {
                reminders = reminders.filter(r => r.id !== id);
                saveReminders();
                renderReminders();
            }
        }

        function requestNotificationPermission() {
            if ("Notification" in window && Notification.permission === "default") {
                Notification.requestPermission().then(permission => {
                    if (permission === "granted") {
                        new Notification("ALTECH AI Assistant", {
                            body: "Notifications enabled! You'll get reminder alerts.",
                            icon: "https://cdn-icons-png.flaticon.com/512/3448/3448737.png"
                        });
                    }
                });
            }
        }

        function checkAndSetReminderInterval() {
            setInterval(() => {
                const now = new Date();
                const notificationsEnabled = document.getElementById('enableNotifications')?.checked !== false;
                
                reminders.forEach(reminder => {
                    const reminderTime = new Date(reminder.time);
                    if (reminderTime <= now && reminderTime > new Date(reminderTime.getTime() - 60000)) {
                        // Fire notification
                        if (notificationsEnabled && Notification.permission === "granted") {
                            new Notification('ALTECH Reminder', {
                                body: reminder.task,
                                icon: 'https://cdn-icons-png.flaticon.com/512/3448/3448737.png'
                            });
                        }
                        speakResponse(`Reminder: ${reminder.task}`);
                        deleteReminder(reminder.id);
                    }
                });
            }, 60000); // Check every minute
        }

        // ================ NOTES ================
        function saveNotes() {
            const notes = quickNotesEl.value;
            localStorage.setItem('quickNotes', notes);
            
            // Add to history if not empty
            const lastLine = notes.trim().split('\n').pop();
            if (lastLine && lastLine.trim()) {
                addNoteToHistory(lastLine.trim());
            }
        }

        function loadNotes() {
            quickNotesEl.value = localStorage.getItem('quickNotes') || '';
        }

        function clearNotes() {
            if (confirm('Clear all notes?')) {
                quickNotesEl.value = '';
                saveNotes();
            }
        }

        function addNoteToHistory(note) {
            notesHistory.push({
                text: note,
                time: new Date().toISOString()
            });
            
            if (notesHistory.length > 20) {
                notesHistory = notesHistory.slice(-20);
            }
            
            localStorage.setItem('altech_notes_history', JSON.stringify(notesHistory));
            renderNotesHistory();
            updateStats();
        }

        function renderNotesHistory() {
            const container = document.getElementById('notesHistory');
            if (notesHistory.length === 0) {
                container.innerHTML = '<p style="color: var(--text-secondary); text-align: center; padding: 40px;">No recent notes.</p>';
                return;
            }
            
            container.innerHTML = notesHistory.slice().reverse().map(note => `
                <div class="note-item">
                    <div class="note-content">${note.text}</div>
                    <div class="note-time">${new Date(note.time).toLocaleString()}</div>
                </div>
            `).join('');
        }

        // ================ HISTORY & STATS ================
        function addToHistory(command) {
            conversationHistory.push({
                command: command,
                time: new Date().toISOString()
            });
            
            if (conversationHistory.length > 10) {
                conversationHistory = conversationHistory.slice(-10);
            }
            
            localStorage.setItem('altech_history', JSON.stringify(conversationHistory));
            renderCommandHistory();
        }

        function renderCommandHistory() {
            const container = document.getElementById('commandHistory');
            if (conversationHistory.length === 0) {
                container.innerHTML = '<p style="color: var(--text-secondary); text-align: center; padding: 10px;">No recent commands.</p>';
                return;
            }
            
            container.innerHTML = conversationHistory.slice().reverse().map(item => `
                <div style="padding: 8px; border-bottom: 1px solid rgba(0,0,0,0.1); font-size: 0.9rem;">
                    <div style="color: var(--text-secondary);">${new Date(item.time).toLocaleTimeString()}</div>
                    <div>"${item.command.substring(0, 40)}${item.command.length > 40 ? '...' : ''}"</div>
                </div>
            `).join('');
        }

        function loadStats() {
            document.getElementById('contactCount').textContent = myContacts.length;
            document.getElementById('reminderCount').textContent = reminders.length;
            document.getElementById('noteCount').textContent = notesHistory.length;
            document.getElementById('aiResponseCount').textContent = aiResponseCount;
        }

        function updateStats() {
            loadStats();
        }

        // ================ QUICK ACTIONS ================
        function quickAction(action) {
            switch(action) {
                case 'call_last':
                    if (conversationContext.lastContact) {
                        if (confirm(`Call ${conversationContext.lastContact.name}?`)) {
                            updateAIResponse(`ðŸ“ž Calling ${conversationContext.lastContact.name}`);
                            // window.location.href = `tel:${conversationContext.lastContact.phone}`;
                        }
                    } else {
                        updateAIResponse("No recent contact found");
                    }
                    break;
                    
                case 'add_note':
                    const note = prompt("Enter quick note:");
                    if (note) {
                        addNoteToHistory(note);
                        updateAIResponse(`ðŸ“ Note added: ${note.substring(0, 50)}...`);
                    }
                    break;
                    
                case 'weather':
                    updateAIResponse("ðŸŒ¤ï¸ Opening weather...");
                    window.open('https://www.google.com/search?q=weather', '_blank');
                    break;
                    
                case 'search':
                    const query = prompt("What would you like to search for?");
                    if (query) {
                        window.open(`https://www.google.com/search?q=${encodeURIComponent(query)}`, '_blank');
                    }
                    break;
                    
                case 'joke':
                    tellJoke();
                    break;
                    
                case 'time':
                    const time = new Date().toLocaleTimeString();
                    speakResponse(`The time is ${time}`);
                    updateAIResponse(`ðŸ•’ ${time}`);
                    break;
            }
        }

        async function tellJoke() {
            try {
                const response = await fetch('https://v2.jokeapi.dev/joke/Any?type=single');
                const data = await response.json();
                const joke = data.joke || "Why don't scientists trust atoms? Because they make up everything!";
                speakResponse(joke);
                updateAIResponse(`ðŸ˜‚ ${joke}`);
            } catch {
                const jokes = [
                    "Why don't scientists trust atoms? Because they make up everything!",
                    "What do you call a fake noodle? An impasta!"
                ];
                const joke = jokes[Math.floor(Math.random() * jokes.length)];
                speakResponse(joke);
                updateAIResponse(`ðŸ˜‚ ${joke}`);
            }
        }

        // ================ UTILITY FUNCTIONS ================
        function speakResponse(text) {
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.rate = voiceSpeed;
            utterance.pitch = 1.0;
            window.speechSynthesis.speak(utterance);
        }

        function updateAIResponse(html) {
            aiOutputEl.innerHTML = html;
        }

        function openTab(tabId) {
            // Update tabs
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-pane').forEach(pane => pane.classList.remove('active'));
            
            // Activate selected tab
            const btn = document.querySelector(`.tab-btn[onclick="openTab('${tabId}')"]`);
            if (btn) btn.classList.add('active');
            const pane = document.getElementById(tabId);
            if (pane) pane.classList.add('active');
        }

        function speakCommand(command) {
            transcriptEl.textContent = `"${command}"`;
            handleCommand(command);
        }

        function updateVoiceSpeed(speed) {
            voiceSpeed = parseFloat(speed);
            localStorage.setItem('voiceSpeed', speed);
            
            const speedValue = document.getElementById('speedValue');
            if (speedValue) {
                if (speed < 0.8) speedValue.textContent = 'Slow';
                else if (speed > 1.2) speedValue.textContent = 'Fast';
                else speedValue.textContent = 'Normal';
            }
        }

        // ================ WHATSAPP INTEGRATION ================
        function toggleWhatsAppModal() {
            const modal = document.getElementById('whatsappModal');
            modal.style.display = modal.style.display === 'block' ? 'none' : 'block';
        }

        function openWhatsApp(type) {
            const messages = {
                help: "Hello, I need help with ALTECH AI Assistant.",
                feedback: "Hello, here's my feedback about ALTECH AI Assistant: ",
                feature: "Hello, I'd like to suggest a feature for ALTECH AI Assistant: ",
                demo: "Hello, I'd like to schedule a demo call for ALTECH AI Assistant."
            };
            
            const message = encodeURIComponent(messages[type] || "Hello, I need assistance with ALTECH AI Assistant.");
            window.open(`https://wa.me/254706389206?text=${message}`, '_blank');
            toggleWhatsAppModal();
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        // ================ DATA MANAGEMENT ================
        function exportData() {
            const data = {
                contacts: myContacts,
                reminders: reminders,
                notes: localStorage.getItem('quickNotes'),
                settings: {
                    aiProvider: currentAIProvider,
                    voiceSpeed: voiceSpeed,
                    theme: document.body.className
                }
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `altech-ai-backup-${new Date().toISOString().slice(0,10)}.json`;
            a.click();
            
            updateAIResponse("âœ… Data exported successfully");
        }

        function clearAllData() {
            if (confirm('Are you sure you want to clear ALL data? This cannot be undone.')) {
                localStorage.clear();
                myContacts = [];
                reminders = [];
                conversationHistory = [];
                notesHistory = [];
                aiResponseCount = 0;
                
                // Reload app
                location.reload();
            }
        }

        // ================ INITIAL SETUP ================
        // Load saved preferences
        const savedAIProvider = localStorage.getItem('aiProvider');
        if (savedAIProvider) {
            currentAIProvider = savedAIProvider;
            aiProviderSelect.value = savedAIProvider;
        }
        
        const savedAIMode = localStorage.getItem('aiEnabled');
        if (savedAIMode !== null) {
            aiEnabled = savedAIMode === 'true';
            aiToggleBtn.classList.toggle('active', aiEnabled);
            aiToggleBtn.innerHTML = `<i class="fas fa-${aiEnabled ? 'brain' : 'ban'}"></i>`;
        }
        
        updateAIStatus();
        
        // Initialize typing indicator
        aiOutputEl.innerHTML = `
            <div class="typing-indicator">
                <div class="typing-dot"></div>
                <div class="typing-dot"></div>
                <div class="typing-dot"></div>
            </div>
            Loading AI Assistant...
        `;
    </script>
</body>
</html>
