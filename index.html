<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ALTECH AI - Advanced Assistant</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #007bff;
            --primary-dark: #0056b3;
            --secondary: #6c757d;
            --success: #28a745;
            --danger: #dc3545;
            --warning: #ffc107;
            --info: #17a2b8;
            --dark: #343a40;
            --light: #f8f9fa;
            --bg-color: #ffffff;
            --surface: #f8f9fa;
            --text: #212529;
            --text-secondary: #6c757d;
            --border: #dee2e6;
            --shadow: rgba(0, 0, 0, 0.1);
            --radius: 12px;
        }
        
        .dark-mode {
            --primary: #3298fe;
            --primary-dark: #1a7ed8;
            --secondary: #8a93a2;
            --success: #2bc155;
            --danger: #e74c3c;
            --warning: #f1c40f;
            --info: #3498db;
            --dark: #1a1d21;
            --light: #2d3238;
            --bg-color: #121416;
            --surface: #1a1d21;
            --text: #e9ecef;
            --text-secondary: #8a93a2;
            --border: #2d3238;
            --shadow: rgba(0, 0, 0, 0.3);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            transition: background-color 0.3s, color 0.3s, border-color 0.3s;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-color);
            color: var(--text);
            min-height: 100vh;
            padding: 20px;
            transition: background-color 0.3s;
        }
        
        .app-container {
            max-width: 1400px;
            margin: 0 auto;
            background: var(--surface);
            border-radius: 20px;
            box-shadow: 0 20px 60px var(--shadow);
            overflow: hidden;
            border: 1px solid var(--border);
        }
        
        .header {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }
        
        .header-controls {
            position: absolute;
            right: 30px;
            top: 50%;
            transform: translateY(-50%);
            display: flex;
            gap: 15px;
            align-items: center;
        }
        
        .theme-toggle, .ai-toggle {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.3em;
            transition: all 0.3s ease;
        }
        
        .theme-toggle:hover, .ai-toggle:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.1);
        }
        
        .ai-toggle.active {
            background: var(--success);
            border-color: var(--success);
        }
        
        .main-content {
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 25px;
            padding: 30px;
            min-height: 800px;
        }
        
        @media (max-width: 1100px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }
        
        .sidebar {
            background: var(--bg-color);
            padding: 25px;
            border-radius: var(--radius);
            border: 1px solid var(--border);
            height: fit-content;
        }
        
        .voice-section {
            background: var(--bg-color);
            padding: 30px;
            border-radius: var(--radius);
            border: 1px solid var(--border);
        }
        
        .voice-orb {
            width: 160px;
            height: 160px;
            background: linear-gradient(135deg, var(--primary), var(--info));
            border-radius: 50%;
            margin: 0 auto 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 8px solid var(--surface);
            box-shadow: 0 15px 35px var(--shadow);
            position: relative;
            overflow: hidden;
        }
        
        .voice-orb::after {
            content: '';
            position: absolute;
            top: -10px;
            left: -10px;
            right: -10px;
            bottom: -10px;
            background: conic-gradient(transparent, var(--primary), transparent 70%);
            animation: rotate 3s linear infinite;
            border-radius: 50%;
        }
        
        @keyframes rotate {
            100% { transform: rotate(360deg); }
        }
        
        .voice-orb:hover {
            transform: scale(1.05);
        }
        
        .voice-orb.listening {
            background: linear-gradient(135deg, var(--danger), var(--warning));
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .voice-orb i {
            font-size: 3.5em;
            color: white;
            position: relative;
            z-index: 1;
        }
        
        #status {
            font-size: 1.2em;
            color: var(--text-secondary);
            margin-bottom: 20px;
            font-weight: 600;
            text-align: center;
        }
        
        #transcript {
            background: var(--surface);
            padding: 25px;
            border-radius: var(--radius);
            margin: 20px 0;
            font-size: 1.3em;
            min-height: 100px;
            border-left: 5px solid var(--primary);
            font-weight: 600;
            border: 1px solid var(--border);
        }
        
        .ai-response {
            background: var(--surface);
            padding: 25px;
            border-radius: var(--radius);
            margin: 25px 0;
            border-left: 5px solid var(--success);
            border: 1px solid var(--border);
        }
        
        .quick-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 25px 0;
        }
        
        .action-btn {
            padding: 20px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: var(--radius);
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 12px;
            font-weight: 600;
            font-size: 1em;
            border: 2px solid transparent;
        }
        
        .action-btn:hover {
            background: var(--primary-dark);
            transform: translateY(-3px);
            box-shadow: 0 10px 20px var(--shadow);
            border-color: var(--primary);
        }
        
        .action-btn.success {
            background: var(--success);
        }
        
        .action-btn.success:hover {
            background: #218838;
        }
        
        .action-btn.warning {
            background: var(--warning);
            color: var(--dark);
        }
        
        .action-btn.info {
            background: var(--info);
        }
        
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 25px;
            flex-wrap: wrap;
            border-bottom: 2px solid var(--border);
            padding-bottom: 15px;
        }
        
        .tab-btn {
            padding: 15px 25px;
            background: var(--surface);
            border: none;
            border-radius: var(--radius);
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            flex: 1;
            min-width: 120px;
            text-align: center;
            color: var(--text);
            border: 1px solid transparent;
        }
        
        .tab-btn:hover {
            background: var(--primary);
            color: white;
        }
        
        .tab-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }
        
        .tab-content {
            display: none;
            animation: fadeIn 0.5s ease;
        }
        
        .tab-content.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .contact-item {
            padding: 20px;
            background: var(--surface);
            border-radius: var(--radius);
            margin-bottom: 15px;
            border: 1px solid var(--border);
            transition: all 0.3s ease;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .contact-item:hover {
            border-color: var(--primary);
            box-shadow: 0 5px 15px var(--shadow);
            transform: translateY(-2px);
        }
        
        .note-item {
            padding: 20px;
            background: var(--surface);
            border-radius: var(--radius);
            margin-bottom: 15px;
            border: 1px solid var(--border);
            position: relative;
        }
        
        .reminder-item {
            padding: 20px;
            background: var(--surface);
            border-radius: var(--radius);
            margin-bottom: 15px;
            border: 1px solid var(--border);
            border-left: 5px solid var(--warning);
        }
        
        .reminder-item.due {
            border-left-color: var(--danger);
            background: rgba(220, 53, 69, 0.1);
        }
        
        .search-result-item {
            padding: 20px;
            background: var(--surface);
            border-radius: var(--radius);
            margin-bottom: 15px;
            border: 1px solid var(--border);
            border-left: 5px solid var(--info);
        }
        
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 20px;
            backdrop-filter: blur(5px);
        }
        
        .modal {
            background: var(--bg-color);
            padding: 30px;
            border-radius: var(--radius);
            max-width: 500px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            animation: modalSlide 0.3s ease;
            border: 1px solid var(--border);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }
        
        @keyframes modalSlide {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        .modal h3 {
            margin-bottom: 25px;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text);
        }
        
        .form-control {
            width: 100%;
            padding: 15px;
            background: var(--surface);
            color: var(--text);
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 1em;
            transition: all 0.3s ease;
        }
        
        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.1);
        }
        
        .modal-actions {
            display: flex;
            gap: 15px;
            margin-top: 30px;
        }
        
        .btn {
            flex: 1;
            padding: 15px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 1em;
            transition: all 0.3s ease;
        }
        
        .btn-primary {
            background: var(--primary);
            color: white;
        }
        
        .btn-primary:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
        }
        
        .btn-secondary {
            background: var(--secondary);
            color: white;
        }
        
        .btn-secondary:hover {
            background: #5a6268;
        }
        
        .toast {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: var(--dark);
            color: white;
            padding: 20px 30px;
            border-radius: var(--radius);
            box-shadow: 0 10px 30px var(--shadow);
            z-index: 1001;
            display: none;
            animation: slideIn 0.3s ease;
            border: 1px solid var(--border);
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        .command-suggestions {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 20px;
            justify-content: center;
        }
        
        .command-chip {
            padding: 12px 20px;
            background: var(--surface);
            border: 2px solid var(--primary);
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            color: var(--primary);
        }
        
        .command-chip:hover {
            background: var(--primary);
            color: white;
            transform: translateY(-2px);
        }
        
        .search-results {
            margin-top: 20px;
            padding: 20px;
            background: var(--surface);
            border-radius: var(--radius);
            max-height: 500px;
            overflow-y: auto;
            border: 1px solid var(--border);
        }
        
        .typing-indicator {
            display: inline-flex;
            gap: 5px;
            align-items: center;
            padding: 10px;
        }
        
        .typing-dot {
            width: 8px;
            height: 8px;
            background: var(--primary);
            border-radius: 50%;
            animation: bounce 1.4s infinite;
        }
        
        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }
        
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 20px;
        }
        
        .stat-card {
            background: var(--surface);
            padding: 20px;
            border-radius: var(--radius);
            text-align: center;
            border: 1px solid var(--border);
        }
        
        .stat-number {
            font-size: 2em;
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 5px;
        }
        
        .stat-label {
            font-size: 0.9em;
            color: var(--text-secondary);
        }
        
        #notesTextarea {
            width: 100%;
            min-height: 200px;
            padding: 20px;
            background: var(--surface);
            color: var(--text);
            border: 2px solid var(--border);
            border-radius: var(--radius);
            font-size: 1em;
            font-family: inherit;
            resize: vertical;
            margin-bottom: 20px;
        }
        
        #notesTextarea:focus {
            outline: none;
            border-color: var(--primary);
        }
        
        .weather-display {
            background: linear-gradient(135deg, var(--primary), var(--info));
            color: white;
            padding: 30px;
            border-radius: var(--radius);
            margin: 20px 0;
        }
        
        .ai-thinking {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            padding: 15px;
            background: var(--surface);
            border-radius: var(--radius);
            margin: 10px 0;
            border: 1px solid var(--border);
        }
        
        .error-message {
            background: rgba(220, 53, 69, 0.1);
            color: var(--danger);
            padding: 15px;
            border-radius: var(--radius);
            margin: 10px 0;
            border: 1px solid var(--danger);
        }
        
        .success-message {
            background: rgba(40, 167, 69, 0.1);
            color: var(--success);
            padding: 15px;
            border-radius: var(--radius);
            margin: 10px 0;
            border: 1px solid var(--success);
        }
        
        .info-message {
            background: rgba(23, 162, 184, 0.1);
            color: var(--info);
            padding: 15px;
            border-radius: var(--radius);
            margin: 10px 0;
            border: 1px solid var(--info);
        }
        
        .contact-actions {
            display: flex;
            gap: 10px;
        }
        
        .contact-btn {
            padding: 8px 15px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.3s ease;
        }
        
        .contact-btn.call {
            background: var(--success);
            color: white;
        }
        
        .contact-btn.delete {
            background: var(--danger);
            color: white;
        }
        
        .contact-btn:hover {
            transform: scale(1.05);
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid var(--border);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .ai-provider-selector {
            margin: 20px 0;
            padding: 20px;
            background: var(--surface);
            border-radius: var(--radius);
            border: 1px solid var(--border);
        }
        
        .ai-provider-selector select {
            width: 100%;
            padding: 12px;
            background: var(--bg-color);
            color: var(--text);
            border: 2px solid var(--border);
            border-radius: 8px;
            margin-top: 10px;
        }
        
        @media (max-width: 768px) {
            .header-controls {
                position: static;
                transform: none;
                justify-content: center;
                margin-top: 20px;
            }
            
            .header h1 {
                flex-direction: column;
                gap: 10px;
            }
            
            .quick-actions {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .tabs {
                flex-direction: column;
            }
            
            .tab-btn {
                flex: none;
                width: 100%;
            }
            
            .modal-actions {
                flex-direction: column;
            }
            
            .voice-orb {
                width: 140px;
                height: 140px;
            }
        }
        
        .voice-controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
        }
        
        .voice-btn {
            padding: 12px 25px;
            background: var(--surface);
            border: 2px solid var(--primary);
            border-radius: 25px;
            color: var(--primary);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .voice-btn:hover {
            background: var(--primary);
            color: white;
        }
        
        .recent-activity {
            margin-top: 30px;
            padding: 20px;
            background: var(--surface);
            border-radius: var(--radius);
            border: 1px solid var(--border);
        }
        
        .activity-item {
            padding: 15px;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .activity-item:last-child {
            border-bottom: none;
        }
        
        .activity-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
        }
    </style>
</head>
<body class="light-mode">
    <div class="app-container">
        <div class="header">
            <h1>
                <i class="fas fa-robot"></i>
                <span>ALTECH AI Assistant</span>
            </h1>
            <p>Advanced AI assistant with intelligent search and management</p>
            
            <div class="header-controls">
                <button class="theme-toggle" onclick="toggleTheme()" title="Toggle Theme">
                    <i class="fas fa-moon"></i>
                </button>
                <button class="ai-toggle active" id="aiToggle" onclick="toggleAI()" title="Toggle AI">
                    <i class="fas fa-brain"></i>
                </button>
            </div>
        </div>
        
        <div class="main-content">
            <!-- Sidebar -->
            <div class="sidebar">
                <div class="ai-provider-selector">
                    <h3><i class="fas fa-cog"></i> AI Settings</h3>
                    <select id="aiMode" onchange="changeAIMode(this.value)">
                        <option value="smart">Smart AI Mode</option>
                        <option value="search">Search Mode</option>
                        <option value="creative">Creative Mode</option>
                        <option value="precise">Precise Mode</option>
                    </select>
                    <div style="margin-top: 15px; font-size: 0.9em; color: var(--text-secondary);">
                        <i class="fas fa-info-circle"></i> AI responses vary by mode
                    </div>
                </div>
                
                <div style="margin: 30px 0;">
                    <h3><i class="fas fa-chart-bar"></i> Statistics</h3>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-number" id="contactCount">0</div>
                            <div class="stat-label">Contacts</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="noteCount">0</div>
                            <div class="stat-label">Notes</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="reminderCount">0</div>
                            <div class="stat-label">Reminders</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="aiCount">0</div>
                            <div class="stat-label">AI Responses</div>
                        </div>
                    </div>
                </div>
                
                <div class="recent-activity">
                    <h3><i class="fas fa-history"></i> Recent Activity</h3>
                    <div id="activityLog">
                        <div class="activity-item">
                            <div class="activity-icon">
                                <i class="fas fa-robot"></i>
                            </div>
                            <div>
                                <div>AI Assistant Ready</div>
                                <small style="color: var(--text-secondary);">Just now</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Main Voice Section -->
            <div class="voice-section">
                <div class="tabs">
                    <button class="tab-btn active" onclick="openTab('assistant')">
                        <i class="fas fa-robot"></i> Assistant
                    </button>
                    <button class="tab-btn" onclick="openTab('contacts')">
                        <i class="fas fa-users"></i> Contacts
                    </button>
                    <button class="tab-btn" onclick="openTab('notes')">
                        <i class="fas fa-sticky-note"></i> Notes
                    </button>
                    <button class="tab-btn" onclick="openTab('reminders')">
                        <i class="fas fa-bell"></i> Reminders
                    </button>
                    <button class="tab-btn" onclick="openTab('search')">
                        <i class="fas fa-search"></i> Search
                    </button>
                </div>
                
                <!-- Assistant Tab -->
                <div id="assistant" class="tab-content active">
                    <div class="voice-orb" id="voiceOrb" onclick="toggleListening()">
                        <i class="fas fa-microphone"></i>
                    </div>
                    
                    <div id="status">Click microphone and speak your command</div>
                    <div id="transcript">Say something like: "Add note meeting tomorrow" or "What is AI?"</div>
                    
                    <div class="voice-controls">
                        <button class="voice-btn" onclick="testCommand('Add note meeting tomorrow at 3 PM')">
                            <i class="fas fa-edit"></i> Test Note
                        </button>
                        <button class="voice-btn" onclick="testCommand('What is artificial intelligence?')">
                            <i class="fas fa-question"></i> Ask AI
                        </button>
                        <button class="voice-btn" onclick="testCommand('Weather in Nairobi')">
                            <i class="fas fa-cloud-sun"></i> Weather
                        </button>
                    </div>
                    
                    <div class="ai-response">
                        <h3><i class="fas fa-brain"></i> AI Response</h3>
                        <div id="aiOutput">
                            <div class="typing-indicator">
                                <div class="typing-dot"></div>
                                <div class="typing-dot"></div>
                                <div class="typing-dot"></div>
                            </div>
                            Initializing AI Assistant... Ready to help!
                        </div>
                    </div>
                    
                    <div class="quick-actions">
                        <button class="action-btn" onclick="quickAction('add_contact')">
                            <i class="fas fa-user-plus"></i>
                            <span>Add Contact</span>
                        </button>
                        <button class="action-btn success" onclick="quickAction('add_note')">
                            <i class="fas fa-edit"></i>
                            <span>Add Note</span>
                        </button>
                        <button class="action-btn warning" onclick="quickAction('add_reminder')">
                            <i class="fas fa-bell"></i>
                            <span>Add Reminder</span>
                        </button>
                        <button class="action-btn info" onclick="quickAction('search_web')">
                            <i class="fas fa-search"></i>
                            <span>Search Web</span>
                        </button>
                        <button class="action-btn" onclick="quickAction('check_weather')">
                            <i class="fas fa-cloud-sun"></i>
                            <span>Check Weather</span>
                        </button>
                        <button class="action-btn" onclick="quickAction('ask_ai')">
                            <i class="fas fa-question-circle"></i>
                            <span>Ask AI</span>
                        </button>
                    </div>
                    
                    <div class="command-suggestions">
                        <div class="command-chip" onclick="testCommand('Add contact John phone 0712345678')">
                            <i class="fas fa-user-plus"></i> Add Contact
                        </div>
                        <div class="command-chip" onclick="testCommand('Add note meeting tomorrow at 3 PM')">
                            <i class="fas fa-edit"></i> Add Note
                        </div>
                        <div class="command-chip" onclick="testCommand('Remind me to call mom tomorrow')">
                            <i class="fas fa-bell"></i> Set Reminder
                        </div>
                        <div class="command-chip" onclick="testCommand('What is artificial intelligence?')">
                            <i class="fas fa-question"></i> Ask Question
                        </div>
                        <div class="command-chip" onclick="testCommand('Weather in London')">
                            <i class="fas fa-cloud-sun"></i> Check Weather
                        </div>
                    </div>
                </div>
                
                <!-- Contacts Tab -->
                <div id="contacts" class="tab-content">
                    <div style="display: flex; gap: 15px; margin-bottom: 25px;">
                        <button class="action-btn" onclick="showAddContactModal()" style="flex: 1;">
                            <i class="fas fa-user-plus"></i> Add Contact
                        </button>
                        <button class="action-btn info" onclick="importContacts()" style="flex: 1;">
                            <i class="fas fa-file-import"></i> Import Sample
                        </button>
                    </div>
                    
                    <div id="contactsList">
                        <p style="text-align: center; padding: 40px; color: var(--text-secondary);">
                            No contacts yet. Add your first contact!
                        </p>
                    </div>
                </div>
                
                <!-- Notes Tab -->
                <div id="notes" class="tab-content">
                    <div style="margin-bottom: 25px;">
                        <textarea id="notesTextarea" placeholder="Type your notes here... (Auto-saves every 30 seconds)"></textarea>
                        <div style="display: flex; gap: 15px;">
                            <button class="btn btn-primary" onclick="saveNotes()">
                                <i class="fas fa-save"></i> Save Notes
                            </button>
                            <button class="btn btn-secondary" onclick="clearNotes()">
                                <i class="fas fa-trash"></i> Clear
                            </button>
                            <button class="btn btn-info" onclick="exportNotes()">
                                <i class="fas fa-download"></i> Export
                            </button>
                        </div>
                    </div>
                    
                    <h3><i class="fas fa-history"></i> Recent Notes</h3>
                    <div id="notesList">
                        <p style="text-align: center; padding: 40px; color: var(--text-secondary);">
                            No notes yet. Start typing above!
                        </p>
                    </div>
                </div>
                
                <!-- Reminders Tab -->
                <div id="reminders" class="tab-content">
                    <div style="margin-bottom: 25px;">
                        <div class="form-group">
                            <label>Reminder Text</label>
                            <input type="text" id="reminderText" class="form-control" placeholder="What to remind?">
                        </div>
                        <div class="form-group">
                            <label>Date & Time</label>
                            <input type="datetime-local" id="reminderTime" class="form-control">
                        </div>
                        <button class="btn btn-primary" onclick="addReminder()" style="width: 100%;">
                            <i class="fas fa-plus"></i> Add Reminder
                        </button>
                    </div>
                    
                    <h3><i class="fas fa-bell"></i> Active Reminders</h3>
                    <div id="remindersList">
                        <p style="text-align: center; padding: 40px; color: var(--text-secondary);">
                            No reminders scheduled
                        </p>
                    </div>
                </div>
                
                <!-- Search Tab -->
                <div id="search" class="tab-content">
                    <div style="margin-bottom: 25px;">
                        <div class="form-group">
                            <label>Search Query</label>
                            <input type="text" id="searchQuery" class="form-control" 
                                   placeholder="Ask anything or search the web..." 
                                   onkeypress="if(event.key === 'Enter') performSearch()">
                        </div>
                        <div style="display: flex; gap: 15px;">
                            <button class="btn btn-primary" onclick="performSearch()" style="flex: 1;">
                                <i class="fas fa-search"></i> Search
                            </button>
                            <button class="btn btn-info" onclick="searchWikipedia()" style="flex: 1;">
                                <i class="fab fa-wikipedia-w"></i> Wikipedia
                            </button>
                            <button class="btn btn-secondary" onclick="clearSearch()" style="flex: 1;">
                                <i class="fas fa-times"></i> Clear
                            </button>
                        </div>
                    </div>
                    
                    <div id="searchResults" class="search-results">
                        <p style="text-align: center; padding: 40px; color: var(--text-secondary);">
                            Enter a search query above
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modals -->
    <div class="modal-overlay" id="addContactModal">
        <div class="modal">
            <h3><i class="fas fa-user-plus"></i> Add New Contact</h3>
            <div class="form-group">
                <label>Full Name *</label>
                <input type="text" id="contactName" class="form-control" placeholder="Enter full name" required>
            </div>
            <div class="form-group">
                <label>Phone Number *</label>
                <input type="tel" id="contactPhone" class="form-control" placeholder="e.g., 0712345678" required>
            </div>
            <div class="form-group">
                <label>Email (Optional)</label>
                <input type="email" id="contactEmail" class="form-control" placeholder="email@example.com">
            </div>
            <div class="form-group">
                <label>Group (Optional)</label>
                <select id="contactGroup" class="form-control">
                    <option value="">Select Group</option>
                    <option value="family">Family</option>
                    <option value="friends">Friends</option>
                    <option value="work">Work</option>
                    <option value="emergency">Emergency</option>
                </select>
            </div>
            <div class="modal-actions">
                <button class="btn btn-primary" onclick="saveContact()">
                    <i class="fas fa-save"></i> Save Contact
                </button>
                <button class="btn btn-secondary" onclick="closeModal('addContactModal')">
                    <i class="fas fa-times"></i> Cancel
                </button>
            </div>
        </div>
    </div>
    
    <!-- Toast -->
    <div class="toast" id="toast"></div>

    <script>
        // ================ CORE SYSTEM ================
        
        // Data Storage
        let contacts = [];
        let notes = '';
        let reminders = [];
        let activityLog = [];
        let aiResponseCount = 0;
        let aiEnabled = true;
        let currentAIMode = 'smart';
        let isDarkMode = false;
        
        // Voice Recognition
        let recognition = null;
        let isListening = false;
        
        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            console.log('üöÄ Initializing ALTECH AI Assistant...');
            
            // Load theme preference
            loadTheme();
            
            // Load data
            loadAllData();
            
            // Initialize voice
            initializeVoiceRecognition();
            
            // Setup auto-save
            setupAutoSave();
            
            // Setup reminder checking
            setupReminderChecks();
            
            // Show welcome
            setTimeout(() => {
                showToast('ALTECH AI Assistant ready! Try voice commands or click buttons.', 'success');
                updateAIResponse(`
                    <div class="success-message">
                        <h4 style="margin-bottom: 10px;">ü§ñ ALTECH AI Assistant Ready!</h4>
                        <p>I can help you with:</p>
                        <ul style="margin-left: 20px; margin-top: 10px;">
                            <li><strong>üìù Notes</strong> - Add and manage notes with auto-save</li>
                            <li><strong>‚è∞ Reminders</strong> - Set time-based reminders with notifications</li>
                            <li><strong>üîç Search</strong> - Intelligent search with AI answers</li>
                            <li><strong>üë• Contacts</strong> - Manage your contact list</li>
                            <li><strong>üå§Ô∏è Weather</strong> - Check weather forecasts</li>
                            <li><strong>ü§ñ AI Answers</strong> - Get intelligent responses to any question</li>
                        </ul>
                        <p style="margin-top: 15px; font-weight: 600;">Try saying: <em>"Add note meeting tomorrow"</em> or <em>"What is AI?"</em></p>
                    </div>
                `);
                addActivity('AI Assistant Ready', 'fas fa-robot');
            }, 1000);
        });
        
        // ================ THEME MANAGEMENT ================
        
        function loadTheme() {
            const savedTheme = localStorage.getItem('altech_theme') || 'light';
            isDarkMode = savedTheme === 'dark';
            document.body.className = isDarkMode ? 'dark-mode' : 'light-mode';
            updateThemeIcon();
        }
        
        function toggleTheme() {
            isDarkMode = !isDarkMode;
            document.body.className = isDarkMode ? 'dark-mode' : 'light-mode';
            localStorage.setItem('altech_theme', isDarkMode ? 'dark' : 'light');
            updateThemeIcon();
            showToast(`Switched to ${isDarkMode ? 'dark' : 'light'} mode`, 'info');
        }
        
        function updateThemeIcon() {
            const icon = document.querySelector('.theme-toggle i');
            icon.className = isDarkMode ? 'fas fa-sun' : 'fas fa-moon';
        }
        
        function toggleAI() {
            aiEnabled = !aiEnabled;
            const toggleBtn = document.getElementById('aiToggle');
            toggleBtn.classList.toggle('active', aiEnabled);
            toggleBtn.innerHTML = `<i class="fas fa-${aiEnabled ? 'brain' : 'ban'}"></i>`;
            showToast(`AI ${aiEnabled ? 'enabled' : 'disabled'}`, aiEnabled ? 'success' : 'warning');
            addActivity(`AI ${aiEnabled ? 'Enabled' : 'Disabled'}`, 'fas fa-brain');
        }
        
        function changeAIMode(mode) {
            currentAIMode = mode;
            showToast(`AI mode changed to: ${mode}`, 'info');
        }
        
        // ================ VOICE RECOGNITION ================
        
        function initializeVoiceRecognition() {
            try {
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                if (!SpeechRecognition) {
                    showToast('Voice recognition not supported in this browser', 'error');
                    return;
                }
                
                recognition = new SpeechRecognition();
                recognition.continuous = false;
                recognition.interimResults = true;
                recognition.lang = 'en-US';
                recognition.maxAlternatives = 3;
                
                recognition.onstart = () => {
                    isListening = true;
                    document.getElementById('voiceOrb').classList.add('listening');
                    document.getElementById('status').textContent = 'üé§ Listening... Speak now';
                    updateAIResponse('<div class="ai-thinking"><span class="loading"></span> Listening to your command...</div>');
                    addActivity('Voice recognition started', 'fas fa-microphone');
                };
                
                recognition.onresult = (event) => {
                    let finalTranscript = '';
                    let interimTranscript = '';
                    
                    for (let i = event.resultIndex; i < event.results.length; i++) {
                        const transcript = event.results[i][0].transcript;
                        if (event.results[i].isFinal) {
                            finalTranscript += transcript;
                        } else {
                            interimTranscript = transcript;
                        }
                    }
                    
                    // Show interim results
                    if (interimTranscript) {
                        document.getElementById('transcript').textContent = interimTranscript;
                    }
                    
                    // Process final result
                    if (finalTranscript) {
                        document.getElementById('transcript').textContent = finalTranscript;
                        handleVoiceCommand(finalTranscript);
                    }
                };
                
                recognition.onend = () => {
                    isListening = false;
                    document.getElementById('voiceOrb').classList.remove('listening');
                    document.getElementById('status').textContent = '‚úÖ Ready';
                };
                
                recognition.onerror = (event) => {
                    console.error('Speech recognition error:', event.error);
                    isListening = false;
                    document.getElementById('voiceOrb').classList.remove('listening');
                    
                    if (event.error === 'not-allowed') {
                        showToast('Microphone permission denied. Please allow microphone access.', 'error');
                    } else if (event.error === 'no-speech') {
                        showToast('No speech detected. Please try again.', 'warning');
                    } else {
                        showToast('Speech recognition error: ' + event.error, 'error');
                    }
                };
                
            } catch (error) {
                console.error('Voice initialization error:', error);
                showToast('Voice recognition initialization failed', 'error');
            }
        }
        
        function toggleListening() {
            if (!recognition) {
                showToast('Voice recognition not initialized', 'error');
                return;
            }
            
            if (isListening) {
                recognition.stop();
            } else {
                try {
                    recognition.start();
                } catch (error) {
                    showToast('Error starting voice recognition', 'error');
                }
            }
        }
        
        function testCommand(command) {
            document.getElementById('transcript').textContent = command;
            handleVoiceCommand(command);
        }
        
        // ================ COMMAND HANDLING ================
        
        async function handleVoiceCommand(command) {
            console.log('Command received:', command);
            
            // Add to history
            addToHistory(command);
            addActivity(`Voice command: ${command}`, 'fas fa-microphone');
            
            // Show processing
            updateAIResponse('<div class="ai-thinking"><span class="loading"></span> Processing your command...</div>');
            
            // Process command
            await processCommand(command);
        }
        
        async function processCommand(command) {
            const lowerCmd = command.toLowerCase();
            
            // Contact commands
            if (lowerCmd.includes('add contact') || lowerCmd.includes('new contact') || 
                (lowerCmd.includes('contact') && lowerCmd.includes('add'))) {
                handleAddContactCommand(command);
            }
            
            // Note commands
            else if (lowerCmd.includes('add note') || lowerCmd.includes('note that') || 
                     lowerCmd.includes('remember that') || lowerCmd.includes('write down')) {
                handleAddNoteCommand(command);
            }
            
            // Reminder commands
            else if (lowerCmd.includes('remind') || lowerCmd.includes('reminder') || 
                     lowerCmd.includes('alert me') || lowerCmd.includes('set alarm')) {
                handleAddReminderCommand(command);
            }
            
            // Search/Question commands - FIXED: Properly handle "what is", "search for", etc.
            else if (lowerCmd.includes('search for') || lowerCmd.includes('what is') || 
                     lowerCmd.includes('how to') || lowerCmd.includes('why') || 
                     lowerCmd.includes('who is') || lowerCmd.includes('where is') ||
                     lowerCmd.includes('tell me about') || lowerCmd.includes('explain')) {
                await handleSearchCommand(command);
            }
            
            // Weather commands
            else if (lowerCmd.includes('weather') || lowerCmd.includes('forecast') || 
                     lowerCmd.includes('temperature') || lowerCmd.includes('humidity')) {
                handleWeatherCommand(command);
            }
            
            // Time commands
            else if (lowerCmd.includes('time') || lowerCmd.includes('what time') || 
                     lowerCmd.includes('current time')) {
                handleTimeCommand();
            }
            
            // Call commands - Handle properly
            else if (lowerCmd.includes('call')) {
                handleCallCommand(command);
            }
            
            // General AI questions
            else {
                await handleAIQuestion(command);
            }
        }
        
        // ================ CONTACT MANAGEMENT ================
        
        function handleAddContactCommand(command) {
            let name = '';
            let phone = '';
            
            // Extract name and phone from command
            const phoneMatch = command.match(/(\d[\d\s\-\(\)]{9,})/);
            if (phoneMatch) {
                phone = phoneMatch[1].replace(/\D/g, '');
                name = command.replace(/add contact|new contact|\d[\d\s\-\(\)]{9,}/gi, '').trim();
            } else {
                // If no phone in command, show modal
                showAddContactModal();
                updateAIResponse("<div class='info-message'>Please enter the contact details in the form that appears.</div>");
                speakResponse("Please fill in the contact details.");
                return;
            }
            
            if (name && phone) {
                addContact(name, phone);
            } else {
                showAddContactModal();
            }
        }
        
        function handleCallCommand(command) {
            // Extract name from call command
            const nameMatch = command.match(/call\s+(\w+(?:\s+\w+)?)/i);
            if (nameMatch) {
                const name = nameMatch[1];
                const contact = findContactByName(name);
                
                if (contact) {
                    updateAIResponse(`
                        <div class="info-message">
                            <h4>üìû Call ${contact.name}</h4>
                            <p>Phone: ${contact.phone}</p>
                            <p><em>On a mobile device, this would open the dialer with the number.</em></p>
                        </div>
                    `);
                    speakResponse(`Found contact ${contact.name}. Their number is ${contact.phone}`);
                    
                    // On mobile, open dialer
                    if (/Mobi|Android|iPhone|iPad|iPod/i.test(navigator.userAgent)) {
                        window.location.href = `tel:${contact.phone}`;
                    }
                } else {
                    updateAIResponse(`<div class='error-message'>No contact found named "${name}". Add contacts in the Contacts tab.</div>`);
                    speakResponse(`No contact found named ${name}.`);
                }
            } else {
                updateAIResponse("<div class='info-message'>Please specify who to call. Example: 'Call John'</div>");
                speakResponse("Please tell me who to call.");
            }
        }
        
        function findContactByName(name) {
            const searchName = name.toLowerCase();
            return contacts.find(c => 
                c.name.toLowerCase().includes(searchName)
            );
        }
        
        function showAddContactModal() {
            document.getElementById('addContactModal').style.display = 'flex';
            document.getElementById('contactName').focus();
        }
        
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }
        
        function saveContact() {
            const name = document.getElementById('contactName').value.trim();
            const phone = document.getElementById('contactPhone').value.trim();
            const email = document.getElementById('contactEmail').value.trim();
            const group = document.getElementById('contactGroup').value;
            
            if (!name || !phone) {
                showToast('Please enter name and phone number', 'error');
                return;
            }
            
            // Phone validation
            const cleanPhone = phone.replace(/\D/g, '');
            if (cleanPhone.length < 10) {
                showToast('Please enter a valid phone number (minimum 10 digits)', 'error');
                return;
            }
            
            addContact(name, cleanPhone, email, group);
            closeModal('addContactModal');
            
            // Clear form
            document.getElementById('contactName').value = '';
            document.getElementById('contactPhone').value = '';
            document.getElementById('contactEmail').value = '';
            document.getElementById('contactGroup').value = '';
        }
        
        function addContact(name, phone, email = '', group = '') {
            const contact = {
                id: Date.now(),
                name: name,
                phone: phone,
                email: email,
                group: group,
                created: new Date().toISOString()
            };
            
            contacts.push(contact);
            saveContacts();
            updateContactsDisplay();
            
            const message = `Contact "${name}" added successfully`;
            updateAIResponse(`<div class='success-message'><strong>‚úÖ Contact Added</strong><br>Name: ${name}<br>Phone: ${formatPhone(phone)}${email ? `<br>Email: ${email}` : ''}</div>`);
            speakResponse(message);
            showToast(message, 'success');
            addActivity(`Added contact: ${name}`, 'fas fa-user-plus');
        }
        
        function formatPhone(phone) {
            const cleaned = phone.replace(/\D/g, '');
            if (cleaned.length === 10) {
                return `(${cleaned.substring(0, 3)}) ${cleaned.substring(3, 6)}-${cleaned.substring(6)}`;
            }
            return phone;
        }
        
        function importContacts() {
            // Import sample contacts
            const sampleContacts = [
                { id: Date.now() + 1, name: "John Doe", phone: "0712345678", email: "john@example.com", group: "friends" },
                { id: Date.now() + 2, name: "Jane Smith", phone: "0798765432", email: "jane@example.com", group: "work" },
                { id: Date.now() + 3, name: "Emergency Services", phone: "911", email: "", group: "emergency" },
                { id: Date.now() + 4, name: "Alex Johnson", phone: "0744556677", email: "alex@example.com", group: "family" }
            ];
            
            sampleContacts.forEach(contact => contacts.push(contact));
            saveContacts();
            updateContactsDisplay();
            
            showToast(`Imported ${sampleContacts.length} sample contacts`, 'success');
            updateAIResponse(`<div class='success-message'>‚úÖ Imported ${sampleContacts.length} sample contacts</div>`);
            addActivity('Imported sample contacts', 'fas fa-file-import');
        }
        
        function deleteContact(id) {
            const contact = contacts.find(c => c.id === id);
            if (contact && confirm(`Delete contact "${contact.name}"?`)) {
                contacts = contacts.filter(c => c.id !== id);
                saveContacts();
                updateContactsDisplay();
                showToast('Contact deleted', 'success');
                addActivity(`Deleted contact: ${contact.name}`, 'fas fa-user-minus');
            }
        }
        
        // ================ NOTES MANAGEMENT ================
        
        function handleAddNoteCommand(command) {
            let noteText = '';
            
            if (command.includes('add note')) {
                noteText = command.split('add note')[1]?.trim();
            } else if (command.includes('note that')) {
                noteText = command.split('note that')[1]?.trim();
            } else if (command.includes('remember that')) {
                noteText = command.split('remember that')[1]?.trim();
            } else if (command.includes('write down')) {
                noteText = command.split('write down')[1]?.trim();
            }
            
            if (!noteText) {
                noteText = prompt("What would you like to note?", "");
                if (!noteText) return;
            }
            
            addNote(noteText);
        }
        
        function addNote(text) {
            // Add to notes textarea
            const notesTextarea = document.getElementById('notesTextarea');
            const timestamp = new Date().toLocaleString();
            const newNote = `[${timestamp}] ${text}\n`;
            
            notesTextarea.value = newNote + notesTextarea.value;
            saveNotes();
            
            // Update recent notes display
            updateNotesDisplay();
            
            const truncatedText = text.length > 50 ? text.substring(0, 50) + '...' : text;
            updateAIResponse(`<div class='success-message'><strong>üìù Note Added</strong><br>"${truncatedText}"</div>`);
            speakResponse(`Note added: ${truncatedText}`);
            showToast('Note saved!', 'success');
            addActivity('Added note', 'fas fa-sticky-note');
        }
        
        function saveNotes() {
            const notesText = document.getElementById('notesTextarea').value;
            localStorage.setItem('altech_notes', notesText);
            updateNotesDisplay();
            showToast('Notes saved!', 'success');
        }
        
        function clearNotes() {
            if (confirm('Clear all notes?')) {
                document.getElementById('notesTextarea').value = '';
                saveNotes();
                showToast('All notes cleared', 'success');
                addActivity('Cleared all notes', 'fas fa-trash');
            }
        }
        
        function exportNotes() {
            const notesText = document.getElementById('notesTextarea').value;
            if (!notesText.trim()) {
                showToast('No notes to export', 'warning');
                return;
            }
            
            const blob = new Blob([notesText], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `altech-notes-${new Date().toISOString().slice(0,10)}.txt`;
            a.click();
            showToast('Notes exported!', 'success');
            addActivity('Exported notes', 'fas fa-download');
        }
        
        // ================ REMINDERS MANAGEMENT ================
        
        function handleAddReminderCommand(command) {
            let reminderText = '';
            
            if (command.includes('remind me to')) {
                reminderText = command.split('remind me to')[1]?.trim();
            } else if (command.includes('reminder for')) {
                reminderText = command.split('reminder for')[1]?.trim();
            } else if (command.includes('set alarm for')) {
                reminderText = command.split('set alarm for')[1]?.trim();
            } else if (command.includes('alert me to')) {
                reminderText = command.split('alert me to')[1]?.trim();
            }
            
            if (!reminderText) {
                reminderText = prompt("What should I remind you about?", "");
                if (!reminderText) return;
            }
            
            // Parse time
            const time = parseTimeFromCommand(command);
            addReminderFromCommand(reminderText, time);
        }
        
        function parseTimeFromCommand(command) {
            const now = new Date();
            const time = new Date(now);
            
            if (command.includes('tomorrow')) {
                time.setDate(time.getDate() + 1);
            }
            if (command.includes('next week')) {
                time.setDate(time.getDate() + 7);
            }
            if (command.includes('in 1 hour') || command.includes('in one hour')) {
                time.setHours(time.getHours() + 1);
            }
            if (command.includes('in 30 minutes')) {
                time.setMinutes(time.getMinutes() + 30);
            }
            if (command.includes('in 15 minutes')) {
                time.setMinutes(time.getMinutes() + 15);
            }
            if (command.includes('next month')) {
                time.setMonth(time.getMonth() + 1);
            }
            
            // Try to parse specific time
            const timeMatch = command.match(/(\d{1,2})(?::(\d{2}))?\s*(am|pm)?/i);
            if (timeMatch) {
                let hours = parseInt(timeMatch[1]);
                const minutes = timeMatch[2] ? parseInt(timeMatch[2]) : 0;
                const period = timeMatch[3]?.toLowerCase();
                
                if (period === 'pm' && hours < 12) hours += 12;
                if (period === 'am' && hours === 12) hours = 0;
                
                time.setHours(hours, minutes, 0, 0);
                
                // If time has passed today, set for tomorrow
                if (time < now) {
                    time.setDate(time.getDate() + 1);
                }
            }
            
            return time;
        }
        
        function addReminderFromCommand(text, time) {
            const reminder = {
                id: Date.now(),
                text: text,
                time: time.toISOString(),
                created: new Date().toISOString(),
                active: true
            };
            
            reminders.push(reminder);
            saveReminders();
            updateRemindersDisplay();
            
            const timeStr = time.toLocaleString();
            updateAIResponse(`<div class='success-message'><strong>‚è∞ Reminder Set</strong><br>${text}<br>Time: ${timeStr}</div>`);
            speakResponse(`Reminder set for ${text}`);
            showToast('Reminder set!', 'success');
            addActivity('Added reminder', 'fas fa-bell');
        }
        
        function addReminder() {
            const text = document.getElementById('reminderText').value.trim();
            const timeStr = document.getElementById('reminderTime').value;
            
            if (!text || !timeStr) {
                showToast('Please enter reminder text and time', 'error');
                return;
            }
            
            const time = new Date(timeStr);
            const reminder = {
                id: Date.now(),
                text: text,
                time: time.toISOString(),
                created: new Date().toISOString(),
                active: true
            };
            
            reminders.push(reminder);
            saveReminders();
            updateRemindersDisplay();
            
            // Clear inputs
            document.getElementById('reminderText').value = '';
            const now = new Date();
            now.setMinutes(now.getMinutes() + 30);
            document.getElementById('reminderTime').value = now.toISOString().slice(0, 16);
            
            showToast('Reminder added!', 'success');
            addActivity('Added manual reminder', 'fas fa-bell');
        }
        
        function deleteReminder(id) {
            const reminder = reminders.find(r => r.id === id);
            if (reminder && confirm('Delete this reminder?')) {
                reminders = reminders.filter(r => r.id !== id);
                saveReminders();
                updateRemindersDisplay();
                showToast('Reminder deleted', 'success');
                addActivity('Deleted reminder', 'fas fa-trash');
            }
        }
        
        // ================ SEARCH FUNCTIONALITY - FIXED ================
        
        async function handleSearchCommand(command) {
            let query = '';
            
            // Extract query based on different question types
            if (command.includes('search for')) {
                query = command.split('search for')[1]?.trim();
            } else if (command.includes('what is')) {
                query = command.split('what is')[1]?.trim();
            } else if (command.includes('how to')) {
                query = command.split('how to')[1]?.trim();
            } else if (command.includes('who is')) {
                query = command.split('who is')[1]?.trim();
            } else if (command.includes('where is')) {
                query = command.split('where is')[1]?.trim();
            } else if (command.includes('tell me about')) {
                query = command.split('tell me about')[1]?.trim();
            } else if (command.includes('explain')) {
                query = command.split('explain')[1]?.trim();
            } else if (command.includes('why')) {
                query = command.split('why')[1]?.trim();
            } else {
                query = command;
            }
            
            if (!query) {
                query = prompt("What would you like to search for?", "");
                if (!query) return;
            }
            
            await performSmartSearch(query, command);
        }
        
        async function performSmartSearch(query, originalCommand = '') {
            updateAIResponse(`<div class='ai-thinking'><span class='loading'></span> Searching for: "${query}"</div>`);
            speakResponse(`Searching for ${query}`);
            
            // Update search tab
            document.getElementById('searchQuery').value = query;
            
            // Try to get AI response first
            try {
                const aiResponse = await getAIResponse(query);
                aiResponseCount++;
                updateStats();
                
                // Create a clean, formatted response
                let cleanResponse = aiResponse.replace(/As an AI|I'm sorry|I cannot/gi, '').trim();
                if (cleanResponse.length > 300) {
                    cleanResponse = cleanResponse.substring(0, 300) + '...';
                }
                
                updateAIResponse(`
                    <div style="margin-bottom: 20px;">
                        <div class="success-message">
                            <h4 style="margin-bottom: 10px;">üîç Search Results for: "${query}"</h4>
                            <div style="background: var(--surface); padding: 20px; border-radius: 8px; margin: 15px 0; border: 1px solid var(--border);">
                                <strong>ü§ñ AI Answer:</strong>
                                <p style="margin-top: 10px; line-height: 1.6;">${cleanResponse}</p>
                            </div>
                            <div style="display: flex; gap: 15px; margin-top: 20px;">
                                <button class="btn btn-primary" onclick="window.open('https://www.google.com/search?q=${encodeURIComponent(query)}', '_blank')">
                                    <i class="fas fa-external-link-alt"></i> More on Google
                                </button>
                                <button class="btn btn-info" onclick="window.open('https://en.wikipedia.org/wiki/Special:Search?search=${encodeURIComponent(query)}', '_blank')">
                                    <i class="fab fa-wikipedia-w"></i> Wikipedia
                                </button>
                            </div>
                        </div>
                    </div>
                `);
                
                // Update search results tab
                updateSearchResults(query, cleanResponse);
                
                // Speak a shorter version
                const speakText = cleanResponse.length > 100 ? cleanResponse.substring(0, 100) + '...' : cleanResponse;
                speakResponse(speakText);
                
                addActivity(`Searched: ${query}`, 'fas fa-search');
                
            } catch (error) {
                console.error('AI search error:', error);
                // Fallback to regular search
                const fallbackResponse = getLocalAIResponse(query);
                updateAIResponse(`
                    <div class="info-message">
                        <h4>üîç Search Results for: "${query}"</h4>
                        <p>${fallbackResponse}</p>
                        <div style="margin-top: 15px;">
                            <button class="btn btn-primary" onclick="window.open('https://www.google.com/search?q=${encodeURIComponent(query)}', '_blank')">
                                <i class="fas fa-external-link-alt"></i> Search on Google
                            </button>
                        </div>
                    </div>
                `);
                updateSearchResults(query, fallbackResponse);
                speakResponse(fallbackResponse.substring(0, 100) + '...');
            }
        }
        
        async function performSearch() {
            const query = document.getElementById('searchQuery').value.trim();
            if (!query) {
                showToast('Please enter a search query', 'error');
                return;
            }
            
            await performSmartSearch(query);
        }
        
        function searchWikipedia() {
            const query = document.getElementById('searchQuery').value.trim();
            if (!query) {
                showToast('Please enter a search query', 'error');
                return;
            }
            
            window.open(`https://en.wikipedia.org/wiki/Special:Search?search=${encodeURIComponent(query)}`, '_blank');
            updateAIResponse(`<div class='info-message'>üìö Opening Wikipedia search for "${query}"</div>`);
            showToast('Opening Wikipedia...', 'info');
            addActivity(`Wikipedia search: ${query}`, 'fab fa-wikipedia-w');
        }
        
        function clearSearch() {
            document.getElementById('searchQuery').value = '';
            document.getElementById('searchResults').innerHTML = '<p style="text-align: center; padding: 40px; color: var(--text-secondary);">Enter a search query above</p>';
            showToast('Search cleared', 'info');
        }
        
        function updateSearchResults(query, response) {
            const container = document.getElementById('searchResults');
            container.innerHTML = `
                <h4 style="margin-bottom: 15px; color: var(--primary);">üîç Results for: "${query}"</h4>
                <div class="search-result-item">
                    <h5 style="margin-bottom: 10px; color: var(--success);"><i class="fas fa-robot"></i> AI Answer</h5>
                    <p>${response}</p>
                    <div style="margin-top: 15px; display: flex; gap: 10px;">
                        <button class="btn btn-primary" style="padding: 8px 15px; font-size: 0.9em;" onclick="window.open('https://www.google.com/search?q=${encodeURIComponent(query)}', '_blank')">
                            <i class="fas fa-external-link-alt"></i> Google Search
                        </button>
                        <button class="btn btn-info" style="padding: 8px 15px; font-size: 0.9em;" onclick="window.open('https://en.wikipedia.org/wiki/Special:Search?search=${encodeURIComponent(query)}', '_blank')">
                            <i class="fab fa-wikipedia-w"></i> Wikipedia
                        </button>
                    </div>
                </div>
                <div class="search-result-item">
                    <h5 style="margin-bottom: 10px; color: var(--info);"><i class="fas fa-lightbulb"></i> Related Searches</h5>
                    <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 10px;">
                        <span class="command-chip" onclick="testCommand('${query} definition')">Definition</span>
                        <span class="command-chip" onclick="testCommand('History of ${query}')">History</span>
                        <span class="command-chip" onclick="testCommand('Examples of ${query}')">Examples</span>
                        <span class="command-chip" onclick="testCommand('Latest news about ${query}')">News</span>
                    </div>
                </div>
            `;
        }
        
        // ================ WEATHER FUNCTIONALITY ================
        
        function handleWeatherCommand(command) {
            let location = '';
            
            if (command.includes('weather in')) {
                location = command.split('weather in')[1]?.trim();
            } else if (command.includes('weather at')) {
                location = command.split('weather at')[1]?.trim();
            } else if (command.includes('forecast for')) {
                location = command.split('forecast for')[1]?.trim();
            } else {
                location = prompt("Which location?", "Nairobi");
            }
            
            if (location) {
                getWeather(location);
            } else {
                getWeather('your current location');
            }
        }
        
        async function getWeather(location) {
            updateAIResponse(`<div class='ai-thinking'><span class='loading'></span> Getting weather for ${location}...</div>`);
            speakResponse(`Checking weather for ${location}`);
            
            // For demo, create realistic weather data
            setTimeout(() => {
                const weatherData = generateWeatherData(location);
                
                updateAIResponse(`
                    <div class="weather-display">
                        <h4 style="margin-bottom: 15px;">üå§Ô∏è Weather for ${weatherData.location}</h4>
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; margin: 20px 0;">
                            <div style="text-align: center;">
                                <div style="font-size: 3em; margin-bottom: 10px;">${weatherData.temperature}¬∞C</div>
                                <div>Temperature</div>
                            </div>
                            <div style="text-align: center;">
                                <div style="font-size: 2em; margin-bottom: 10px;">${weatherData.condition}</div>
                                <div>Condition</div>
                            </div>
                            <div style="text-align: center;">
                                <div style="font-size: 1.5em; margin-bottom: 5px;">${weatherData.humidity}%</div>
                                <div>Humidity</div>
                            </div>
                            <div style="text-align: center;">
                                <div style="font-size: 1.5em; margin-bottom: 5px;">${weatherData.wind} km/h</div>
                                <div>Wind Speed</div>
                            </div>
                        </div>
                        <p style="margin-top: 15px; font-style: italic;">${weatherData.description}</p>
                        <div style="margin-top: 20px;">
                            <button class="btn" onclick="window.open('https://www.google.com/search?q=weather+${encodeURIComponent(location)}', '_blank')" style="background: white; color: var(--primary-dark);">
                                <i class="fas fa-external-link-alt"></i> More Details
                            </button>
                        </div>
                    </div>
                `);
                
                speakResponse(`Weather in ${location}: ${weatherData.temperature} degrees Celsius, ${weatherData.condition.toLowerCase()}. ${weatherData.description}`);
                addActivity(`Checked weather: ${location}`, 'fas fa-cloud-sun');
            }, 1500);
        }
        
        function generateWeatherData(location) {
            const conditions = [
                { name: 'Sunny', desc: 'Clear skies with plenty of sunshine' },
                { name: 'Partly Cloudy', desc: 'Mix of sun and clouds' },
                { name: 'Cloudy', desc: 'Overcast with no direct sunlight' },
                { name: 'Rainy', desc: 'Light to moderate rainfall expected' },
                { name: 'Stormy', desc: 'Thunderstorms possible' },
                { name: 'Snowy', desc: 'Light snowfall expected' },
                { name: 'Foggy', desc: 'Reduced visibility due to fog' }
            ];
            
            const condition = conditions[Math.floor(Math.random() * conditions.length)];
            const hour = new Date().getHours();
            const isDaytime = hour >= 6 && hour < 18;
            
            return {
                location: location,
                temperature: Math.floor(Math.random() * 35) + 10,
                condition: condition.name,
                humidity: Math.floor(Math.random() * 70) + 30,
                wind: Math.floor(Math.random() * 40) + 5,
                description: isDaytime ? condition.desc : condition.desc + ' at night'
            };
        }
        
        // ================ TIME FUNCTIONALITY ================
        
        function handleTimeCommand() {
            const now = new Date();
            const timeStr = now.toLocaleTimeString('en-US', { 
                hour: '2-digit', 
                minute: '2-digit',
                second: '2-digit',
                hour12: true 
            });
            const dateStr = now.toLocaleDateString('en-US', { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });
            
            updateAIResponse(`
                <div class="info-message">
                    <h4>üïí Current Time</h4>
                    <div style="text-align: center; padding: 20px;">
                        <div style="font-size: 2.5em; font-weight: bold; color: var(--primary); margin-bottom: 10px;">${timeStr}</div>
                        <div style="font-size: 1.2em; color: var(--text-secondary);">${dateStr}</div>
                    </div>
                </div>
            `);
            speakResponse(`The time is ${timeStr} on ${dateStr}`);
            addActivity('Checked time', 'fas fa-clock');
        }
        
        // ================ AI RESPONSES ================
        
        async function handleAIQuestion(question) {
            aiResponseCount++;
            updateStats();
            
            updateAIResponse('<div class="ai-thinking"><span class="loading"></span> Thinking about your question...</div>');
            
            try {
                const response = await getAIResponse(question);
                updateAIResponse(`
                    <div style="margin-bottom: 20px;">
                        <div class="success-message">
                            <h4 style="margin-bottom: 10px;">ü§ñ Question: "${question}"</h4>
                            <div style="background: var(--surface); padding: 20px; border-radius: 8px; margin: 15px 0; border: 1px solid var(--border);">
                                <strong>üí° Answer:</strong>
                                <p style="margin-top: 10px; line-height: 1.6;">${response}</p>
                            </div>
                            <button class="btn btn-primary" onclick="testCommand('Search for ${question}')">
                                <i class="fas fa-search"></i> Search More
                            </button>
                        </div>
                    </div>
                `);
                
                const speakText = response.length > 100 ? response.substring(0, 100) + '...' : response;
                speakResponse(speakText);
                addActivity(`AI question: ${question.substring(0, 30)}...`, 'fas fa-question');
                
            } catch (error) {
                console.error('AI error:', error);
                const fallback = getLocalAIResponse(question);
                updateAIResponse(`
                    <div class="info-message">
                        <h4>ü§ñ Question: "${question}"</h4>
                        <p>${fallback}</p>
                    </div>
                `);
                speakResponse("Here's what I can tell you about that.");
            }
        }
        
        async function getAIResponse(query) {
            if (!aiEnabled) {
                return "AI responses are currently disabled. Enable AI using the brain icon in the header.";
            }
            
            // Try multiple free AI endpoints
            const endpoints = [
                {
                    url: 'https://api.deepinfra.com/v1/inference/meta-llama/Llama-2-70b-chat-hf',
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer dc2bc3e2cdd2c6ccad9f5df96d0df850c4e284b7'
                    },
                    body: {
                        input: `Please provide a clear, concise answer to: "${query}"`,
                        max_new_tokens: 200
                    }
                },
                {
                    url: 'https://free.churchless.tech/v1/chat/completions',
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: {
                        model: "gpt-3.5-turbo",
                        messages: [{ role: "user", content: query }],
                        max_tokens: 250,
                        temperature: 0.7
                    }
                }
            ];
            
            for (const endpoint of endpoints) {
                try {
                    console.log(`Trying endpoint: ${endpoint.url}`);
                    const response = await fetch(endpoint.url, {
                        method: endpoint.method,
                        headers: endpoint.headers,
                        body: JSON.stringify(endpoint.body)
                    });
                    
                    if (response.ok) {
                        const data = await response.json();
                        console.log('AI response data:', data);
                        
                        if (data.choices?.[0]?.message?.content) {
                            return data.choices[0].message.content.trim();
                        }
                        if (data.results?.[0]?.generated_text) {
                            return data.results[0].generated_text.trim();
                        }
                        if (data.generated_text) {
                            return data.generated_text.trim();
                        }
                    } else {
                        console.log(`Endpoint failed with status: ${response.status}`);
                    }
                } catch (error) {
                    console.log(`Endpoint error: ${error.message}`);
                    continue;
                }
            }
            
            // Fallback to local responses
            return getLocalAIResponse(query);
        }
        
        function getLocalAIResponse(query) {
            const lowerQuery = query.toLowerCase();
            
            // Enhanced knowledge base
            const knowledgeBase = {
                greetings: [
                    "Hello! I'm your ALTECH AI Assistant. How can I help you today?",
                    "Hi there! I'm ready to assist you with notes, reminders, search, and more!",
                    "Hey! What can I do for you today? I can help with various tasks."
                ],
                ai: "Artificial Intelligence (AI) refers to computer systems that can perform tasks that normally require human intelligence, like understanding language, recognizing images, or making decisions. AI is transforming many industries.",
                weather: "I can check weather for any location. Just say 'weather in [city name]' or 'what's the weather like?'",
                note: "To add a note, say 'Add note [your note]' or type in the Notes tab. Notes auto-save every 30 seconds.",
                reminder: "To set a reminder, say 'Remind me to [task] [time]' or use the Reminders tab. I'll notify you when it's time.",
                search: "I can search the web and provide answers. Try 'Search for [topic]' or ask me any question.",
                time: `The current time is ${new Date().toLocaleTimeString()}.`,
                date: `Today is ${new Date().toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}.`,
                help: "I can help with: üìù Notes, ‚è∞ Reminders, üîç Web search, üå§Ô∏è Weather, üë• Contacts, and answering questions! Try voice commands or click the buttons.",
                capabilities: "I understand natural language. Try: 'Add note meeting tomorrow', 'Remind me to call mom', 'Search for AI news', or 'What's the weather like?'",
                thank: "You're welcome! Is there anything else I can help you with?",
                bye: "Goodbye! Have a great day! Feel free to come back anytime."
            };
            
            // Pattern matching
            if (/(hello|hi|hey|greetings)/.test(lowerQuery)) {
                return knowledgeBase.greetings[Math.floor(Math.random() * knowledgeBase.greetings.length)];
            }
            if (/(artificial intelligence|what is ai|about ai)/.test(lowerQuery)) {
                return knowledgeBase.ai;
            }
            if (/(weather|forecast|temperature)/.test(lowerQuery)) {
                return knowledgeBase.weather;
            }
            if (/(note|notes)/.test(lowerQuery)) {
                return knowledgeBase.note;
            }
            if (/(remind|reminder|alarm)/.test(lowerQuery)) {
                return knowledgeBase.reminder;
            }
            if (/(search|find|look up)/.test(lowerQuery)) {
                return knowledgeBase.search;
            }
            if (/(time|what time|current time)/.test(lowerQuery)) {
                return knowledgeBase.time;
            }
            if (/(date|today|what date)/.test(lowerQuery)) {
                return knowledgeBase.date;
            }
            if (/(help|what can you do|capabilities)/.test(lowerQuery)) {
                return knowledgeBase.capabilities;
            }
            if (/(thank you|thanks)/.test(lowerQuery)) {
                return knowledgeBase.thank;
            }
            if (/(goodbye|bye|see you)/.test(lowerQuery)) {
                return knowledgeBase.bye;
            }
            
            // Generic response for other queries
            return `I understand you're asking about "${query}". I can search for more detailed information about this topic or you can ask me more specific questions.`;
        }
        
        // ================ QUICK ACTIONS ================
        
        function quickAction(action) {
            switch(action) {
                case 'add_contact':
                    showAddContactModal();
                    break;
                case 'add_note':
                    const note = prompt("Enter your note:", "");
                    if (note) addNote(note);
                    break;
                case 'add_reminder':
                    openTab('reminders');
                    setTimeout(() => document.getElementById('reminderText').focus(), 100);
                    break;
                case 'search_web':
                    const search = prompt("What to search for?", "");
                    if (search) performSmartSearch(search);
                    break;
                case 'check_weather':
                    const location = prompt("Weather location?", "Nairobi");
                    if (location) getWeather(location);
                    break;
                case 'ask_ai':
                    const question = prompt("Ask me anything:", "");
                    if (question) handleAIQuestion(question);
                    break;
            }
        }
        
        // ================ UI UPDATES ================
        
        function openTab(tabId) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Remove active from all buttons
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Show selected tab
            document.getElementById(tabId).classList.add('active');
            
            // Add active to clicked button
            event.target.classList.add('active');
            
            // Focus appropriate field
            setTimeout(() => {
                if (tabId === 'search') {
                    document.getElementById('searchQuery').focus();
                } else if (tabId === 'notes') {
                    document.getElementById('notesTextarea').focus();
                } else if (tabId === 'reminders') {
                    document.getElementById('reminderText').focus();
                }
            }, 100);
        }
        
        function updateContactsDisplay() {
            const container = document.getElementById('contactsList');
            
            if (contacts.length === 0) {
                container.innerHTML = '<p style="text-align: center; padding: 40px; color: var(--text-secondary);">No contacts yet. Add your first contact!</p>';
                return;
            }
            
            container.innerHTML = contacts.map(contact => `
                <div class="contact-item">
                    <div>
                        <strong style="font-size: 1.1em; color: var(--text);">${contact.name}</strong><br>
                        <span style="color: var(--text-secondary);">üìû ${formatPhone(contact.phone)}</span>
                        ${contact.email ? `<br><span style="color: var(--text-secondary);">üìß ${contact.email}</span>` : ''}
                        ${contact.group ? `<br><span style="background: var(--primary); color: white; padding: 3px 10px; border-radius: 12px; font-size: 0.8em; display: inline-block; margin-top: 5px;">${contact.group}</span>` : ''}
                    </div>
                    <div class="contact-actions">
                        <button class="contact-btn call" onclick="testCommand('Call ${contact.name}')" title="Call">
                            <i class="fas fa-phone"></i>
                        </button>
                        <button class="contact-btn delete" onclick="deleteContact(${contact.id})" title="Delete">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            `).join('');
            
            updateStats();
        }
        
        function updateNotesDisplay() {
            const container = document.getElementById('notesList');
            const notesText = document.getElementById('notesTextarea').value;
            
            if (!notesText.trim()) {
                container.innerHTML = '<p style="text-align: center; padding: 40px; color: var(--text-secondary);">No notes yet. Start typing above!</p>';
                return;
            }
            
            // Show last 5 notes
            const lines = notesText.split('\n').filter(line => line.trim());
            const recentNotes = lines.slice(0, 5);
            
            container.innerHTML = recentNotes.map(note => `
                <div class="note-item">
                    <p style="color: var(--text);">${note}</p>
                </div>
            `).join('');
            
            updateStats();
        }
        
        function updateRemindersDisplay() {
            const container = document.getElementById('remindersList');
            const now = new Date();
            
            if (reminders.length === 0) {
                container.innerHTML = '<p style="text-align: center; padding: 40px; color: var(--text-secondary);">No reminders scheduled</p>';
                return;
            }
            
            const activeReminders = reminders.filter(r => r.active);
            
            if (activeReminders.length === 0) {
                container.innerHTML = '<p style="text-align: center; padding: 40px; color: var(--text-secondary);">No active reminders</p>';
                return;
            }
            
            container.innerHTML = activeReminders.map(reminder => {
                const time = new Date(reminder.time);
                const isDue = time <= now;
                const timeDiff = time - now;
                const hoursLeft = Math.floor(timeDiff / (1000 * 60 * 60));
                
                return `
                    <div class="reminder-item ${isDue ? 'due' : ''}">
                        <p style="color: var(--text);"><strong>${reminder.text}</strong></p>
                        <p style="color: var(--text-secondary); margin-top: 10px;">
                            <i class="fas fa-clock"></i> ${time.toLocaleString()}
                            ${hoursLeft > 0 ? `<span style="margin-left: 10px; background: var(--info); color: white; padding: 2px 8px; border-radius: 10px; font-size: 0.8em;">${hoursLeft}h left</span>` : ''}
                        </p>
                        <button onclick="deleteReminder(${reminder.id})" style="margin-top: 10px; padding: 8px 15px; background: var(--danger); color: white; border: none; border-radius: 8px; cursor: pointer;">
                            <i class="fas fa-trash"></i> Delete
                        </button>
                    </div>
                `;
            }).join('');
            
            updateStats();
        }
        
        function updateStats() {
            document.getElementById('contactCount').textContent = contacts.length;
            document.getElementById('noteCount').textContent = document.getElementById('notesTextarea').value.split('\n').filter(l => l.trim()).length;
            document.getElementById('reminderCount').textContent = reminders.filter(r => r.active).length;
            document.getElementById('aiCount').textContent = aiResponseCount;
        }
        
        function updateAIResponse(html) {
            document.getElementById('aiOutput').innerHTML = html;
        }
        
        function addToHistory(command) {
            // This function would normally save command history
            // Currently handled by activity log
        }
        
        function addActivity(text, icon) {
            const activity = {
                text: text,
                icon: icon,
                time: new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})
            };
            
            activityLog.unshift(activity);
            if (activityLog.length > 5) {
                activityLog = activityLog.slice(0, 5);
            }
            
            // Update activity display
            const container = document.getElementById('activityLog');
            container.innerHTML = activityLog.map(act => `
                <div class="activity-item">
                    <div class="activity-icon">
                        <i class="${act.icon}"></i>
                    </div>
                    <div>
                        <div>${act.text}</div>
                        <small style="color: var(--text-secondary);">${act.time}</small>
                    </div>
                </div>
            `).join('');
        }
        
        // ================ DATA MANAGEMENT ================
        
        function loadAllData() {
            // Load contacts
            const savedContacts = localStorage.getItem('altech_contacts');
            contacts = savedContacts ? JSON.parse(savedContacts) : [];
            
            // Load notes
            const savedNotes = localStorage.getItem('altech_notes');
            document.getElementById('notesTextarea').value = savedNotes || '';
            
            // Load reminders
            const savedReminders = localStorage.getItem('altech_reminders');
            reminders = savedReminders ? JSON.parse(savedReminders) : [];
            
            // Load AI count
            aiResponseCount = parseInt(localStorage.getItem('altech_ai_count') || '0');
            
            // Load activity log
            const savedActivity = localStorage.getItem('altech_activity');
            activityLog = savedActivity ? JSON.parse(savedActivity) : [];
            
            // Update displays
            updateContactsDisplay();
            updateNotesDisplay();
            updateRemindersDisplay();
            updateStats();
            
            // Update activity display
            if (activityLog.length > 0) {
                const container = document.getElementById('activityLog');
                container.innerHTML = activityLog.map(act => `
                    <div class="activity-item">
                        <div class="activity-icon">
                            <i class="${act.icon}"></i>
                        </div>
                        <div>
                            <div>${act.text}</div>
                            <small style="color: var(--text-secondary);">${act.time}</small>
                        </div>
                    </div>
                `).join('');
            }
        }
        
        function saveContacts() {
            localStorage.setItem('altech_contacts', JSON.stringify(contacts));
            updateStats();
        }
        
        function saveNotes() {
            localStorage.setItem('altech_notes', document.getElementById('notesTextarea').value);
            updateStats();
        }
        
        function saveReminders() {
            localStorage.setItem('altech_reminders', JSON.stringify(reminders));
            updateStats();
        }
        
        function saveActivity() {
            localStorage.setItem('altech_activity', JSON.stringify(activityLog));
            localStorage.setItem('altech_ai_count', aiResponseCount.toString());
        }
        
        // ================ UTILITY FUNCTIONS ================
        
        function showToast(message, type = 'info') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.style.background = type === 'error' ? 'var(--danger)' : 
                                  type === 'success' ? 'var(--success)' : 
                                  type === 'warning' ? 'var(--warning)' : 'var(--primary)';
            toast.style.display = 'block';
            
            setTimeout(() => {
                toast.style.display = 'none';
            }, 3000);
        }
        
        function speakResponse(text) {
            if (!text || !('speechSynthesis' in window)) return;
            
            try {
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.rate = 1.0;
                utterance.pitch = 1.0;
                utterance.volume = 1.0;
                window.speechSynthesis.speak(utterance);
            } catch (error) {
                console.error('Speech synthesis error:', error);
            }
        }
        
        function setupAutoSave() {
            // Auto-save notes every 30 seconds
            setInterval(() => {
                if (document.getElementById('notesTextarea').value.trim()) {
                    saveNotes();
                }
            }, 30000);
            
            // Auto-save other data every minute
            setInterval(() => {
                saveContacts();
                saveReminders();
                saveActivity();
            }, 60000);
        }
        
        function setupReminderChecks() {
            // Check reminders every minute
            setInterval(() => {
                const now = new Date();
                let dueReminders = 0;
                
                reminders.forEach(reminder => {
                    if (reminder.active) {
                        const time = new Date(reminder.time);
                        const timeDiff = time - now;
                        
                        // Check if reminder is due (within 1 minute)
                        if (timeDiff > 0 && timeDiff < 60000) {
                            dueReminders++;
                            showToast(`‚è∞ Reminder: ${reminder.text}`, 'warning');
                            speakResponse(`Reminder: ${reminder.text}`);
                            reminder.active = false;
                            addActivity(`Reminder: ${reminder.text}`, 'fas fa-bell');
                        }
                    }
                });
                
                if (dueReminders > 0) {
                    saveReminders();
                    updateRemindersDisplay();
                }
            }, 60000);
        }
        
        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            // Ctrl/Cmd + / to focus search
            if ((e.ctrlKey || e.metaKey) && e.key === '/') {
                e.preventDefault();
                openTab('search');
            }
            
            // Ctrl/Cmd + N for new note
            if ((e.ctrlKey || e.metaKey) && e.key === 'n') {
                e.preventDefault();
                openTab('notes');
            }
            
            // Ctrl/Cmd + R for reminders
            if ((e.ctrlKey || e.metaKey) && e.key === 'r') {
                e.preventDefault();
                openTab('reminders');
            }
            
            // Ctrl/Cmd + C for contacts
            if ((e.ctrlKey || e.metaKey) && e.key === 'c') {
                e.preventDefault();
                openTab('contacts');
            }
            
            // Escape to close modals
            if (e.key === 'Escape') {
                closeModal('addContactModal');
            }
            
            // Space to start/stop listening
            if (e.key === ' ' && !e.target.matches('input, textarea')) {
                e.preventDefault();
                toggleListening();
            }
        });
        
        // Initialize with a welcome message in activity log
        activityLog.push({
            text: 'AI Assistant Ready',
            icon: 'fas fa-robot',
            time: new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})
        });
        
        console.log('‚úÖ ALTECH AI Assistant fully loaded and ready!');
    </script>
</body>
</html>
