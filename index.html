<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#007bff">
    <title>ALTECH AI - Advanced Assistant</title>
    <link rel="manifest" href="manifest.json">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* ================ CSS VARIABLES ================ */
        :root {
            --primary: #007bff;
            --primary-dark: #0056b3;
            --primary-light: #3298fe;
            --secondary: #6c757d;
            --success: #28a745;
            --danger: #dc3545;
            --warning: #ffc107;
            --info: #17a2b8;
            --dark: #343a40;
            --light: #f8f9fa;
            --white: #ffffff;
            --black: #212529;
            
            --bg-color: #ffffff;
            --surface: #f8f9fa;
            --text: #212529;
            --text-secondary: #6c757d;
            --border: #dee2e6;
            --shadow: rgba(0, 0, 0, 0.1);
            --radius: 12px;
            --radius-sm: 8px;
            --radius-lg: 20px;
            --transition: all 0.3s ease;
            
            --header-height: 70px;
            --bottom-nav-height: 65px;
        }
        
        .dark-mode {
            --primary: #3298fe;
            --primary-dark: #1a7ed8;
            --primary-light: #4da6fe;
            --secondary: #8a93a2;
            --success: #2bc155;
            --danger: #e74c3c;
            --warning: #f1c40f;
            --info: #3498db;
            --dark: #1a1d21;
            --light: #2d3238;
            --bg-color: #121416;
            --surface: #1a1d21;
            --text: #e9ecef;
            --text-secondary: #8a93a2;
            --border: #2d3238;
            --shadow: rgba(0, 0, 0, 0.3);
        }
        
        /* ================ RESET & BASE ================ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        html {
            font-size: 16px;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-color);
            color: var(--text);
            min-height: 100vh;
            line-height: 1.6;
            overflow-x: hidden;
            transition: var(--transition);
        }
        
        /* ================ APP CONTAINER ================ */
        .app-container {
            min-height: 100vh;
            max-width: 100%;
            overflow-x: hidden;
        }
        
        /* ================ HEADER ================ */
        .header {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            padding: 0 20px;
            height: var(--header-height);
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 4px 20px var(--shadow);
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .logo-icon {
            width: 40px;
            height: 40px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2em;
        }
        
        .logo-text {
            font-size: 1.4em;
            font-weight: 700;
            letter-spacing: -0.5px;
        }
        
        .header-controls {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .header-btn {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.15);
            border: 2px solid rgba(255, 255, 255, 0.25);
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2em;
            transition: var(--transition);
        }
        
        .header-btn:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: scale(1.05);
        }
        
        .header-btn.active {
            background: var(--success);
            border-color: var(--success);
        }
        
        /* ================ MAIN CONTENT ================ */
        .main-content {
            padding: 20px;
            padding-bottom: calc(var(--bottom-nav-height) + 30px);
            max-width: 1200px;
            margin: 0 auto;
            width: 100%;
        }
        
        /* ================ TAB SYSTEM ================ */
        .tab-system {
            background: var(--surface);
            border-radius: var(--radius-lg);
            overflow: hidden;
            border: 1px solid var(--border);
            margin-bottom: 20px;
            box-shadow: 0 5px 20px var(--shadow);
        }
        
        .tabs-header {
            display: flex;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none;
            background: var(--bg-color);
        }
        
        .tabs-header::-webkit-scrollbar {
            display: none;
        }
        
        .tab-btn {
            flex: 1;
            min-width: 90px;
            padding: 18px 15px;
            background: transparent;
            border: none;
            color: var(--text);
            font-weight: 600;
            font-size: 0.95em;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            white-space: nowrap;
            position: relative;
        }
        
        .tab-btn i {
            font-size: 1.2em;
        }
        
        .tab-btn.active {
            color: var(--primary);
        }
        
        .tab-btn.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--primary);
        }
        
        .tab-content {
            display: none;
            animation: fadeIn 0.3s ease;
        }
        
        .tab-content.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* ================ VOICE ASSISTANT ================ */
        .voice-section {
            padding: 30px 20px;
            text-align: center;
        }
        
        .voice-status {
            margin-bottom: 25px;
        }
        
        .status-text {
            font-size: 1.1em;
            color: var(--text-secondary);
            margin-bottom: 10px;
            font-weight: 600;
        }
        
        .voice-orb-container {
            position: relative;
            display: inline-block;
            margin: 20px 0;
        }
        
        .voice-orb {
            width: 140px;
            height: 140px;
            background: linear-gradient(135deg, var(--primary), var(--info));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
            border: 8px solid var(--surface);
            box-shadow: 0 15px 35px var(--shadow);
            position: relative;
            overflow: hidden;
        }
        
        .voice-orb::before {
            content: '';
            position: absolute;
            top: -10px;
            left: -10px;
            right: -10px;
            bottom: -10px;
            background: conic-gradient(transparent, var(--primary), transparent 70%);
            animation: rotate 3s linear infinite;
            border-radius: 50%;
        }
        
        @keyframes rotate {
            100% { transform: rotate(360deg); }
        }
        
        .voice-orb i {
            font-size: 3em;
            color: white;
            position: relative;
            z-index: 1;
        }
        
        .voice-orb.listening {
            background: linear-gradient(135deg, var(--danger), var(--warning));
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .transcript-display {
            background: var(--surface);
            padding: 20px;
            border-radius: var(--radius);
            margin: 25px 0;
            min-height: 100px;
            border-left: 5px solid var(--primary);
            text-align: left;
            font-size: 1.1em;
        }
        
        .ai-response {
            background: var(--surface);
            padding: 25px;
            border-radius: var(--radius);
            margin: 25px 0;
            border-left: 5px solid var(--success);
            text-align: left;
        }
        
        .ai-response h3 {
            margin-bottom: 15px;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .response-controls {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        .control-btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: var(--radius-sm);
            background: var(--primary);
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-weight: 600;
            transition: var(--transition);
        }
        
        .control-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px var(--shadow);
        }
        
        .control-btn.success {
            background: var(--success);
        }
        
        .control-btn.danger {
            background: var(--danger);
        }
        
        /* ================ QUICK ACTIONS ================ */
        .quick-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 15px;
            margin: 30px 0;
        }
        
        .action-btn {
            padding: 20px 15px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: var(--radius);
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 12px;
            font-weight: 600;
            border: 2px solid transparent;
            min-height: 120px;
            justify-content: center;
        }
        
        .action-btn i {
            font-size: 1.8em;
        }
        
        .action-btn:hover {
            background: var(--primary-dark);
            transform: translateY(-3px);
            box-shadow: 0 10px 20px var(--shadow);
            border-color: var(--primary);
        }
        
        .action-btn.success {
            background: var(--success);
        }
        
        .action-btn.success:hover {
            background: #218838;
        }
        
        .action-btn.warning {
            background: var(--warning);
            color: var(--dark);
        }
        
        .action-btn.info {
            background: var(--info);
        }
        
        /* ================ COMMAND SUGGESTIONS ================ */
        .command-suggestions {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 20px 0;
            justify-content: center;
        }
        
        .command-chip {
            padding: 12px 20px;
            background: var(--surface);
            border: 2px solid var(--primary);
            border-radius: 25px;
            cursor: pointer;
            transition: var(--transition);
            font-weight: 600;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .command-chip:hover {
            background: var(--primary);
            color: white;
            transform: translateY(-2px);
        }
        
        /* ================ CONTACTS SECTION ================ */
        .contacts-section {
            padding: 20px;
        }
        
        .contacts-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .contacts-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .contact-item {
            background: var(--surface);
            padding: 20px;
            border-radius: var(--radius);
            border: 1px solid var(--border);
            transition: var(--transition);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .contact-item:hover {
            border-color: var(--primary);
            box-shadow: 0 5px 15px var(--shadow);
            transform: translateY(-2px);
        }
        
        .contact-info {
            flex: 1;
        }
        
        .contact-name {
            font-size: 1.2em;
            font-weight: 700;
            color: var(--text);
            margin-bottom: 5px;
        }
        
        .contact-phone, .contact-email {
            color: var(--text-secondary);
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .contact-actions {
            display: flex;
            gap: 10px;
        }
        
        .contact-action-btn {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }
        
        .contact-action-btn.call {
            background: var(--success);
            color: white;
        }
        
        .contact-action-btn.message {
            background: var(--info);
            color: white;
        }
        
        .contact-action-btn.delete {
            background: var(--danger);
            color: white;
        }
        
        /* ================ NOTES SECTION ================ */
        .notes-section {
            padding: 20px;
        }
        
        .notes-editor {
            background: var(--surface);
            border-radius: var(--radius);
            padding: 20px;
            margin-bottom: 30px;
            border: 1px solid var(--border);
        }
        
        #notesTextarea {
            width: 100%;
            min-height: 200px;
            padding: 20px;
            background: var(--bg-color);
            color: var(--text);
            border: 2px solid var(--border);
            border-radius: var(--radius);
            font-size: 1em;
            font-family: inherit;
            resize: vertical;
            margin-bottom: 20px;
            transition: var(--transition);
        }
        
        #notesTextarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.1);
        }
        
        .notes-actions {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .notes-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .note-item {
            background: var(--surface);
            padding: 20px;
            border-radius: var(--radius);
            border-left: 5px solid var(--warning);
            border: 1px solid var(--border);
        }
        
        .note-date {
            font-size: 0.9em;
            color: var(--text-secondary);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        /* ================ REMINDERS SECTION ================ */
        .reminders-section {
            padding: 20px;
        }
        
        .reminder-form {
            background: var(--surface);
            padding: 25px;
            border-radius: var(--radius);
            margin-bottom: 30px;
            border: 1px solid var(--border);
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .form-control {
            width: 100%;
            padding: 15px;
            background: var(--bg-color);
            color: var(--text);
            border: 2px solid var(--border);
            border-radius: var(--radius-sm);
            font-size: 1em;
            transition: var(--transition);
        }
        
        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.1);
        }
        
        .reminders-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .reminder-item {
            background: var(--surface);
            padding: 20px;
            border-radius: var(--radius);
            border-left: 5px solid var(--warning);
            border: 1px solid var(--border);
            transition: var(--transition);
        }
        
        .reminder-item.due {
            border-left-color: var(--danger);
            background: rgba(220, 53, 69, 0.1);
            animation: shake 0.5s ease-in-out;
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        
        /* ================ SEARCH SECTION ================ */
        .search-section {
            padding: 20px;
        }
        
        .search-bar {
            position: relative;
            margin-bottom: 25px;
        }
        
        #searchInput {
            width: 100%;
            padding: 18px 20px 18px 55px;
            background: var(--surface);
            color: var(--text);
            border: 2px solid var(--border);
            border-radius: var(--radius);
            font-size: 1.1em;
            transition: var(--transition);
        }
        
        #searchInput:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.1);
        }
        
        .search-icon {
            position: absolute;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-secondary);
            font-size: 1.2em;
        }
        
        .search-results {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .search-result-item {
            background: var(--surface);
            padding: 20px;
            border-radius: var(--radius);
            border-left: 5px solid var(--info);
            border: 1px solid var(--border);
        }
        
        /* ================ BOTTOM NAVIGATION ================ */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--surface);
            border-top: 1px solid var(--border);
            height: var(--bottom-nav-height);
            display: flex;
            justify-content: space-around;
            align-items: center;
            z-index: 1000;
            padding: 0 10px;
            backdrop-filter: blur(10px);
        }
        
        .nav-btn {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
            background: none;
            border: none;
            color: var(--text-secondary);
            padding: 12px 5px;
            cursor: pointer;
            transition: var(--transition);
            border-radius: var(--radius-sm);
            min-width: 0;
        }
        
        .nav-btn i {
            font-size: 1.3em;
        }
        
        .nav-btn.active {
            color: var(--primary);
            background: rgba(var(--primary-rgb), 0.1);
        }
        
        .nav-btn-label {
            font-size: 0.8em;
            font-weight: 600;
        }
        
        /* ================ FLOATING BUTTONS ================ */
        .floating-buttons {
            position: fixed;
            bottom: calc(var(--bottom-nav-height) + 20px);
            right: 20px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            z-index: 999;
        }
        
        .floating-btn {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: var(--success);
            color: white;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5em;
            box-shadow: 0 8px 25px rgba(40, 167, 69, 0.3);
            transition: var(--transition);
        }
        
        .floating-btn:hover {
            transform: scale(1.1) translateY(-5px);
            box-shadow: 0 15px 35px rgba(40, 167, 69, 0.4);
        }
        
        .floating-btn.whatsapp {
            background: #25D366;
            box-shadow: 0 8px 25px rgba(37, 211, 102, 0.3);
        }
        
        .floating-btn.whatsapp:hover {
            box-shadow: 0 15px 35px rgba(37, 211, 102, 0.4);
        }
        
        .floating-btn.install {
            background: var(--warning);
            box-shadow: 0 8px 25px rgba(255, 193, 7, 0.3);
        }
        
        .floating-btn.install:hover {
            box-shadow: 0 15px 35px rgba(255, 193, 7, 0.4);
        }
        
        /* ================ MODALS ================ */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            padding: 20px;
            backdrop-filter: blur(5px);
        }
        
        .modal {
            background: var(--bg-color);
            padding: 30px;
            border-radius: var(--radius-lg);
            max-width: 500px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            animation: modalSlide 0.3s ease;
            border: 1px solid var(--border);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }
        
        @keyframes modalSlide {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }
        
        .modal-title {
            font-size: 1.5em;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .modal-close {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 1.5em;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .modal-close:hover {
            color: var(--danger);
        }
        
        .modal-actions {
            display: flex;
            gap: 15px;
            margin-top: 30px;
        }
        
        .btn {
            flex: 1;
            padding: 15px;
            border: none;
            border-radius: var(--radius-sm);
            cursor: pointer;
            font-weight: 600;
            font-size: 1em;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .btn-primary {
            background: var(--primary);
            color: white;
        }
        
        .btn-primary:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
        }
        
        .btn-secondary {
            background: var(--secondary);
            color: white;
        }
        
        /* ================ TOAST NOTIFICATIONS ================ */
        .toast-container {
            position: fixed;
            bottom: 20px;
            left: 20px;
            right: 20px;
            z-index: 9999;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .toast {
            background: var(--dark);
            color: white;
            padding: 18px 25px;
            border-radius: var(--radius);
            box-shadow: 0 10px 30px var(--shadow);
            animation: slideInUp 0.3s ease;
            border-left: 5px solid var(--primary);
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .toast.success {
            border-left-color: var(--success);
        }
        
        .toast.error {
            border-left-color: var(--danger);
        }
        
        .toast.warning {
            border-left-color: var(--warning);
        }
        
        .toast.info {
            border-left-color: var(--info);
        }
        
        @keyframes slideInUp {
            from { transform: translateY(100%); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        /* ================ LOADING & ANIMATIONS ================ */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid var(--border);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .typing-indicator {
            display: inline-flex;
            gap: 5px;
            align-items: center;
            padding: 15px;
            background: var(--surface);
            border-radius: var(--radius);
            border: 1px solid var(--border);
        }
        
        .typing-dot {
            width: 8px;
            height: 8px;
            background: var(--primary);
            border-radius: 50%;
            animation: bounce 1.4s infinite;
        }
        
        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }
        
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        /* ================ ACCESSIBILITY ================ */
        .accessibility-controls {
            position: fixed;
            top: 50%;
            left: 0;
            transform: translateY(-50%);
            z-index: 998;
            display: flex;
            flex-direction: column;
            gap: 10px;
            background: var(--surface);
            padding: 15px;
            border-radius: 0 var(--radius) var(--radius) 0;
            box-shadow: 5px 5px 20px var(--shadow);
            border: 1px solid var(--border);
        }
        
        .accessibility-btn {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            background: var(--primary);
            color: white;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2em;
            transition: var(--transition);
        }
        
        .accessibility-btn:hover {
            transform: scale(1.1);
        }
        
        /* ================ RESPONSIVE DESIGN ================ */
        @media (max-width: 768px) {
            html {
                font-size: 14px;
            }
            
            .header {
                padding: 0 15px;
                height: 60px;
            }
            
            .logo-text {
                font-size: 1.2em;
            }
            
            .header-btn {
                width: 40px;
                height: 40px;
                font-size: 1.1em;
            }
            
            .main-content {
                padding: 15px;
                padding-bottom: calc(var(--bottom-nav-height) + 20px);
            }
            
            .quick-actions {
                grid-template-columns: repeat(2, 1fr);
                gap: 12px;
            }
            
            .action-btn {
                min-height: 100px;
                padding: 15px;
                font-size: 0.9em;
            }
            
            .action-btn i {
                font-size: 1.5em;
            }
            
            .voice-orb {
                width: 120px;
                height: 120px;
            }
            
            .voice-orb i {
                font-size: 2.5em;
            }
            
            .bottom-nav {
                height: 60px;
            }
            
            .nav-btn i {
                font-size: 1.2em;
            }
            
            .nav-btn-label {
                font-size: 0.7em;
            }
            
            .floating-buttons {
                bottom: calc(var(--bottom-nav-height) + 15px);
                right: 15px;
            }
            
            .floating-btn {
                width: 55px;
                height: 55px;
                font-size: 1.3em;
            }
            
            .accessibility-controls {
                padding: 10px;
            }
            
            .accessibility-btn {
                width: 40px;
                height: 40px;
                font-size: 1.1em;
            }
        }
        
        @media (max-width: 480px) {
            .quick-actions {
                grid-template-columns: 1fr;
            }
            
            .tab-btn {
                min-width: 70px;
                padding: 15px 10px;
                font-size: 0.8em;
            }
            
            .tab-btn i {
                font-size: 1.1em;
            }
            
            .contacts-header {
                flex-direction: column;
                align-items: stretch;
            }
            
            .contact-item {
                flex-direction: column;
                align-items: stretch;
                gap: 15px;
            }
            
            .contact-actions {
                justify-content: center;
            }
        }
        
        /* ================ UTILITY CLASSES ================ */
        .text-center { text-align: center; }
        .text-right { text-align: right; }
        .mt-1 { margin-top: 10px; }
        .mt-2 { margin-top: 20px; }
        .mt-3 { margin-top: 30px; }
        .mb-1 { margin-bottom: 10px; }
        .mb-2 { margin-bottom: 20px; }
        .mb-3 { margin-bottom: 30px; }
        .d-none { display: none !important; }
        .d-flex { display: flex !important; }
        .d-block { display: block !important; }
        .flex-1 { flex: 1; }
        .w-100 { width: 100%; }
        
        .error-message {
            background: rgba(220, 53, 69, 0.1);
            color: var(--danger);
            padding: 15px;
            border-radius: var(--radius);
            margin: 10px 0;
            border: 1px solid var(--danger);
        }
        
        .success-message {
            background: rgba(40, 167, 69, 0.1);
            color: var(--success);
            padding: 15px;
            border-radius: var(--radius);
            margin: 10px 0;
            border: 1px solid var(--success);
        }
        
        .info-message {
            background: rgba(23, 162, 184, 0.1);
            color: var(--info);
            padding: 15px;
            border-radius: var(--radius);
            margin: 10px 0;
            border: 1px solid var(--info);
        }
        
        .warning-message {
            background: rgba(255, 193, 7, 0.1);
            color: var(--warning);
            padding: 15px;
            border-radius: var(--radius);
            margin: 10px 0;
            border: 1px solid var(--warning);
        }
        
        /* ================ PWA INSTALL BANNER ================ */
        .pwa-install-banner {
            position: fixed;
            bottom: calc(var(--bottom-nav-height) + 20px);
            left: 20px;
            right: 20px;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            padding: 20px;
            border-radius: var(--radius);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            z-index: 997;
            display: none;
            animation: slideInUp 0.5s ease;
        }
        
        .install-banner-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 15px;
        }
        
        .install-banner-text h4 {
            margin-bottom: 5px;
        }
        
        .install-banner-text p {
            font-size: 0.9em;
            opacity: 0.9;
        }
        
        .install-banner-actions {
            display: flex;
            gap: 10px;
        }
    </style>
</head>
<body class="light-mode">
    <!-- App Container -->
    <div class="app-container">
        <!-- Header -->
        <header class="header">
            <div class="logo">
                <div class="logo-icon">
                    <i class="fas fa-robot"></i>
                </div>
                <div class="logo-text">ALTECH AI</div>
            </div>
            
            <div class="header-controls">
                <button class="header-btn" id="themeToggle" title="Toggle Theme">
                    <i class="fas fa-moon"></i>
                </button>
                <button class="header-btn active" id="aiToggle" title="Toggle AI">
                    <i class="fas fa-brain"></i>
                </button>
            </div>
        </header>
        
        <!-- Main Content -->
        <main class="main-content">
            <!-- Tab System -->
            <div class="tab-system">
                <div class="tabs-header">
                    <button class="tab-btn active" data-tab="assistant">
                        <i class="fas fa-robot"></i>
                        <span>Assistant</span>
                    </button>
                    <button class="tab-btn" data-tab="contacts">
                        <i class="fas fa-users"></i>
                        <span>Contacts</span>
                    </button>
                    <button class="tab-btn" data-tab="notes">
                        <i class="fas fa-sticky-note"></i>
                        <span>Notes</span>
                    </button>
                    <button class="tab-btn" data-tab="reminders">
                        <i class="fas fa-bell"></i>
                        <span>Reminders</span>
                    </button>
                    <button class="tab-btn" data-tab="search">
                        <i class="fas fa-search"></i>
                        <span>Search</span>
                    </button>
                </div>
                
                <!-- Assistant Tab -->
                <div id="assistant" class="tab-content active">
                    <div class="voice-section">
                        <div class="voice-status">
                            <div class="status-text" id="statusText">Click microphone and speak your command</div>
                        </div>
                        
                        <div class="voice-orb-container">
                            <div class="voice-orb" id="voiceOrb">
                                <i class="fas fa-microphone"></i>
                            </div>
                        </div>
                        
                        <div class="transcript-display" id="transcript">
                            <strong>Try saying:</strong><br>
                            • "Call John"<br>
                            • "Add note meeting tomorrow at 3 PM"<br>
                            • "Remind me to call mom in 1 hour"<br>
                            • "What is artificial intelligence?"<br>
                            • "Weather in Nairobi"<br>
                            • "Search for latest tech news"
                        </div>
                        
                        <div class="ai-response" id="aiResponse">
                            <h3><i class="fas fa-brain"></i> AI Response</h3>
                            <div id="aiOutput">
                                <div class="typing-indicator">
                                    <div class="typing-dot"></div>
                                    <div class="typing-dot"></div>
                                    <div class="typing-dot"></div>
                                </div>
                                <span>Initializing AI Assistant... Ready to help!</span>
                            </div>
                            <div class="response-controls">
                                <button class="control-btn" onclick="speakCurrentResponse()">
                                    <i class="fas fa-volume-up"></i> Read
                                </button>
                                <button class="control-btn success" onclick="copyToClipboard('aiOutput')">
                                    <i class="fas fa-copy"></i> Copy
                                </button>
                                <button class="control-btn danger" onclick="clearResponse()">
                                    <i class="fas fa-times"></i> Clear
                                </button>
                            </div>
                        </div>
                        
                        <div class="quick-actions" id="quickActions">
                            <!-- Will be populated by JavaScript -->
                        </div>
                        
                        <div class="command-suggestions">
                            <div class="command-chip" onclick="testCommand('Call John')">
                                <i class="fas fa-phone"></i> Call
                            </div>
                            <div class="command-chip" onclick="testCommand('Add note meeting tomorrow')">
                                <i class="fas fa-edit"></i> Add Note
                            </div>
                            <div class="command-chip" onclick="testCommand('Remind me to call mom')">
                                <i class="fas fa-bell"></i> Set Reminder
                            </div>
                            <div class="command-chip" onclick="testCommand('What is AI?')">
                                <i class="fas fa-question"></i> Ask Question
                            </div>
                            <div class="command-chip" onclick="testCommand('Weather in London')">
                                <i class="fas fa-cloud-sun"></i> Check Weather
                            </div>
                            <div class="command-chip" onclick="testCommand('Search for JavaScript')">
                                <i class="fas fa-search"></i> Search Web
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Contacts Tab -->
                <div id="contacts" class="tab-content">
                    <div class="contacts-section">
                        <div class="contacts-header">
                            <h3><i class="fas fa-users"></i> Contacts</h3>
                            <div>
                                <button class="btn btn-primary" onclick="showAddContactModal()">
                                    <i class="fas fa-user-plus"></i> Add Contact
                                </button>
                                <button class="btn btn-secondary" onclick="importRealContacts()">
                                    <i class="fas fa-mobile-alt"></i> Import Contacts
                                </button>
                            </div>
                        </div>
                        
                        <div class="contacts-list" id="contactsList">
                            <!-- Contacts will be populated by JavaScript -->
                        </div>
                    </div>
                </div>
                
                <!-- Notes Tab -->
                <div id="notes" class="tab-content">
                    <div class="notes-section">
                        <div class="notes-editor">
                            <h3><i class="fas fa-edit"></i> Quick Note</h3>
                            <textarea id="notesTextarea" placeholder="Type your note here or use voice command... (Auto-saves every 30 seconds)"></textarea>
                            <div class="notes-actions">
                                <button class="btn btn-primary" onclick="saveNote()">
                                    <i class="fas fa-save"></i> Save Note
                                </button>
                                <button class="btn btn-success" onclick="addVoiceNote()">
                                    <i class="fas fa-microphone"></i> Voice Note
                                </button>
                                <button class="btn btn-secondary" onclick="clearNotes()">
                                    <i class="fas fa-trash"></i> Clear
                                </button>
                                <button class="btn btn-info" onclick="exportNotes()">
                                    <i class="fas fa-download"></i> Export
                                </button>
                            </div>
                        </div>
                        
                        <h3><i class="fas fa-history"></i> Recent Notes</h3>
                        <div class="notes-list" id="notesList">
                            <!-- Notes will be populated by JavaScript -->
                        </div>
                    </div>
                </div>
                
                <!-- Reminders Tab -->
                <div id="reminders" class="tab-content">
                    <div class="reminders-section">
                        <div class="reminder-form">
                            <h3><i class="fas fa-bell"></i> New Reminder</h3>
                            <div class="form-group">
                                <label class="form-label">
                                    <i class="fas fa-comment"></i> Reminder Text
                                </label>
                                <input type="text" id="reminderText" class="form-control" placeholder="What should I remind you about?">
                            </div>
                            <div class="form-group">
                                <label class="form-label">
                                    <i class="fas fa-calendar-alt"></i> Date & Time
                                </label>
                                <input type="datetime-local" id="reminderTime" class="form-control">
                            </div>
                            <button class="btn btn-primary w-100" onclick="addReminder()">
                                <i class="fas fa-plus"></i> Add Reminder
                            </button>
                        </div>
                        
                        <h3><i class="fas fa-clock"></i> Upcoming Reminders</h3>
                        <div class="reminders-list" id="remindersList">
                            <!-- Reminders will be populated by JavaScript -->
                        </div>
                    </div>
                </div>
                
                <!-- Search Tab -->
                <div id="search" class="tab-content">
                    <div class="search-section">
                        <div class="search-bar">
                            <i class="fas fa-search search-icon"></i>
                            <input type="text" id="searchInput" class="form-control" 
                                   placeholder="Ask anything or search the web..." 
                                   onkeypress="if(event.key === 'Enter') performSearch()">
                        </div>
                        
                        <div class="search-actions mb-3">
                            <div class="quick-actions">
                                <button class="action-btn" onclick="searchWithProvider('google')">
                                    <i class="fab fa-google"></i>
                                    <span>Google</span>
                                </button>
                                <button class="action-btn info" onclick="searchWithProvider('wikipedia')">
                                    <i class="fab fa-wikipedia-w"></i>
                                    <span>Wikipedia</span>
                                </button>
                                <button class="action-btn success" onclick="searchWithProvider('youtube')">
                                    <i class="fab fa-youtube"></i>
                                    <span>YouTube</span>
                                </button>
                                <button class="action-btn warning" onclick="searchWithProvider('news')">
                                    <i class="fas fa-newspaper"></i>
                                    <span>News</span>
                                </button>
                            </div>
                        </div>
                        
                        <div class="search-results" id="searchResults">
                            <!-- Search results will be populated by JavaScript -->
                        </div>
                    </div>
                </div>
            </div>
        </main>
        
        <!-- Bottom Navigation -->
        <nav class="bottom-nav">
            <button class="nav-btn active" data-tab="assistant">
                <i class="fas fa-home"></i>
                <span class="nav-btn-label">Home</span>
            </button>
            <button class="nav-btn" data-tab="contacts">
                <i class="fas fa-users"></i>
                <span class="nav-btn-label">Contacts</span>
            </button>
            <button class="nav-btn" data-tab="notes">
                <i class="fas fa-sticky-note"></i>
                <span class="nav-btn-label">Notes</span>
            </button>
            <button class="nav-btn" data-tab="reminders">
                <i class="fas fa-bell"></i>
                <span class="nav-btn-label">Reminders</span>
            </button>
            <button class="nav-btn" data-tab="search">
                <i class="fas fa-search"></i>
                <span class="nav-btn-label">Search</span>
            </button>
        </nav>
        
        <!-- Floating Buttons -->
        <div class="floating-buttons">
            <button class="floating-btn whatsapp" id="whatsappBtn" title="Get Help on WhatsApp">
                <i class="fab fa-whatsapp"></i>
            </button>
            <button class="floating-btn install" id="installBtn" title="Install App">
                <i class="fas fa-download"></i>
            </button>
            <button class="floating-btn" id="voiceBtn" title="Voice Assistant">
                <i class="fas fa-microphone"></i>
            </button>
        </div>
        
        <!-- Accessibility Controls -->
        <div class="accessibility-controls">
            <button class="accessibility-btn" onclick="increaseFontSize()" title="Increase Text Size">
                <i class="fas fa-text-height"></i>
            </button>
            <button class="accessibility-btn" onclick="decreaseFontSize()" title="Decrease Text Size">
                <i class="fas fa-text-width"></i>
            </button>
            <button class="accessibility-btn" onclick="toggleHighContrast()" title="High Contrast">
                <i class="fas fa-adjust"></i>
            </button>
            <button class="accessibility-btn" onclick="speakCurrentResponse()" title="Read Aloud">
                <i class="fas fa-volume-up"></i>
            </button>
        </div>
        
        <!-- PWA Install Banner -->
        <div class="pwa-install-banner" id="installBanner">
            <div class="install-banner-content">
                <div class="install-banner-text">
                    <h4>Install ALTECH AI Assistant</h4>
                    <p>Get faster access, work offline, and receive notifications</p>
                </div>
                <div class="install-banner-actions">
                    <button class="btn btn-success" onclick="installPWA()">
                        <i class="fas fa-download"></i> Install
                    </button>
                    <button class="btn btn-secondary" onclick="hideInstallBanner()">
                        <i class="fas fa-times"></i> Later
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Add Contact Modal -->
        <div class="modal-overlay" id="addContactModal">
            <div class="modal">
                <div class="modal-header">
                    <h3 class="modal-title"><i class="fas fa-user-plus"></i> Add New Contact</h3>
                    <button class="modal-close" onclick="closeModal('addContactModal')">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Full Name *</label>
                    <input type="text" id="contactName" class="form-control" placeholder="Enter full name" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Phone Number *</label>
                    <input type="tel" id="contactPhone" class="form-control" placeholder="e.g., 0712345678" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Email (Optional)</label>
                    <input type="email" id="contactEmail" class="form-control" placeholder="email@example.com">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Group</label>
                    <select id="contactGroup" class="form-control">
                        <option value="">Select Group</option>
                        <option value="family">Family</option>
                        <option value="friends">Friends</option>
                        <option value="work">Work</option>
                        <option value="emergency">Emergency</option>
                    </select>
                </div>
                
                <div class="modal-actions">
                    <button class="btn btn-primary" onclick="saveContact()">
                        <i class="fas fa-save"></i> Save Contact
                    </button>
                    <button class="btn btn-secondary" onclick="closeModal('addContactModal')">
                        <i class="fas fa-times"></i> Cancel
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Toast Container -->
        <div class="toast-container" id="toastContainer"></div>
    </div>

    <script>
        // ================ APP STATE ================
        const appState = {
            aiEnabled: true,
            darkMode: false,
            currentTab: 'assistant',
            isListening: false,
            deferredPrompt: null,
            contacts: [],
            notes: [],
            reminders: [],
            voiceHistory: [],
            fontSize: 16,
            highContrast: false,
            ttsEnabled: true,
            notificationsEnabled: false
        };
        
        // ================ COMMAND PROCESSOR ================
        class CommandProcessor {
            constructor() {
                this.commands = {
                    // Call commands
                    'call': this.handleCallCommand.bind(this),
                    'phone': this.handleCallCommand.bind(this),
                    'dial': this.handleCallCommand.bind(this),
                    'ring': this.handleCallCommand.bind(this),
                    
                    // Note commands
                    'note': this.handleNoteCommand.bind(this),
                    'write': this.handleNoteCommand.bind(this),
                    'remember': this.handleNoteCommand.bind(this),
                    'record': this.handleNoteCommand.bind(this),
                    
                    // Reminder commands
                    'remind': this.handleReminderCommand.bind(this),
                    'reminder': this.handleReminderCommand.bind(this),
                    'alarm': this.handleReminderCommand.bind(this),
                    'alert': this.handleReminderCommand.bind(this),
                    'notify': this.handleReminderCommand.bind(this),
                    
                    // Search commands
                    'search': this.handleSearchCommand.bind(this),
                    'find': this.handleSearchCommand.bind(this),
                    'look up': this.handleSearchCommand.bind(this),
                    'what is': this.handleSearchCommand.bind(this),
                    'who is': this.handleSearchCommand.bind(this),
                    'where is': this.handleSearchCommand.bind(this),
                    'how to': this.handleSearchCommand.bind(this),
                    'explain': this.handleSearchCommand.bind(this),
                    
                    // Weather commands
                    'weather': this.handleWeatherCommand.bind(this),
                    'forecast': this.handleWeatherCommand.bind(this),
                    'temperature': this.handleWeatherCommand.bind(this),
                    'climate': this.handleWeatherCommand.bind(this),
                    
                    // Time/Date commands
                    'time': this.handleTimeCommand.bind(this),
                    'date': this.handleDateCommand.bind(this),
                    'day': this.handleDateCommand.bind(this),
                    
                    // Math commands
                    'calculate': this.handleMathCommand.bind(this),
                    'math': this.handleMathCommand.bind(this),
                    'add': this.handleMathCommand.bind(this),
                    'subtract': this.handleMathCommand.bind(this),
                    'multiply': this.handleMathCommand.bind(this),
                    'divide': this.handleMathCommand.bind(this),
                    
                    // General AI
                    'ai': this.handleAICommand.bind(this),
                    'ask': this.handleAICommand.bind(this),
                    'question': this.handleAICommand.bind(this),
                    'help': this.handleHelpCommand.bind(this)
                };
            }
            
            async process(command) {
                command = command.toLowerCase().trim();
                console.log('Processing command:', command);
                
                // Check for exact matches first
                for (const [keyword, handler] of Object.entries(this.commands)) {
                    if (command === keyword || command.startsWith(keyword + ' ')) {
                        return await handler(command);
                    }
                }
                
                // Check for partial matches
                for (const [keyword, handler] of Object.entries(this.commands)) {
                    if (command.includes(keyword)) {
                        return await handler(command);
                    }
                }
                
                // Default AI response
                return await this.handleAICommand(command);
            }
            
            async handleCallCommand(command) {
                // Extract name from command
                const nameMatch = command.match(/(?:call|phone|dial|ring)\s+(?:me\s+)?(?:to\s+)?(\w+(?:\s+\w+)?)/i);
                if (nameMatch) {
                    const name = nameMatch[1].trim();
                    const contact = this.findContactByName(name);
                    
                    if (contact) {
                        this.callContact(contact.phone);
                        return {
                            type: 'success',
                            message: `Calling ${contact.name}...`,
                            html: `<div class="success-message"><strong>📞 Calling ${contact.name}</strong><br>Phone: ${this.formatPhone(contact.phone)}<br><em>Opening phone dialer...</em></div>`
                        };
                    } else {
                        return {
                            type: 'error',
                            message: `No contact found named "${name}"`,
                            html: `<div class="error-message">No contact found named "${name}". Add contacts in the Contacts tab.</div>`
                        };
                    }
                } else {
                    return {
                        type: 'info',
                        message: 'Please specify who to call',
                        html: `<div class="info-message">Please specify who to call. Example: "Call John" or "Phone Mom"</div>`
                    };
                }
            }
            
            async handleNoteCommand(command) {
                // Extract note text
                let noteText = '';
                
                if (command.includes('note that')) {
                    noteText = command.split('note that')[1]?.trim();
                } else if (command.includes('write down')) {
                    noteText = command.split('write down')[1]?.trim();
                } else if (command.includes('remember that')) {
                    noteText = command.split('remember that')[1]?.trim();
                } else {
                    const match = command.match(/(?:note|write|remember|record)\s+(.+)/i);
                    noteText = match ? match[1].trim() : '';
                }
                
                if (!noteText) {
                    return {
                        type: 'info',
                        message: 'Please specify what to note',
                        html: `<div class="info-message">Please specify what to note. Example: "Note meeting tomorrow at 3 PM"</div>`
                    };
                }
                
                // Add note
                const note = {
                    id: Date.now(),
                    text: noteText,
                    isVoice: true,
                    createdAt: new Date().toISOString()
                };
                
                appState.notes.unshift(note);
                saveNotes();
                updateNotesDisplay();
                
                return {
                    type: 'success',
                    message: `Note added: ${noteText.substring(0, 50)}...`,
                    html: `<div class="success-message"><strong>📝 Note Added</strong><br>"${noteText}"</div>`
                };
            }
            
            async handleReminderCommand(command) {
                // Extract reminder text and time
                let reminderText = '';
                let timeText = '';
                
                if (command.includes('remind me to')) {
                    reminderText = command.split('remind me to')[1]?.trim();
                } else if (command.includes('reminder for')) {
                    reminderText = command.split('reminder for')[1]?.trim();
                } else if (command.includes('set alarm for')) {
                    reminderText = command.split('set alarm for')[1]?.trim();
                } else {
                    const match = command.match(/(?:remind|reminder|alarm|alert|notify)\s+(.+)/i);
                    reminderText = match ? match[1].trim() : '';
                }
                
                if (!reminderText) {
                    return {
                        type: 'info',
                        message: 'Please specify what to remind',
                        html: `<div class="info-message">Please specify what to remind. Example: "Remind me to call mom tomorrow at 3 PM"</div>`
                    };
                }
                
                // Parse time
                const time = this.parseTimeFromCommand(command);
                
                // Add reminder
                const reminder = {
                    id: Date.now(),
                    text: reminderText,
                    time: time.toISOString(),
                    active: true,
                    createdAt: new Date().toISOString()
                };
                
                appState.reminders.push(reminder);
                saveReminders();
                updateRemindersDisplay();
                
                return {
                    type: 'success',
                    message: `Reminder set for ${time.toLocaleString()}`,
                    html: `<div class="success-message"><strong>⏰ Reminder Set</strong><br>${reminderText}<br>Time: ${time.toLocaleString()}</div>`
                };
            }
            
            async handleSearchCommand(command) {
                let query = '';
                
                // Extract search query
                if (command.includes('search for')) {
                    query = command.split('search for')[1]?.trim();
                } else if (command.includes('find')) {
                    query = command.split('find')[1]?.trim();
                } else if (command.includes('look up')) {
                    query = command.split('look up')[1]?.trim();
                } else if (command.includes('what is')) {
                    query = command.split('what is')[1]?.trim();
                } else if (command.includes('who is')) {
                    query = command.split('who is')[1]?.trim();
                } else if (command.includes('where is')) {
                    query = command.split('where is')[1]?.trim();
                } else if (command.includes('how to')) {
                    query = command.split('how to')[1]?.trim();
                } else if (command.includes('explain')) {
                    query = command.split('explain')[1]?.trim();
                } else {
                    const match = command.match(/(?:search|find|look up)\s+(.+)/i);
                    query = match ? match[1].trim() : command;
                }
                
                if (!query) {
                    return {
                        type: 'info',
                        message: 'Please specify what to search for',
                        html: `<div class="info-message">Please specify what to search for. Example: "Search for artificial intelligence"</div>`
                    };
                }
                
                // Open search in new tab
                setTimeout(() => {
                    window.open(`https://www.google.com/search?q=${encodeURIComponent(query)}`, '_blank');
                }, 500);
                
                // Get AI response for the query
                let aiResponse = 'Searching for information...';
                try {
                    aiResponse = await getAIResponse(query);
                } catch (error) {
                    aiResponse = `I found information about "${query}". Opening search results in your browser.`;
                }
                
                return {
                    type: 'success',
                    message: `Searching for: ${query}`,
                    html: `<div class="success-message">
                        <strong>🔍 Search Results</strong><br>
                        <p>${aiResponse.substring(0, 200)}...</p>
                        <div class="mt-2">
                            <button class="btn btn-primary" onclick="window.open('https://www.google.com/search?q=${encodeURIComponent(query)}', '_blank')">
                                <i class="fas fa-external-link-alt"></i> Open in Google
                            </button>
                        </div>
                    </div>`
                };
            }
            
            async handleWeatherCommand(command) {
                let location = '';
                
                if (command.includes('weather in')) {
                    location = command.split('weather in')[1]?.trim();
                } else if (command.includes('forecast for')) {
                    location = command.split('forecast for')[1]?.trim();
                } else if (command.includes('temperature in')) {
                    location = command.split('temperature in')[1]?.trim();
                } else {
                    const match = command.match(/(?:weather|forecast|temperature|climate)\s+(.+)/i);
                    location = match ? match[1].trim() : 'your location';
                }
                
                // Generate mock weather data
                const weatherData = this.generateWeatherData(location);
                
                return {
                    type: 'success',
                    message: `Weather for ${location}: ${weatherData.temperature}°C, ${weatherData.condition}`,
                    html: `<div class="success-message">
                        <strong>🌤️ Weather in ${weatherData.location}</strong>
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin: 15px 0;">
                            <div style="text-align: center;">
                                <div style="font-size: 2em; font-weight: bold; color: var(--primary);">${weatherData.temperature}°C</div>
                                <div style="font-size: 0.9em;">Temperature</div>
                            </div>
                            <div style="text-align: center;">
                                <div style="font-size: 1.2em; margin-bottom: 5px;">${weatherData.condition}</div>
                                <div style="font-size: 0.9em;">Condition</div>
                            </div>
                            <div style="text-align: center;">
                                <div style="font-size: 1.1em; margin-bottom: 5px;">${weatherData.humidity}%</div>
                                <div style="font-size: 0.9em;">Humidity</div>
                            </div>
                            <div style="text-align: center;">
                                <div style="font-size: 1.1em; margin-bottom: 5px;">${weatherData.wind} km/h</div>
                                <div style="font-size: 0.9em;">Wind Speed</div>
                            </div>
                        </div>
                        <button class="btn btn-primary" onclick="window.open('https://www.google.com/search?q=weather+${encodeURIComponent(location)}', '_blank')">
                            <i class="fas fa-external-link-alt"></i> More Details
                        </button>
                    </div>`
                };
            }
            
            async handleTimeCommand() {
                const now = new Date();
                const timeStr = now.toLocaleTimeString('en-US', { 
                    hour: '2-digit', 
                    minute: '2-digit',
                    second: '2-digit',
                    hour12: true 
                });
                
                return {
                    type: 'success',
                    message: `Current time: ${timeStr}`,
                    html: `<div class="success-message">
                        <strong>🕒 Current Time</strong>
                        <div style="text-align: center; padding: 15px;">
                            <div style="font-size: 2.5em; font-weight: bold; color: var(--primary);">${timeStr}</div>
                        </div>
                    </div>`
                };
            }
            
            async handleDateCommand() {
                const now = new Date();
                const dateStr = now.toLocaleDateString('en-US', { 
                    weekday: 'long', 
                    year: 'numeric', 
                    month: 'long', 
                    day: 'numeric' 
                });
                
                return {
                    type: 'success',
                    message: `Today is ${dateStr}`,
                    html: `<div class="success-message">
                        <strong>📅 Today's Date</strong>
                        <div style="text-align: center; padding: 15px;">
                            <div style="font-size: 1.5em; color: var(--primary);">${dateStr}</div>
                        </div>
                    </div>`
                };
            }
            
            async handleMathCommand(command) {
                try {
                    // Extract math expression
                    let expression = command.replace(/calculate|math|add|subtract|multiply|divide|plus|minus|times|over/gi, '')
                        .replace(/equals|equal to|what is|what's/i, '')
                        .trim();
                    
                    // Convert words to operators
                    expression = expression
                        .replace(/plus/gi, '+')
                        .replace(/minus/gi, '-')
                        .replace(/times/gi, '*')
                        .replace(/multiplied by/gi, '*')
                        .replace(/divided by/gi, '/')
                        .replace(/over/gi, '/');
                    
                    // Remove any non-math characters
                    expression = expression.replace(/[^0-9+\-*/().]/g, '');
                    
                    if (!expression) {
                        return {
                            type: 'info',
                            message: 'Please provide a math expression',
                            html: `<div class="info-message">Please provide a math expression. Example: "Calculate 15 plus 27" or "What is 100 divided by 4?"</div>`
                        };
                    }
                    
                    // Evaluate safely
                    const result = eval(expression);
                    
                    return {
                        type: 'success',
                        message: `Result: ${expression} = ${result}`,
                        html: `<div class="success-message">
                            <strong>🧮 Calculation Result</strong>
                            <div style="text-align: center; padding: 15px;">
                                <div style="font-size: 1.2em; margin-bottom: 10px;">${expression}</div>
                                <div style="font-size: 2.5em; font-weight: bold; color: var(--primary);">= ${result}</div>
                            </div>
                        </div>`
                    };
                } catch (error) {
                    return {
                        type: 'error',
                        message: 'Could not calculate that expression',
                        html: `<div class="error-message">Could not calculate that expression. Please try a simpler one.</div>`
                    };
                }
            }
            
            async handleAICommand(command) {
                if (!appState.aiEnabled) {
                    return {
                        type: 'warning',
                        message: 'AI is currently disabled',
                        html: `<div class="warning-message">AI responses are currently disabled. Enable AI using the brain icon in the header.</div>`
                    };
                }
                
                try {
                    const response = await getAIResponse(command);
                    return {
                        type: 'success',
                        message: 'AI response generated',
                        html: `<div class="success-message">
                            <strong>🤖 AI Response</strong>
                            <p>${response}</p>
                        </div>`
                    };
                } catch (error) {
                    return {
                        type: 'error',
                        message: 'AI service temporarily unavailable',
                        html: `<div class="error-message">
                            <strong>AI Service Unavailable</strong>
                            <p>I'm having trouble connecting to the AI service. Please try again in a moment.</p>
                            <p class="mt-2"><em>You can still use all other features like notes, reminders, and contacts.</em></p>
                        </div>`
                    };
                }
            }
            
            async handleHelpCommand() {
                return {
                    type: 'info',
                    message: 'Here are the commands I understand',
                    html: `<div class="info-message">
                        <strong>📋 Available Commands</strong>
                        <div style="margin-top: 15px;">
                            <strong>📞 Call:</strong> "Call John", "Phone Mom", "Dial emergency"<br>
                            <strong>📝 Notes:</strong> "Add note meeting tomorrow", "Remember to buy milk"<br>
                            <strong>⏰ Reminders:</strong> "Remind me to call mom", "Set alarm for 3 PM"<br>
                            <strong>🔍 Search:</strong> "Search for AI news", "What is JavaScript?"<br>
                            <strong>🌤️ Weather:</strong> "Weather in London", "Forecast for tomorrow"<br>
                            <strong>🕒 Time:</strong> "What time is it?", "Current time"<br>
                            <strong>📅 Date:</strong> "What's today's date?"<br>
                            <strong>🧮 Math:</strong> "Calculate 15 plus 27", "What is 100 divided by 4?"<br>
                            <strong>🤖 AI:</strong> "Ask AI about space", "Question about physics"
                        </div>
                    </div>`
                };
            }
            
            // Utility methods
            findContactByName(name) {
                const searchName = name.toLowerCase();
                return appState.contacts.find(contact => 
                    contact.name.toLowerCase().includes(searchName)
                );
            }
            
            callContact(phone) {
                if (/Mobi|Android|iPhone|iPad|iPod/i.test(navigator.userAgent)) {
                    window.location.href = `tel:${phone}`;
                } else {
                    showToast(`Call ${this.formatPhone(phone)} from your mobile device`, 'info');
                }
            }
            
            formatPhone(phone) {
                const cleaned = phone.replace(/\D/g, '');
                if (cleaned.length === 10) {
                    return `(${cleaned.substring(0, 3)}) ${cleaned.substring(3, 6)}-${cleaned.substring(6)}`;
                }
                return phone;
            }
            
            parseTimeFromCommand(command) {
                const now = new Date();
                const time = new Date(now);
                
                // Handle relative times
                if (command.includes('tomorrow')) {
                    time.setDate(time.getDate() + 1);
                }
                if (command.includes('next week')) {
                    time.setDate(time.getDate() + 7);
                }
                if (command.includes('in 1 hour') || command.includes('in one hour')) {
                    time.setHours(time.getHours() + 1);
                }
                if (command.includes('in 30 minutes')) {
                    time.setMinutes(time.getMinutes() + 30);
                }
                if (command.includes('in 15 minutes')) {
                    time.setMinutes(time.getMinutes() + 15);
                }
                if (command.includes('in 5 minutes')) {
                    time.setMinutes(time.getMinutes() + 5);
                }
                if (command.includes('next month')) {
                    time.setMonth(time.getMonth() + 1);
                }
                
                // Parse specific time
                const timeMatch = command.match(/(\d{1,2})(?::(\d{2}))?\s*(am|pm)?/i);
                if (timeMatch) {
                    let hours = parseInt(timeMatch[1]);
                    const minutes = timeMatch[2] ? parseInt(timeMatch[2]) : 0;
                    const period = timeMatch[3]?.toLowerCase();
                    
                    if (period === 'pm' && hours < 12) hours += 12;
                    if (period === 'am' && hours === 12) hours = 0;
                    
                    time.setHours(hours, minutes, 0, 0);
                    
                    if (time < now) {
                        time.setDate(time.getDate() + 1);
                    }
                }
                
                return time;
            }
            
            generateWeatherData(location) {
                const conditions = [
                    { name: 'Sunny', icon: '☀️', desc: 'Clear skies with plenty of sunshine' },
                    { name: 'Partly Cloudy', icon: '⛅', desc: 'Mix of sun and clouds' },
                    { name: 'Cloudy', icon: '☁️', desc: 'Overcast with no direct sunlight' },
                    { name: 'Rainy', icon: '🌧️', desc: 'Light to moderate rainfall expected' },
                    { name: 'Stormy', icon: '⛈️', desc: 'Thunderstorms possible' },
                    { name: 'Snowy', icon: '❄️', desc: 'Light snowfall expected' },
                    { name: 'Foggy', icon: '🌫️', desc: 'Reduced visibility due to fog' }
                ];
                
                const condition = conditions[Math.floor(Math.random() * conditions.length)];
                const hour = new Date().getHours();
                const isDaytime = hour >= 6 && hour < 18;
                
                return {
                    location: location,
                    temperature: Math.floor(Math.random() * 35) + 10,
                    condition: condition.name,
                    icon: condition.icon,
                    humidity: Math.floor(Math.random() * 70) + 30,
                    wind: Math.floor(Math.random() * 40) + 5,
                    description: isDaytime ? condition.desc : condition.desc + ' at night'
                };
            }
        }
        
        // Initialize command processor
        const commandProcessor = new CommandProcessor();
        
        // ================ APP INITIALIZATION ================
        document.addEventListener('DOMContentLoaded', () => {
            console.log('🚀 Initializing ALTECH AI Assistant...');
            
            // Initialize app
            initializeApp();
            
            // Show welcome message
            setTimeout(() => {
                showToast('ALTECH AI Assistant ready! Try voice commands.', 'success');
                updateAIResponse(`
                    <div class="success-message">
                        <h4 style="margin-bottom: 10px;">🤖 ALTECH AI Assistant v3.0</h4>
                        <p>I now understand natural language commands including:</p>
                        <ul style="margin-left: 20px; margin-top: 10px;">
                            <li><strong>📞 Call Contacts</strong> - "Call John", "Phone Mom"</li>
                            <li><strong>📝 Voice Notes</strong> - "Add note meeting tomorrow"</li>
                            <li><strong>⏰ Smart Reminders</strong> - "Remind me to call mom at 3 PM"</li>
                            <li><strong>🔍 Web Search</strong> - "Search for AI news"</li>
                            <li><strong>🌤️ Weather</strong> - "Weather in London"</li>
                            <li><strong>🧮 Calculations</strong> - "Calculate 15 plus 27"</li>
                            <li><strong>🤖 AI Answers</strong> - Ask me anything!</li>
                        </ul>
                        <p style="margin-top: 15px; font-weight: 600;">Try saying: <em>"Call John"</em> or <em>"What's the weather like?"</em></p>
                    </div>
                `);
            }, 1000);
        });
        
        function initializeApp() {
            // Load saved data
            loadAppState();
            loadAllData();
            
            // Initialize UI
            initializeUI();
            
            // Initialize voice recognition
            initializeVoiceRecognition();
            
            // Setup auto-save
            setupAutoSave();
            
            // Setup reminder checks
            setupReminderChecks();
            
            // Request notification permission
            requestNotificationPermission();
            
            // Check for PWA installation
            checkPWAInstallable();
        }
        
        // ================ VOICE RECOGNITION ================
        function initializeVoiceRecognition() {
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            
            if (!SpeechRecognition) {
                showToast('Voice recognition not supported in this browser', 'warning');
                document.getElementById('voiceOrb').style.display = 'none';
                document.getElementById('voiceBtn').style.display = 'none';
                return;
            }
            
            const recognition = new SpeechRecognition();
            recognition.continuous = false;
            recognition.interimResults = true;
            recognition.lang = 'en-US';
            recognition.maxAlternatives = 3;
            
            recognition.onstart = () => {
                appState.isListening = true;
                document.getElementById('voiceOrb').classList.add('listening');
                document.getElementById('statusText').textContent = '🎤 Listening... Speak now';
                showToast('Listening... Speak your command', 'info');
                
                updateAIResponse('<div class="typing-indicator"><div class="typing-dot"></div><div class="typing-dot"></div><div class="typing-dot"></div> Listening to your command...</div>');
            };
            
            recognition.onresult = async (event) => {
                const transcript = Array.from(event.results)
                    .map(result => result[0].transcript)
                    .join('');
                
                document.getElementById('transcript').innerHTML = 
                    `<strong>You said:</strong> ${transcript}`;
                
                if (event.results[0].isFinal) {
                    await handleVoiceCommand(transcript);
                }
            };
            
            recognition.onend = () => {
                appState.isListening = false;
                document.getElementById('voiceOrb').classList.remove('listening');
                document.getElementById('statusText').textContent = 'Click microphone and speak your command';
            };
            
            recognition.onerror = (event) => {
                console.error('Speech recognition error:', event.error);
                showToast(`Voice error: ${event.error}`, 'error');
                appState.isListening = false;
                document.getElementById('voiceOrb').classList.remove('listening');
            };
            
            // Store recognition object
            window.voiceRecognition = recognition;
            
            // Set up click handlers
            document.getElementById('voiceOrb').addEventListener('click', () => {
                toggleListening();
            });
            
            document.getElementById('voiceBtn').addEventListener('click', () => {
                toggleListening();
            });
        }
        
        function toggleListening() {
            if (!window.voiceRecognition) return;
            
            if (appState.isListening) {
                window.voiceRecognition.stop();
            } else {
                try {
                    window.voiceRecognition.start();
                } catch (error) {
                    showToast('Error starting voice recognition', 'error');
                }
            }
        }
        
        async function handleVoiceCommand(command) {
            // Show processing
            updateAIResponse('<div class="typing-indicator"><div class="typing-dot"></div><div class="typing-dot"></div><div class="typing-dot"></div> Processing your command...</div>');
            
            // Process command
            const result = await commandProcessor.process(command);
            
            // Update UI
            updateAIResponse(result.html);
            
            // Speak response if TTS enabled
            if (appState.ttsEnabled) {
                speakResponse(result.message);
            }
            
            // Show toast
            showToast(result.message, result.type);
            
            // Add to history
            appState.voiceHistory.push({
                command: command,
                response: result.message,
                timestamp: new Date().toISOString()
            });
            
            // Save history
            saveVoiceHistory();
        }
        
        function testCommand(command) {
            document.getElementById('transcript').innerHTML = 
                `<strong>You said:</strong> ${command}`;
            handleVoiceCommand(command);
        }
        
        // ================ UI INITIALIZATION ================
        function initializeUI() {
            // Tab switching
            document.querySelectorAll('.tab-btn, .nav-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const tabId = btn.dataset.tab;
                    switchTab(tabId);
                });
            });
            
            // Theme toggle
            document.getElementById('themeToggle').addEventListener('click', toggleTheme);
            
            // AI toggle
            document.getElementById('aiToggle').addEventListener('click', () => {
                appState.aiEnabled = !appState.aiEnabled;
                document.getElementById('aiToggle').classList.toggle('active', appState.aiEnabled);
                showToast(`AI ${appState.aiEnabled ? 'enabled' : 'disabled'}`, appState.aiEnabled ? 'success' : 'warning');
                saveAppState();
            });
            
            // WhatsApp button
            document.getElementById('whatsappBtn').addEventListener('click', () => {
                window.open('https://wa.me/254712345678?text=Hello%20ALTECH%20AI%20Assistant%20Support', '_blank');
            });
            
            // Install button
            document.getElementById('installBtn').addEventListener('click', showInstallPrompt);
            
            // Quick actions
            initializeQuickActions();
            
            // Set default reminder time
            const now = new Date();
            now.setMinutes(now.getMinutes() + 30);
            document.getElementById('reminderTime').value = now.toISOString().slice(0, 16);
        }
        
        function initializeQuickActions() {
            const quickActions = [
                { icon: 'fa-phone', text: 'Call Contact', action: 'showCallDialog()', color: 'success' },
                { icon: 'fa-edit', text: 'Add Note', action: 'focusNotes()', color: 'primary' },
                { icon: 'fa-bell', text: 'Set Reminder', action: 'focusReminders()', color: 'warning' },
                { icon: 'fa-search', text: 'Search Web', action: 'focusSearch()', color: 'info' },
                { icon: 'fa-cloud-sun', text: 'Check Weather', action: 'showWeatherDialog()', color: 'primary' },
                { icon: 'fa-question-circle', text: 'Ask AI', action: 'showAIDialog()', color: 'success' },
                { icon: 'fa-calculator', text: 'Calculator', action: 'showCalculator()', color: 'info' },
                { icon: 'fa-music', text: 'Play Music', action: 'playMusic()', color: 'warning' }
            ];
            
            const container = document.getElementById('quickActions');
            container.innerHTML = quickActions.map(action => `
                <button class="action-btn ${action.color}" onclick="${action.action}">
                    <i class="fas ${action.icon}"></i>
                    <span>${action.text}</span>
                </button>
            `).join('');
        }
        
        // ================ TAB MANAGEMENT ================
        function switchTab(tabId) {
            appState.currentTab = tabId;
            
            // Update tab buttons
            document.querySelectorAll('.tab-btn, .nav-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.tab === tabId);
            });
            
            // Update tab content
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.toggle('active', content.id === tabId);
            });
            
            // Save state
            saveAppState();
        }
        
        // ================ THEME MANAGEMENT ================
        function toggleTheme() {
            appState.darkMode = !appState.darkMode;
            document.body.classList.toggle('dark-mode', appState.darkMode);
            document.getElementById('themeToggle').innerHTML = 
                `<i class="fas fa-${appState.darkMode ? 'sun' : 'moon'}"></i>`;
            saveAppState();
            showToast(`Switched to ${appState.darkMode ? 'dark' : 'light'} mode`, 'info');
        }
        
        // ================ CONTACTS MANAGEMENT ================
        function showAddContactModal() {
            document.getElementById('addContactModal').style.display = 'flex';
            document.getElementById('contactName').focus();
        }
        
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }
        
        function saveContact() {
            const name = document.getElementById('contactName').value.trim();
            const phone = document.getElementById('contactPhone').value.trim();
            const email = document.getElementById('contactEmail').value.trim();
            const group = document.getElementById('contactGroup').value;
            
            if (!name || !phone) {
                showToast('Please enter name and phone number', 'error');
                return;
            }
            
            const contact = {
                id: Date.now(),
                name: name,
                phone: phone.replace(/\D/g, ''),
                email: email,
                group: group,
                createdAt: new Date().toISOString()
            };
            
            appState.contacts.push(contact);
            saveContacts();
            updateContactsDisplay();
            
            closeModal('addContactModal');
            
            showToast(`Contact "${name}" added`, 'success');
            
            // Clear form
            document.getElementById('contactName').value = '';
            document.getElementById('contactPhone').value = '';
            document.getElementById('contactEmail').value = '';
            document.getElementById('contactGroup').value = '';
        }
        
        async function importRealContacts() {
            if ('contacts' in navigator && 'ContactsManager' in window) {
                try {
                    const props = ['name', 'tel', 'email'];
                    const opts = { multiple: true };
                    
                    const contacts = await navigator.contacts.select(props, opts);
                    
                    contacts.forEach(contact => {
                        const name = contact.name?.[0] || 'Unknown';
                        const phone = contact.tel?.[0] || '';
                        const email = contact.email?.[0] || '';
                        
                        if (phone) {
                            appState.contacts.push({
                                id: Date.now() + Math.random(),
                                name: name,
                                phone: phone.replace(/\D/g, ''),
                                email: email,
                                group: 'imported',
                                createdAt: new Date().toISOString()
                            });
                        }
                    });
                    
                    saveContacts();
                    updateContactsDisplay();
                    showToast(`Imported ${contacts.length} contacts`, 'success');
                    
                } catch (error) {
                    console.error('Contact import error:', error);
                    showToast('Could not access contacts. Using sample data.', 'warning');
                    importSampleContacts();
                }
            } else {
                showToast('Contact API not supported', 'warning');
                importSampleContacts();
            }
        }
        
        function importSampleContacts() {
            const sampleContacts = [
                { id: 1, name: "John Doe", phone: "0712345678", email: "john@example.com", group: "friends" },
                { id: 2, name: "Jane Smith", phone: "0798765432", email: "jane@example.com", group: "work" },
                { id: 3, name: "Emergency Services", phone: "911", email: "", group: "emergency" },
                { id: 4, name: "Alex Johnson", phone: "0744556677", email: "alex@example.com", group: "family" },
                { id: 5, name: "Sarah Williams", phone: "0722334455", email: "sarah@example.com", group: "friends" }
            ];
            
            sampleContacts.forEach(contact => {
                appState.contacts.push({
                    ...contact,
                    createdAt: new Date().toISOString()
                });
            });
            
            saveContacts();
            updateContactsDisplay();
            showToast('Imported sample contacts', 'success');
        }
        
        function updateContactsDisplay() {
            const container = document.getElementById('contactsList');
            
            if (appState.contacts.length === 0) {
                container.innerHTML = `
                    <div class="info-message text-center">
                        <i class="fas fa-users fa-2x mb-2"></i>
                        <h4>No Contacts Yet</h4>
                        <p>Add your first contact or import from your device</p>
                        <button class="btn btn-primary mt-2" onclick="showAddContactModal()">
                            <i class="fas fa-user-plus"></i> Add Contact
                        </button>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = appState.contacts.map(contact => `
                <div class="contact-item">
                    <div class="contact-info">
                        <div class="contact-name">${contact.name}</div>
                        <div class="contact-phone">
                            <i class="fas fa-phone"></i> ${formatPhone(contact.phone)}
                        </div>
                        ${contact.email ? `<div class="contact-email"><i class="fas fa-envelope"></i> ${contact.email}</div>` : ''}
                        ${contact.group ? `<span style="background: var(--primary); color: white; padding: 3px 10px; border-radius: 12px; font-size: 0.8em; display: inline-block; margin-top: 5px;">${contact.group}</span>` : ''}
                    </div>
                    <div class="contact-actions">
                        <button class="contact-action-btn call" onclick="callContact('${contact.phone}')" title="Call">
                            <i class="fas fa-phone"></i>
                        </button>
                        <button class="contact-action-btn message" onclick="messageContact('${contact.phone}')" title="Message">
                            <i class="fas fa-comment"></i>
                        </button>
                        <button class="contact-action-btn delete" onclick="deleteContact(${contact.id})" title="Delete">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            `).join('');
        }
        
        function callContact(phone) {
            if (/Mobi|Android|iPhone|iPad|iPod/i.test(navigator.userAgent)) {
                window.location.href = `tel:${phone}`;
            } else {
                showToast(`Call ${formatPhone(phone)} from your mobile device`, 'info');
            }
        }
        
        function messageContact(phone) {
            if (/Mobi|Android|iPhone|iPad|iPod/i.test(navigator.userAgent)) {
                window.location.href = `sms:${phone}`;
            } else {
                showToast(`Message ${formatPhone(phone)} from your mobile device`, 'info');
            }
        }
        
        function deleteContact(id) {
            const contact = appState.contacts.find(c => c.id === id);
            if (contact && confirm(`Delete contact "${contact.name}"?`)) {
                appState.contacts = appState.contacts.filter(c => c.id !== id);
                saveContacts();
                updateContactsDisplay();
                showToast('Contact deleted', 'success');
            }
        }
        
        function showCallDialog() {
            const name = prompt("Who would you like to call?", "");
            if (name) {
                testCommand(`Call ${name}`);
            }
        }
        
        // ================ NOTES MANAGEMENT ================
        function saveNote() {
            const textarea = document.getElementById('notesTextarea');
            const text = textarea.value.trim();
            
            if (!text) {
                showToast('Please enter a note', 'warning');
                return;
            }
            
            const note = {
                id: Date.now(),
                text: text,
                isVoice: false,
                createdAt: new Date().toISOString()
            };
            
            appState.notes.unshift(note);
            saveNotes();
            updateNotesDisplay();
            
            textarea.value = '';
            showToast('Note saved', 'success');
        }
        
        function addVoiceNote() {
            if (window.voiceRecognition) {
                showToast('Speak your note', 'info');
                window.voiceRecognition.start();
                
                const originalOnResult = window.voiceRecognition.onresult;
                window.voiceRecognition.onresult = (event) => {
                    const transcript = Array.from(event.results)
                        .map(result => result[0].transcript)
                        .join('');
                    
                    if (event.results[0].isFinal) {
                        const note = {
                            id: Date.now(),
                            text: transcript,
                            isVoice: true,
                            createdAt: new Date().toISOString()
                        };
                        
                        appState.notes.unshift(note);
                        saveNotes();
                        updateNotesDisplay();
                        
                        showToast('Voice note added', 'success');
                        window.voiceRecognition.onresult = originalOnResult;
                        window.voiceRecognition.stop();
                    }
                };
            }
        }
        
        function updateNotesDisplay() {
            const container = document.getElementById('notesList');
            
            if (appState.notes.length === 0) {
                container.innerHTML = `
                    <div class="info-message text-center">
                        <i class="fas fa-sticky-note fa-2x mb-2"></i>
                        <h4>No Notes Yet</h4>
                        <p>Start typing or use voice commands to add notes</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = appState.notes.slice(0, 10).map(note => `
                <div class="note-item">
                    <div class="note-date">
                        <i class="fas fa-${note.isVoice ? 'microphone' : 'edit'}"></i>
                        ${new Date(note.createdAt).toLocaleString()}
                    </div>
                    <p>${note.text}</p>
                </div>
            `).join('');
        }
        
        function clearNotes() {
            if (confirm('Clear all notes?')) {
                appState.notes = [];
                document.getElementById('notesTextarea').value = '';
                saveNotes();
                updateNotesDisplay();
                showToast('All notes cleared', 'success');
            }
        }
        
        function exportNotes() {
            const notesText = appState.notes.map(note => 
                `[${new Date(note.createdAt).toLocaleString()}] ${note.text}`
            ).join('\n---\n');
            
            if (!notesText.trim()) {
                showToast('No notes to export', 'warning');
                return;
            }
            
            const blob = new Blob([notesText], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `altech-notes-${new Date().toISOString().slice(0,10)}.txt`;
            a.click();
            showToast('Notes exported', 'success');
        }
        
        function focusNotes() {
            switchTab('notes');
            setTimeout(() => {
                document.getElementById('notesTextarea').focus();
            }, 100);
        }
        
        // ================ REMINDERS MANAGEMENT ================
        function addReminder() {
            const text = document.getElementById('reminderText').value.trim();
            const timeStr = document.getElementById('reminderTime').value;
            
            if (!text || !timeStr) {
                showToast('Please enter reminder text and time', 'error');
                return;
            }
            
            const time = new Date(timeStr);
            if (time < new Date()) {
                showToast('Please select a future time', 'error');
                return;
            }
            
            const reminder = {
                id: Date.now(),
                text: text,
                time: time.toISOString(),
                active: true,
                createdAt: new Date().toISOString()
            };
            
            appState.reminders.push(reminder);
            saveReminders();
            updateRemindersDisplay();
            
            // Clear form
            document.getElementById('reminderText').value = '';
            const now = new Date();
            now.setMinutes(now.getMinutes() + 30);
            document.getElementById('reminderTime').value = now.toISOString().slice(0, 16);
            
            showToast('Reminder set!', 'success');
        }
        
        function updateRemindersDisplay() {
            const container = document.getElementById('remindersList');
            const now = new Date();
            
            const activeReminders = appState.reminders
                .filter(r => r.active)
                .sort((a, b) => new Date(a.time) - new Date(b.time));
            
            if (activeReminders.length === 0) {
                container.innerHTML = `
                    <div class="info-message text-center">
                        <i class="fas fa-bell fa-2x mb-2"></i>
                        <h4>No Reminders</h4>
                        <p>Set your first reminder using the form or voice commands</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = activeReminders.map(reminder => {
                const time = new Date(reminder.time);
                const isDue = time <= now;
                const timeDiff = time - now;
                const hoursLeft = Math.floor(timeDiff / (1000 * 60 * 60));
                const minutesLeft = Math.floor((timeDiff % (1000 * 60 * 60)) / (1000 * 60));
                
                return `
                    <div class="reminder-item ${isDue ? 'due' : ''}">
                        <p><strong>${reminder.text}</strong></p>
                        <p style="color: var(--text-secondary); margin-top: 10px;">
                            <i class="fas fa-clock"></i> ${time.toLocaleString()}
                            ${hoursLeft > 0 ? `<span style="margin-left: 10px; background: var(--info); color: white; padding: 2px 8px; border-radius: 10px; font-size: 0.8em;">${hoursLeft}h ${minutesLeft}m left</span>` : ''}
                        </p>
                        <div style="display: flex; gap: 10px; margin-top: 15px;">
                            <button onclick="deleteReminder(${reminder.id})" style="padding: 8px 15px; background: var(--danger); color: white; border: none; border-radius: 8px; cursor: pointer;">
                                <i class="fas fa-trash"></i> Delete
                            </button>
                            <button onclick="snoozeReminder(${reminder.id})" style="padding: 8px 15px; background: var(--warning); color: var(--dark); border: none; border-radius: 8px; cursor: pointer;">
                                <i class="fas fa-clock"></i> Snooze
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        function deleteReminder(id) {
            appState.reminders = appState.reminders.filter(r => r.id !== id);
            saveReminders();
            updateRemindersDisplay();
            showToast('Reminder deleted', 'success');
        }
        
        function snoozeReminder(id) {
            const reminder = appState.reminders.find(r => r.id === id);
            if (reminder) {
                const newTime = new Date(new Date(reminder.time).getTime() + 30 * 60000);
                reminder.time = newTime.toISOString();
                saveReminders();
                updateRemindersDisplay();
                showToast('Reminder snoozed for 30 minutes', 'info');
            }
        }
        
        function focusReminders() {
            switchTab('reminders');
            setTimeout(() => {
                document.getElementById('reminderText').focus();
            }, 100);
        }
        
        // ================ SEARCH FUNCTIONALITY ================
        async function performSearch() {
            const query = document.getElementById('searchInput').value.trim();
            if (!query) {
                showToast('Please enter a search query', 'warning');
                return;
            }
            
            await handleSearch(query);
        }
        
        async function handleSearch(query) {
            updateSearchResults(`<div class="typing-indicator"><div class="typing-dot"></div><div class="typing-dot"></div><div class="typing-dot"></div> Searching for "${query}"...</div>`);
            
            try {
                const aiResponse = await getAIResponse(query);
                
                updateSearchResults(`
                    <div class="search-result-item">
                        <h4><i class="fas fa-robot"></i> AI Answer</h4>
                        <p>${aiResponse}</p>
                        <div style="margin-top: 15px;">
                            <button class="btn btn-primary" onclick="window.open('https://www.google.com/search?q=${encodeURIComponent(query)}', '_blank')">
                                <i class="fas fa-external-link-alt"></i> More on Google
                            </button>
                        </div>
                    </div>
                `);
                
                updateAIResponse(`<div class='success-message'><strong>🔍 Search Results</strong><br>${aiResponse.substring(0, 200)}...</div>`);
                
                if (appState.ttsEnabled) {
                    speakResponse(aiResponse.substring(0, 100));
                }
                
            } catch (error) {
                updateSearchResults(`
                    <div class="search-result-item">
                        <h4><i class="fas fa-search"></i> Search Results for: "${query}"</h4>
                        <p>Opening search results in browser...</p>
                        <div style="margin-top: 15px;">
                            <button class="btn btn-primary" onclick="window.open('https://www.google.com/search?q=${encodeURIComponent(query)}', '_blank')">
                                <i class="fas fa-external-link-alt"></i> Open in Google
                            </button>
                        </div>
                    </div>
                `);
                
                setTimeout(() => {
                    window.open(`https://www.google.com/search?q=${encodeURIComponent(query)}`, '_blank');
                }, 1000);
            }
        }
        
        function searchWithProvider(provider) {
            const query = document.getElementById('searchInput').value.trim();
            if (!query) {
                showToast('Please enter a search query', 'warning');
                return;
            }
            
            let url;
            switch(provider) {
                case 'google':
                    url = `https://www.google.com/search?q=${encodeURIComponent(query)}`;
                    break;
                case 'wikipedia':
                    url = `https://en.wikipedia.org/wiki/Special:Search?search=${encodeURIComponent(query)}`;
                    break;
                case 'youtube':
                    url = `https://www.youtube.com/results?search_query=${encodeURIComponent(query)}`;
                    break;
                case 'news':
                    url = `https://news.google.com/search?q=${encodeURIComponent(query)}`;
                    break;
            }
            
            window.open(url, '_blank');
            showToast(`Opening ${provider}...`, 'info');
        }
        
        function updateSearchResults(content) {
            document.getElementById('searchResults').innerHTML = content;
        }
        
        function focusSearch() {
            switchTab('search');
            setTimeout(() => {
                document.getElementById('searchInput').focus();
            }, 100);
        }
        
        // ================ AI RESPONSE SYSTEM ================
        async function getAIResponse(query) {
            if (!appState.aiEnabled) {
                return "AI responses are currently disabled. Enable AI using the brain icon in the header.";
            }
            
            try {
                // Try multiple AI endpoints
                const endpoints = [
                    {
                        url: 'https://api.deepinfra.com/v1/inference/meta-llama/Llama-2-70b-chat-hf',
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': 'Bearer dc2bc3e2cdd2c6ccad9f5df96d0df850c4e284b7'
                        },
                        body: {
                            input: `Please provide a clear, concise answer to: "${query}"`,
                            max_new_tokens: 200
                        }
                    },
                    {
                        url: 'https://free.churchless.tech/v1/chat/completions',
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: {
                            model: "gpt-3.5-turbo",
                            messages: [{ role: "user", content: query }],
                            max_tokens: 200,
                            temperature: 0.7
                        }
                    }
                ];
                
                for (const endpoint of endpoints) {
                    try {
                        const response = await fetch(endpoint.url, {
                            method: endpoint.method,
                            headers: endpoint.headers,
                            body: JSON.stringify(endpoint.body)
                        });
                        
                        if (response.ok) {
                            const data = await response.json();
                            
                            if (data.choices?.[0]?.message?.content) {
                                return data.choices[0].message.content.trim();
                            }
                            if (data.results?.[0]?.generated_text) {
                                return data.results[0].generated_text.trim();
                            }
                            if (data.generated_text) {
                                return data.generated_text.trim();
                            }
                        }
                    } catch (error) {
                        console.log(`Endpoint failed: ${error.message}`);
                        continue;
                    }
                }
                
                // Fallback to local responses
                return getLocalAIResponse(query);
                
            } catch (error) {
                console.error('AI response error:', error);
                return getLocalAIResponse(query);
            }
        }
        
        function getLocalAIResponse(query) {
            const lowerQuery = query.toLowerCase();
            
            const knowledgeBase = {
                greetings: [
                    "Hello! I'm your ALTECH AI Assistant. How can I help you today?",
                    "Hi there! I'm ready to assist you with notes, reminders, search, and more!",
                    "Welcome! What can I do for you today?"
                ],
                ai: "Artificial Intelligence (AI) refers to computer systems that can perform tasks that normally require human intelligence. This includes understanding language, recognizing images, making decisions, and learning from experience.",
                weather: "I can check weather for any location. Just say 'weather in [city]' or click the weather button.",
                help: "I can help with: 📝 Notes, ⏰ Reminders, 🔍 Web search, 🌤️ Weather, 👥 Contacts, and answering questions! Try voice commands or click the buttons.",
                capabilities: "I understand natural language. Try: 'Add note meeting tomorrow', 'Remind me to call mom', 'Search for AI news', or 'What's the weather like?'",
                thank: "You're welcome! Is there anything else I can help you with?",
                bye: "Goodbye! Have a great day!"
            };
            
            if (/(hello|hi|hey)/.test(lowerQuery)) {
                return knowledgeBase.greetings[Math.floor(Math.random() * knowledgeBase.greetings.length)];
            }
            if (/(artificial intelligence|ai|what is ai)/.test(lowerQuery)) {
                return knowledgeBase.ai;
            }
            if (/(weather|forecast)/.test(lowerQuery)) {
                return knowledgeBase.weather;
            }
            if (/(help|what can you do)/.test(lowerQuery)) {
                return knowledgeBase.capabilities;
            }
            if (/(thank you|thanks)/.test(lowerQuery)) {
                return knowledgeBase.thank;
            }
            if (/(goodbye|bye)/.test(lowerQuery)) {
                return knowledgeBase.bye;
            }
            
            return `I understand you're asking about "${query}". This is something I can help you research. Would you like me to search the web for more detailed information?`;
        }
        
        function showAIDialog() {
            const question = prompt("What would you like to ask the AI?", "");
            if (question) {
                testCommand(question);
            }
        }
        
        function showWeatherDialog() {
            const location = prompt("Enter location for weather:", "Nairobi");
            if (location) {
                testCommand(`Weather in ${location}`);
            }
        }
        
        function showCalculator() {
            const expression = prompt("Enter math expression:", "15 + 27");
            if (expression) {
                testCommand(`Calculate ${expression}`);
            }
        }
        
        // ================ TEXT-TO-SPEECH ================
        function speakResponse(text) {
            if (!appState.ttsEnabled || !('speechSynthesis' in window)) return;
            
            try {
                window.speechSynthesis.cancel();
                
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.rate = 1.0;
                utterance.pitch = 1.0;
                utterance.volume = 1.0;
                
                const voices = window.speechSynthesis.getVoices();
                if (voices.length > 0) {
                    const englishVoice = voices.find(v => v.lang.startsWith('en')) || voices[0];
                    utterance.voice = englishVoice;
                }
                
                window.speechSynthesis.speak(utterance);
                
            } catch (error) {
                console.error('Speech synthesis error:', error);
            }
        }
        
        function speakCurrentResponse() {
            const responseElement = document.getElementById('aiOutput');
            const text = responseElement.textContent || responseElement.innerText;
            speakResponse(text);
        }
        
        // ================ PWA INSTALLATION ================
        function checkPWAInstallable() {
            if (window.matchMedia('(display-mode: standalone)').matches) {
                document.getElementById('installBtn').style.display = 'none';
                return;
            }
            
            window.addEventListener('beforeinstallprompt', (e) => {
                e.preventDefault();
                appState.deferredPrompt = e;
                
                document.getElementById('installBtn').style.display = 'flex';
                
                setTimeout(() => {
                    if (!localStorage.getItem('installBannerDismissed')) {
                        document.getElementById('installBanner').style.display = 'block';
                    }
                }, 5000);
            });
            
            window.addEventListener('appinstalled', () => {
                document.getElementById('installBtn').style.display = 'none';
                document.getElementById('installBanner').style.display = 'none';
                showToast('App installed successfully!', 'success');
            });
        }
        
        function showInstallPrompt() {
            if (appState.deferredPrompt) {
                appState.deferredPrompt.prompt();
                appState.deferredPrompt.userChoice.then((choiceResult) => {
                    if (choiceResult.outcome === 'accepted') {
                        console.log('User accepted install');
                    }
                    appState.deferredPrompt = null;
                });
            } else {
                showToast('Installation not available', 'warning');
            }
        }
        
        function installPWA() {
            showInstallPrompt();
            hideInstallBanner();
        }
        
        function hideInstallBanner() {
            document.getElementById('installBanner').style.display = 'none';
            localStorage.setItem('installBannerDismissed', 'true');
        }
        
        // ================ NOTIFICATION SYSTEM ================
        function requestNotificationPermission() {
            if (!('Notification' in window)) return;
            
            if (Notification.permission === 'granted') {
                appState.notificationsEnabled = true;
            } else if (Notification.permission !== 'denied') {
                Notification.requestPermission().then(permission => {
                    appState.notificationsEnabled = permission === 'granted';
                    saveAppState();
                });
            }
        }
        
        function showNotification(title, body) {
            if (!appState.notificationsEnabled || !('Notification' in window)) return;
            
            if (Notification.permission === 'granted') {
                new Notification(title, { body, icon: '/icon-192x192.png' });
            }
        }
        
        // ================ ACCESSIBILITY FUNCTIONS ================
        function increaseFontSize() {
            appState.fontSize = Math.min(appState.fontSize + 2, 24);
            document.documentElement.style.fontSize = appState.fontSize + 'px';
            saveAppState();
            showToast(`Font size increased to ${appState.fontSize}px`, 'info');
        }
        
        function decreaseFontSize() {
            appState.fontSize = Math.max(appState.fontSize - 2, 12);
            document.documentElement.style.fontSize = appState.fontSize + 'px';
            saveAppState();
            showToast(`Font size decreased to ${appState.fontSize}px`, 'info');
        }
        
        function toggleHighContrast() {
            appState.highContrast = !appState.highContrast;
            document.body.classList.toggle('high-contrast', appState.highContrast);
            saveAppState();
            showToast(`High contrast ${appState.highContrast ? 'enabled' : 'disabled'}`, 'info');
        }
        
        // ================ UTILITY FUNCTIONS ================
        function formatPhone(phone) {
            const cleaned = phone.replace(/\D/g, '');
            if (cleaned.length === 10) {
                return `(${cleaned.substring(0, 3)}) ${cleaned.substring(3, 6)}-${cleaned.substring(6)}`;
            }
            return phone;
        }
        
        function copyToClipboard(elementId) {
            const element = document.getElementById(elementId);
            const text = element.textContent || element.innerText;
            
            navigator.clipboard.writeText(text).then(() => {
                showToast('Copied to clipboard', 'success');
            }).catch(() => {
                const textArea = document.createElement('textarea');
                textArea.value = text;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                showToast('Copied to clipboard', 'success');
            });
        }
        
        function clearResponse() {
            document.getElementById('aiOutput').innerHTML = '';
        }
        
        function updateAIResponse(html) {
            document.getElementById('aiOutput').innerHTML = html;
        }
        
        function showToast(message, type = 'info') {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.innerHTML = `
                <i class="fas fa-${getToastIcon(type)}"></i>
                <span>${message}</span>
            `;
            
            container.appendChild(toast);
            
            setTimeout(() => {
                toast.remove();
            }, 3000);
        }
        
        function getToastIcon(type) {
            switch(type) {
                case 'success': return 'check-circle';
                case 'error': return 'exclamation-circle';
                case 'warning': return 'exclamation-triangle';
                case 'info': return 'info-circle';
                default: return 'info-circle';
            }
        }
        
        // ================ DATA PERSISTENCE ================
        function saveAppState() {
            localStorage.setItem('altech_app_state', JSON.stringify(appState));
        }
        
        function loadAppState() {
            const saved = localStorage.getItem('altech_app_state');
            if (saved) {
                const savedState = JSON.parse(saved);
                Object.assign(appState, savedState);
            }
        }
        
        function saveContacts() {
            localStorage.setItem('altech_contacts', JSON.stringify(appState.contacts));
        }
        
        function loadContacts() {
            const saved = localStorage.getItem('altech_contacts');
            if (saved) {
                appState.contacts = JSON.parse(saved);
            }
        }
        
        function saveNotes() {
            localStorage.setItem('altech_notes', JSON.stringify(appState.notes));
        }
        
        function loadNotes() {
            const saved = localStorage.getItem('altech_notes');
            if (saved) {
                appState.notes = JSON.parse(saved);
            }
        }
        
        function saveReminders() {
            localStorage.setItem('altech_reminders', JSON.stringify(appState.reminders));
        }
        
        function loadReminders() {
            const saved = localStorage.getItem('altech_reminders');
            if (saved) {
                appState.reminders = JSON.parse(saved);
            }
        }
        
        function saveVoiceHistory() {
            localStorage.setItem('altech_voice_history', JSON.stringify(appState.voiceHistory));
        }
        
        function loadVoiceHistory() {
            const saved = localStorage.getItem('altech_voice_history');
            if (saved) {
                appState.voiceHistory = JSON.parse(saved);
            }
        }
        
        function loadAllData() {
            loadContacts();
            loadNotes();
            loadReminders();
            loadVoiceHistory();
            updateContactsDisplay();
            updateNotesDisplay();
            updateRemindersDisplay();
        }
        
        // ================ AUTO-SAVE AND BACKGROUND TASKS ================
        function setupAutoSave() {
            setInterval(() => {
                saveContacts();
                saveNotes();
                saveReminders();
                saveVoiceHistory();
                saveAppState();
            }, 30000);
        }
        
        function setupReminderChecks() {
            setInterval(() => {
                const now = new Date();
                
                appState.reminders.forEach(reminder => {
                    if (reminder.active) {
                        const time = new Date(reminder.time);
                        const timeDiff = time - now;
                        
                        if (timeDiff > 0 && timeDiff < 60000) {
                            showNotification('⏰ ALTECH AI Reminder', reminder.text);
                            speakResponse(`Reminder: ${reminder.text}`);
                            reminder.active = false;
                            saveReminders();
                            updateRemindersDisplay();
                            showToast(`Reminder: ${reminder.text}`, 'warning');
                        }
                    }
                });
            }, 30000);
        }
        
        // ================ KEYBOARD SHORTCUTS ================
        document.addEventListener('keydown', (e) => {
            // Ctrl/Cmd + / to focus search
            if ((e.ctrlKey || e.metaKey) && e.key === '/') {
                e.preventDefault();
                focusSearch();
            }
            
            // Ctrl/Cmd + N for new note
            if ((e.ctrlKey || e.metaKey) && e.key === 'n') {
                e.preventDefault();
                focusNotes();
            }
            
            // Ctrl/Cmd + R for reminders
            if ((e.ctrlKey || e.metaKey) && e.key === 'r') {
                e.preventDefault();
                focusReminders();
            }
            
            // Escape to close modals
            if (e.key === 'Escape') {
                closeModal('addContactModal');
            }
            
            // Space to start/stop listening when not in input
            if (e.key === ' ' && !e.target.matches('input, textarea')) {
                e.preventDefault();
                toggleListening();
            }
        });
        
        // ================ SERVICE WORKER REGISTRATION ================
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('sw.js').then(() => {
                console.log('Service Worker registered');
            }).catch(error => {
                console.log('Service Worker registration failed:', error);
            });
        }
        
        console.log('✅ ALTECH AI Assistant v3.0 fully loaded and ready!');
    </script>
</body>
</html>
