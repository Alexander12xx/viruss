<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ALTECH AI</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #007bff;
            --success: #28a745;
            --danger: #dc3545;
            --warning: #ffc107;
            --info: #17a2b8;
            --dark: #343a40;
            --light: #f8f9fa;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            min-height: 100vh;
            padding: 20px;
        }
        
        .app-container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, var(--primary), #0056b3);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .main-content {
            display: grid;
            grid-template-columns: 280px 1fr;
            gap: 25px;
            padding: 25px;
        }
        
        .sidebar {
            background: var(--light);
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }
        
        .voice-section {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }
        
        .voice-orb {
            width: 150px;
            height: 150px;
            background: linear-gradient(135deg, var(--primary), var(--info));
            border-radius: 50%;
            margin: 0 auto 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 8px solid rgba(255,255,255,0.9);
            box-shadow: 0 15px 35px rgba(0,123,255,0.4);
        }
        
        .voice-orb:hover {
            transform: scale(1.05);
        }
        
        .voice-orb.listening {
            background: linear-gradient(135deg, var(--danger), var(--warning));
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        
        .voice-orb i {
            font-size: 3.5em;
            color: white;
        }
        
        #status {
            font-size: 1.2em;
            color: #666;
            margin-bottom: 20px;
            font-weight: 600;
            text-align: center;
        }
        
        #transcript {
            background: var(--light);
            padding: 20px;
            border-radius: 12px;
            margin: 20px 0;
            font-size: 1.3em;
            min-height: 80px;
            border-left: 5px solid var(--primary);
            font-weight: 600;
        }
        
        .ai-response {
            background: #e8f4fd;
            padding: 25px;
            border-radius: 12px;
            margin: 25px 0;
            border-left: 5px solid var(--success);
        }
        
        .quick-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 15px;
            margin: 25px 0;
        }
        
        .action-btn {
            padding: 20px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 12px;
            font-weight: 600;
            font-size: 1em;
        }
        
        .action-btn:hover {
            background: #0056b3;
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
        
        .action-btn.success {
            background: var(--success);
        }
        
        .action-btn.warning {
            background: var(--warning);
            color: var(--dark);
        }
        
        .action-btn.info {
            background: var(--info);
        }
        
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 25px;
            flex-wrap: wrap;
            border-bottom: 2px solid var(--light);
            padding-bottom: 15px;
        }
        
        .tab-btn {
            padding: 15px 25px;
            background: var(--light);
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            flex: 1;
            min-width: 120px;
            text-align: center;
        }
        
        .tab-btn:hover {
            background: #e9ecef;
        }
        
        .tab-btn.active {
            background: var(--primary);
            color: white;
        }
        
        .tab-content {
            display: none;
            animation: fadeIn 0.5s ease;
        }
        
        .tab-content.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .contact-item {
            padding: 20px;
            background: white;
            border-radius: 10px;
            margin-bottom: 15px;
            border: 2px solid #e9ecef;
            transition: all 0.3s ease;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .contact-item:hover {
            border-color: var(--primary);
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }
        
        .note-item {
            padding: 20px;
            background: white;
            border-radius: 10px;
            margin-bottom: 15px;
            border: 2px solid #e9ecef;
            position: relative;
        }
        
        .reminder-item {
            padding: 20px;
            background: white;
            border-radius: 10px;
            margin-bottom: 15px;
            border: 2px solid #e9ecef;
            border-left: 5px solid var(--warning);
        }
        
        .reminder-item.due {
            border-left-color: var(--danger);
            background: #fff5f5;
        }
        
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.7);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 20px;
        }
        
        .modal {
            background: white;
            padding: 30px;
            border-radius: 15px;
            max-width: 500px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            animation: modalSlide 0.3s ease;
        }
        
        @keyframes modalSlide {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        .modal h3 {
            margin-bottom: 25px;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark);
        }
        
        .form-control {
            width: 100%;
            padding: 15px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 1em;
            transition: all 0.3s ease;
        }
        
        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(0,123,255,0.1);
        }
        
        .modal-actions {
            display: flex;
            gap: 15px;
            margin-top: 30px;
        }
        
        .btn {
            flex: 1;
            padding: 15px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 1em;
            transition: all 0.3s ease;
        }
        
        .btn-primary {
            background: var(--primary);
            color: white;
        }
        
        .btn-primary:hover {
            background: #0056b3;
        }
        
        .btn-secondary {
            background: var(--light);
            color: var(--dark);
        }
        
        .btn-secondary:hover {
            background: #e9ecef;
        }
        
        .toast {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: var(--dark);
            color: white;
            padding: 20px 30px;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            z-index: 1001;
            display: none;
            animation: slideIn 0.3s ease;
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        .command-suggestions {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 20px;
            justify-content: center;
        }
        
        .command-chip {
            padding: 12px 20px;
            background: var(--light);
            border: 2px solid var(--primary);
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            color: var(--primary);
        }
        
        .command-chip:hover {
            background: var(--primary);
            color: white;
            transform: translateY(-2px);
        }
        
        @media (max-width: 992px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .quick-actions {
                grid-template-columns: repeat(3, 1fr);
            }
        }
        
        @media (max-width: 768px) {
            .quick-actions {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .tabs {
                flex-direction: column;
            }
            
            .tab-btn {
                flex: none;
                width: 100%;
            }
            
            .modal-actions {
                flex-direction: column;
            }
        }
        
        .search-results {
            margin-top: 20px;
            padding: 20px;
            background: var(--light);
            border-radius: 12px;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .search-result-item {
            padding: 15px;
            background: white;
            border-radius: 8px;
            margin-bottom: 10px;
            border-left: 4px solid var(--info);
        }
        
        .typing-indicator {
            display: inline-flex;
            gap: 5px;
        }
        
        .typing-dot {
            width: 8px;
            height: 8px;
            background: var(--primary);
            border-radius: 50%;
            animation: bounce 1.4s infinite;
        }
        
        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }
        
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 20px;
        }
        
        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            border: 2px solid #e9ecef;
        }
        
        .stat-number {
            font-size: 2em;
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 5px;
        }
        
        .stat-label {
            font-size: 0.9em;
            color: #666;
        }
        
        #notesTextarea {
            width: 100%;
            min-height: 200px;
            padding: 20px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            font-size: 1em;
            font-family: inherit;
            resize: vertical;
            margin-bottom: 20px;
        }
        
        #notesTextarea:focus {
            outline: none;
            border-color: var(--primary);
        }
    </style>
</head>
<body>
    <div class="app-container">
        <div class="header">
            <h1><i class="fas fa-robot"></i> ALTECH AI Assistant</h1>
            <p>Fully functional AI assistant with contacts, notes, reminders & search</p>
        </div>
        
        <div class="main-content">
            <!-- Sidebar -->
            <div class="sidebar">
                <div style="text-align: center; margin-bottom: 30px;">
                    <h3><i class="fas fa-cog"></i> AI Settings</h3>
                    <select id="aiMode" style="width: 100%; padding: 12px; border-radius: 8px; border: 2px solid #e9ecef; margin-top: 10px;">
                        <option value="smart">Smart AI Mode</option>
                        <option value="search">Search Mode</option>
                        <option value="simple">Simple Mode</option>
                    </select>
                </div>
                
                <div style="margin-bottom: 30px;">
                    <h3><i class="fas fa-chart-bar"></i> Statistics</h3>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-number" id="contactCount">0</div>
                            <div class="stat-label">Contacts</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="noteCount">0</div>
                            <div class="stat-label">Notes</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="reminderCount">0</div>
                            <div class="stat-label">Reminders</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="aiCount">0</div>
                            <div class="stat-label">AI Responses</div>
                        </div>
                    </div>
                </div>
                
                <div>
                    <h3><i class="fas fa-history"></i> Recent Commands</h3>
                    <div id="commandHistory" style="max-height: 200px; overflow-y: auto; margin-top: 15px;">
                        <p style="text-align: center; color: #666; padding: 20px;">No commands yet</p>
                    </div>
                </div>
            </div>
            
            <!-- Main Voice Section -->
            <div class="voice-section">
                <div class="tabs">
                    <button class="tab-btn active" onclick="openTab('assistant')">
                        <i class="fas fa-robot"></i> Assistant
                    </button>
                    <button class="tab-btn" onclick="openTab('contacts')">
                        <i class="fas fa-users"></i> Contacts
                    </button>
                    <button class="tab-btn" onclick="openTab('notes')">
                        <i class="fas fa-sticky-note"></i> Notes
                    </button>
                    <button class="tab-btn" onclick="openTab('reminders')">
                        <i class="fas fa-bell"></i> Reminders
                    </button>
                    <button class="tab-btn" onclick="openTab('search')">
                        <i class="fas fa-search"></i> Search
                    </button>
                </div>
                
                <!-- Assistant Tab -->
                <div id="assistant" class="tab-content active">
                    <div class="voice-orb" id="voiceOrb" onclick="toggleListening()">
                        <i class="fas fa-microphone"></i>
                    </div>
                    
                    <div id="status">Click microphone and speak your command</div>
                    <div id="transcript">Waiting for voice command...</div>
                    
                    <div class="ai-response">
                        <h3><i class="fas fa-brain"></i> AI Response</h3>
                        <div id="aiOutput">
                            <div class="typing-indicator">
                                <div class="typing-dot"></div>
                                <div class="typing-dot"></div>
                                <div class="typing-dot"></div>
                            </div>
                            Initializing AI Assistant...
                        </div>
                    </div>
                    
                    <div class="quick-actions">
                        <button class="action-btn" onclick="quickAction('add_contact')">
                            <i class="fas fa-user-plus"></i>
                            <span>Add Contact</span>
                        </button>
                        <button class="action-btn success" onclick="quickAction('add_note')">
                            <i class="fas fa-edit"></i>
                            <span>Add Note</span>
                        </button>
                        <button class="action-btn warning" onclick="quickAction('add_reminder')">
                            <i class="fas fa-bell"></i>
                            <span>Add Reminder</span>
                        </button>
                        <button class="action-btn info" onclick="quickAction('search_web')">
                            <i class="fas fa-search"></i>
                            <span>Search Web</span>
                        </button>
                        <button class="action-btn" onclick="quickAction('check_weather')">
                            <i class="fas fa-cloud-sun"></i>
                            <span>Check Weather</span>
                        </button>
                        <button class="action-btn" onclick="quickAction('ask_ai')">
                            <i class="fas fa-question-circle"></i>
                            <span>Ask AI</span>
                        </button>
                    </div>
                    
                    <div class="command-suggestions">
                        <div class="command-chip" onclick="speakCommand('Add contact John Doe phone 0712345678')">
                            Add Contact
                        </div>
                        <div class="command-chip" onclick="speakCommand('Add note meeting tomorrow at 3 PM')">
                            Add Note
                        </div>
                        <div class="command-chip" onclick="speakCommand('Remind me to call mom tomorrow')">
                            Set Reminder
                        </div>
                        <div class="command-chip" onclick="speakCommand('What is artificial intelligence')">
                            Ask AI Question
                        </div>
                        <div class="command-chip" onclick="speakCommand('Weather in Nairobi')">
                            Check Weather
                        </div>
                    </div>
                </div>
                
                <!-- Contacts Tab -->
                <div id="contacts" class="tab-content">
                    <div style="display: flex; gap: 15px; margin-bottom: 25px;">
                        <button class="action-btn" onclick="showAddContactModal()" style="flex: 1;">
                            <i class="fas fa-user-plus"></i> Add Contact
                        </button>
                        <button class="action-btn info" onclick="importContacts()" style="flex: 1;">
                            <i class="fas fa-file-import"></i> Import Contacts
                        </button>
                    </div>
                    
                    <div id="contactsList">
                        <p style="text-align: center; padding: 40px; color: #666;">
                            No contacts yet. Add your first contact!
                        </p>
                    </div>
                </div>
                
                <!-- Notes Tab -->
                <div id="notes" class="tab-content">
                    <div style="margin-bottom: 25px;">
                        <textarea id="notesTextarea" placeholder="Type your notes here... (Auto-saves every 30 seconds)"></textarea>
                        <div style="display: flex; gap: 15px;">
                            <button class="btn btn-primary" onclick="saveNotes()">
                                <i class="fas fa-save"></i> Save Notes
                            </button>
                            <button class="btn btn-secondary" onclick="clearNotes()">
                                <i class="fas fa-trash"></i> Clear
                            </button>
                        </div>
                    </div>
                    
                    <h3><i class="fas fa-history"></i> Recent Notes</h3>
                    <div id="notesList">
                        <p style="text-align: center; padding: 40px; color: #666;">
                            No notes yet. Start typing above!
                        </p>
                    </div>
                </div>
                
                <!-- Reminders Tab -->
                <div id="reminders" class="tab-content">
                    <div style="margin-bottom: 25px;">
                        <div class="form-group">
                            <label>Reminder Text</label>
                            <input type="text" id="reminderText" class="form-control" placeholder="What to remind?">
                        </div>
                        <div class="form-group">
                            <label>Date & Time</label>
                            <input type="datetime-local" id="reminderTime" class="form-control">
                        </div>
                        <button class="btn btn-primary" onclick="addReminder()" style="width: 100%;">
                            <i class="fas fa-plus"></i> Add Reminder
                        </button>
                    </div>
                    
                    <h3><i class="fas fa-bell"></i> Active Reminders</h3>
                    <div id="remindersList">
                        <p style="text-align: center; padding: 40px; color: #666;">
                            No reminders scheduled
                        </p>
                    </div>
                </div>
                
                <!-- Search Tab -->
                <div id="search" class="tab-content">
                    <div style="margin-bottom: 25px;">
                        <div class="form-group">
                            <label>Search Query</label>
                            <input type="text" id="searchQuery" class="form-control" placeholder="Ask anything or search the web...">
                        </div>
                        <div style="display: flex; gap: 15px;">
                            <button class="btn btn-primary" onclick="performSearch()" style="flex: 1;">
                                <i class="fas fa-search"></i> Search
                            </button>
                            <button class="btn btn-info" onclick="searchWikipedia()" style="flex: 1;">
                                <i class="fab fa-wikipedia-w"></i> Wikipedia
                            </button>
                        </div>
                    </div>
                    
                    <div id="searchResults" class="search-results">
                        <p style="text-align: center; padding: 40px; color: #666;">
                            Enter a search query above
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modals -->
    <div class="modal-overlay" id="addContactModal">
        <div class="modal">
            <h3><i class="fas fa-user-plus"></i> Add New Contact</h3>
            <div class="form-group">
                <label>Full Name</label>
                <input type="text" id="contactName" class="form-control" placeholder="Enter full name">
            </div>
            <div class="form-group">
                <label>Phone Number</label>
                <input type="tel" id="contactPhone" class="form-control" placeholder="e.g., 0712345678">
            </div>
            <div class="form-group">
                <label>Email (Optional)</label>
                <input type="email" id="contactEmail" class="form-control" placeholder="email@example.com">
            </div>
            <div class="form-group">
                <label>Group (Optional)</label>
                <select id="contactGroup" class="form-control">
                    <option value="">Select Group</option>
                    <option value="family">Family</option>
                    <option value="friends">Friends</option>
                    <option value="work">Work</option>
                    <option value="emergency">Emergency</option>
                </select>
            </div>
            <div class="modal-actions">
                <button class="btn btn-primary" onclick="saveContact()">
                    <i class="fas fa-save"></i> Save Contact
                </button>
                <button class="btn btn-secondary" onclick="closeModal('addContactModal')">
                    <i class="fas fa-times"></i> Cancel
                </button>
            </div>
        </div>
    </div>
    
    <!-- Toast -->
    <div class="toast" id="toast"></div>

    <script>
        // ================ CORE SYSTEM ================
        
        // Data Storage
        let contacts = [];
        let notes = '';
        let reminders = [];
        let commandHistory = [];
        let aiResponseCount = 0;
        
        // Voice Recognition
        let recognition = null;
        let isListening = false;
        
        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            console.log('üöÄ Initializing ALTECH AI Assistant...');
            
            // Load data
            loadAllData();
            
            // Initialize voice
            initializeVoiceRecognition();
            
            // Setup auto-save
            setupAutoSave();
            
            // Setup reminder checking
            setupReminderChecks();
            
            // Show welcome
            setTimeout(() => {
                showToast('ALTECH AI Assistant ready! Try voice commands or click buttons.');
                updateAIResponse(`
                    <h4 style="margin-bottom: 15px;">ü§ñ ALTECH AI Assistant Ready!</h4>
                    <p>I can help you with:</p>
                    <ul style="margin-left: 20px; margin-top: 10px;">
                        <li>üìù <strong>Notes</strong> - Add and manage notes</li>
                        <li>‚è∞ <strong>Reminders</strong> - Set time-based reminders</li>
                        <li>üîç <strong>Search</strong> - Search web & ask questions</li>
                        <li>üë• <strong>Contacts</strong> - Manage your contacts</li>
                        <li>üå§Ô∏è <strong>Weather</strong> - Check weather forecasts</li>
                        <li>ü§ñ <strong>AI Answers</strong> - Get intelligent responses</li>
                    </ul>
                    <p style="margin-top: 15px;">Try saying: <em>"Add note meeting tomorrow"</em> or <em>"What is AI?"</em></p>
                `);
            }, 1000);
        });
        
        // ================ VOICE RECOGNITION ================
        
        function initializeVoiceRecognition() {
            try {
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                if (!SpeechRecognition) {
                    showToast('Voice recognition not supported in this browser', 'error');
                    return;
                }
                
                recognition = new SpeechRecognition();
                recognition.continuous = false;
                recognition.interimResults = true;
                recognition.lang = 'en-US';
                
                recognition.onstart = () => {
                    isListening = true;
                    document.getElementById('voiceOrb').classList.add('listening');
                    document.getElementById('status').textContent = 'üé§ Listening... Speak now';
                    updateAIResponse('<div class="typing-indicator"><div class="typing-dot"></div><div class="typing-dot"></div><div class="typing-dot"></div></div> Listening...');
                };
                
                recognition.onresult = (event) => {
                    let transcript = '';
                    for (let i = event.resultIndex; i < event.results.length; i++) {
                        if (event.results[i].isFinal) {
                            transcript += event.results[i][0].transcript;
                        } else {
                            // Show interim results
                            document.getElementById('transcript').textContent = event.results[i][0].transcript;
                        }
                    }
                    
                    if (transcript) {
                        document.getElementById('transcript').textContent = transcript;
                        handleVoiceCommand(transcript);
                    }
                };
                
                recognition.onend = () => {
                    isListening = false;
                    document.getElementById('voiceOrb').classList.remove('listening');
                    document.getElementById('status').textContent = '‚úÖ Ready';
                };
                
                recognition.onerror = (event) => {
                    console.error('Speech recognition error:', event.error);
                    isListening = false;
                    document.getElementById('voiceOrb').classList.remove('listening');
                    
                    if (event.error === 'not-allowed') {
                        showToast('Microphone permission denied. Please allow microphone access.', 'error');
                    }
                };
                
            } catch (error) {
                console.error('Voice initialization error:', error);
                showToast('Voice recognition initialization failed', 'error');
            }
        }
        
        function toggleListening() {
            if (!recognition) {
                showToast('Voice recognition not initialized', 'error');
                return;
            }
            
            if (isListening) {
                recognition.stop();
            } else {
                try {
                    recognition.start();
                } catch (error) {
                    showToast('Error starting voice recognition', 'error');
                }
            }
        }
        
        // ================ COMMAND HANDLING ================
        
        async function handleVoiceCommand(command) {
            console.log('Command received:', command);
            
            // Add to history
            addToHistory(command);
            
            // Show processing
            updateAIResponse('<div class="typing-indicator"><div class="typing-dot"></div><div class="typing-dot"></div><div class="typing-dot"></div></div> Processing...');
            
            // Process command
            await processCommand(command);
        }
        
        async function processCommand(command) {
            const lowerCmd = command.toLowerCase();
            
            // Contact commands
            if (lowerCmd.includes('add contact') || lowerCmd.includes('new contact')) {
                handleAddContactCommand(command);
            }
            
            // Note commands
            else if (lowerCmd.includes('add note') || lowerCmd.includes('note that') || lowerCmd.includes('remember')) {
                handleAddNoteCommand(command);
            }
            
            // Reminder commands
            else if (lowerCmd.includes('remind') || lowerCmd.includes('reminder') || lowerCmd.includes('alert me')) {
                handleAddReminderCommand(command);
            }
            
            // Search/Question commands
            else if (lowerCmd.includes('search') || lowerCmd.includes('what is') || lowerCmd.includes('how to') || 
                     lowerCmd.includes('why') || lowerCmd.includes('who is') || lowerCmd.includes('where is')) {
                await handleSearchCommand(command);
            }
            
            // Weather commands
            else if (lowerCmd.includes('weather')) {
                handleWeatherCommand(command);
            }
            
            // General AI questions
            else {
                await handleAIQuestion(command);
            }
        }
        
        // ================ CONTACT MANAGEMENT ================
        
        function handleAddContactCommand(command) {
            let name = '';
            let phone = '';
            
            // Extract name and phone from command
            const phoneMatch = command.match(/(\d{10,})/);
            if (phoneMatch) {
                phone = phoneMatch[1];
                name = command.replace(/add contact|new contact|\d{10,}/gi, '').trim();
            } else {
                // If no phone in command, show modal
                showAddContactModal();
                updateAIResponse("Please enter the contact details in the form.");
                speakResponse("Please fill in the contact details.");
                return;
            }
            
            if (name && phone) {
                addContact(name, phone);
            } else {
                showAddContactModal();
            }
        }
        
        function showAddContactModal() {
            document.getElementById('addContactModal').style.display = 'flex';
            document.getElementById('contactName').focus();
        }
        
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }
        
        function saveContact() {
            const name = document.getElementById('contactName').value.trim();
            const phone = document.getElementById('contactPhone').value.trim();
            const email = document.getElementById('contactEmail').value.trim();
            const group = document.getElementById('contactGroup').value;
            
            if (!name || !phone) {
                showToast('Please enter name and phone number', 'error');
                return;
            }
            
            // Basic phone validation
            if (!/^[\d\s\-\+\(\)]{10,}$/.test(phone.replace(/\s/g, ''))) {
                showToast('Please enter a valid phone number', 'error');
                return;
            }
            
            addContact(name, phone, email, group);
            closeModal('addContactModal');
            
            // Clear form
            document.getElementById('contactName').value = '';
            document.getElementById('contactPhone').value = '';
            document.getElementById('contactEmail').value = '';
            document.getElementById('contactGroup').value = '';
        }
        
        function addContact(name, phone, email = '', group = '') {
            const contact = {
                id: Date.now(),
                name: name,
                phone: phone,
                email: email,
                group: group,
                created: new Date().toISOString()
            };
            
            contacts.push(contact);
            saveContacts();
            updateContactsDisplay();
            
            const message = `Contact "${name}" added successfully`;
            updateAIResponse(`‚úÖ <strong>Contact Added</strong><br>Name: ${name}<br>Phone: ${phone}`);
            speakResponse(message);
            showToast(message);
        }
        
        function importContacts() {
            // Simulate importing sample contacts
            const sampleContacts = [
                { id: Date.now() + 1, name: "John Doe", phone: "0712345678", email: "john@example.com", group: "friends" },
                { id: Date.now() + 2, name: "Jane Smith", phone: "0798765432", email: "jane@example.com", group: "work" },
                { id: Date.now() + 3, name: "Emergency", phone: "911", email: "", group: "emergency" }
            ];
            
            sampleContacts.forEach(contact => contacts.push(contact));
            saveContacts();
            updateContactsDisplay();
            
            showToast(`Imported ${sampleContacts.length} sample contacts`);
            updateAIResponse(`‚úÖ Imported ${sampleContacts.length} sample contacts`);
        }
        
        function deleteContact(id) {
            if (confirm('Delete this contact?')) {
                contacts = contacts.filter(c => c.id !== id);
                saveContacts();
                updateContactsDisplay();
                showToast('Contact deleted');
            }
        }
        
        // ================ NOTES MANAGEMENT ================
        
        function handleAddNoteCommand(command) {
            let noteText = '';
            
            if (command.includes('add note')) {
                noteText = command.split('add note')[1]?.trim();
            } else if (command.includes('note that')) {
                noteText = command.split('note that')[1]?.trim();
            } else if (command.includes('remember')) {
                noteText = command.split('remember')[1]?.trim();
            }
            
            if (!noteText) {
                noteText = prompt("What would you like to note?");
                if (!noteText) return;
            }
            
            addNote(noteText);
        }
        
        function addNote(text) {
            // Add to notes textarea
            const notesTextarea = document.getElementById('notesTextarea');
            const timestamp = new Date().toLocaleString();
            const newNote = `[${timestamp}] ${text}\n`;
            
            notesTextarea.value = newNote + notesTextarea.value;
            saveNotes();
            
            // Update recent notes display
            updateNotesDisplay();
            
            const message = `Note added: ${text.substring(0, 50)}...`;
            updateAIResponse(`üìù <strong>Note Added</strong><br>"${text}"`);
            speakResponse(message);
            showToast('Note saved!');
        }
        
        function saveNotes() {
            const notesText = document.getElementById('notesTextarea').value;
            localStorage.setItem('altech_notes', notesText);
            updateNotesDisplay();
            showToast('Notes saved!', 'success');
        }
        
        function clearNotes() {
            if (confirm('Clear all notes?')) {
                document.getElementById('notesTextarea').value = '';
                saveNotes();
                showToast('All notes cleared');
            }
        }
        
        // ================ REMINDERS MANAGEMENT ================
        
        function handleAddReminderCommand(command) {
            let reminderText = '';
            let timeText = '';
            
            if (command.includes('remind me to')) {
                reminderText = command.split('remind me to')[1]?.trim();
            } else if (command.includes('reminder for')) {
                reminderText = command.split('reminder for')[1]?.trim();
            }
            
            if (!reminderText) {
                reminderText = prompt("What should I remind you about?");
                if (!reminderText) return;
            }
            
            // Parse time
            const time = parseTimeFromCommand(command);
            addReminderFromCommand(reminderText, time);
        }
        
        function parseTimeFromCommand(command) {
            const now = new Date();
            const time = new Date(now);
            
            if (command.includes('tomorrow')) {
                time.setDate(time.getDate() + 1);
            }
            if (command.includes('next week')) {
                time.setDate(time.getDate() + 7);
            }
            if (command.includes('in 1 hour') || command.includes('in one hour')) {
                time.setHours(time.getHours() + 1);
            }
            if (command.includes('in 30 minutes')) {
                time.setMinutes(time.getMinutes() + 30);
            }
            
            // Try to parse specific time
            const timeMatch = command.match(/(\d{1,2})(?::(\d{2}))?\s*(am|pm)?/i);
            if (timeMatch) {
                let hours = parseInt(timeMatch[1]);
                const minutes = timeMatch[2] ? parseInt(timeMatch[2]) : 0;
                const period = timeMatch[3]?.toLowerCase();
                
                if (period === 'pm' && hours < 12) hours += 12;
                if (period === 'am' && hours === 12) hours = 0;
                
                time.setHours(hours, minutes, 0, 0);
            }
            
            return time;
        }
        
        function addReminderFromCommand(text, time) {
            const reminder = {
                id: Date.now(),
                text: text,
                time: time.toISOString(),
                created: new Date().toISOString(),
                active: true
            };
            
            reminders.push(reminder);
            saveReminders();
            updateRemindersDisplay();
            
            const timeStr = time.toLocaleString();
            updateAIResponse(`‚è∞ <strong>Reminder Set</strong><br>${text}<br>Time: ${timeStr}`);
            speakResponse(`Reminder set for ${text}`);
            showToast('Reminder set!');
        }
        
        function addReminder() {
            const text = document.getElementById('reminderText').value.trim();
            const timeStr = document.getElementById('reminderTime').value;
            
            if (!text || !timeStr) {
                showToast('Please enter reminder text and time', 'error');
                return;
            }
            
            const time = new Date(timeStr);
            const reminder = {
                id: Date.now(),
                text: text,
                time: time.toISOString(),
                created: new Date().toISOString(),
                active: true
            };
            
            reminders.push(reminder);
            saveReminders();
            updateRemindersDisplay();
            
            // Clear inputs
            document.getElementById('reminderText').value = '';
            const now = new Date();
            document.getElementById('reminderTime').value = now.toISOString().slice(0, 16);
            
            showToast('Reminder added!');
        }
        
        function deleteReminder(id) {
            if (confirm('Delete this reminder?')) {
                reminders = reminders.filter(r => r.id !== id);
                saveReminders();
                updateRemindersDisplay();
                showToast('Reminder deleted');
            }
        }
        
        // ================ SEARCH FUNCTIONALITY ================
        
        async function handleSearchCommand(command) {
            let query = '';
            
            if (command.includes('search for')) {
                query = command.split('search for')[1]?.trim();
            } else if (command.includes('what is')) {
                query = command.split('what is')[1]?.trim();
            } else if (command.includes('how to')) {
                query = command.split('how to')[1]?.trim();
            } else if (command.includes('who is')) {
                query = command.split('who is')[1]?.trim();
            } else if (command.includes('where is')) {
                query = command.split('where is')[1]?.trim();
            } else {
                query = command;
            }
            
            if (!query) {
                query = prompt("What would you like to search for?");
                if (!query) return;
            }
            
            await performSmartSearch(query, command);
        }
        
        async function performSmartSearch(query, originalCommand = '') {
            updateAIResponse(`üîç <strong>Searching:</strong> ${query}`);
            speakResponse(`Searching for ${query}`);
            
            // Try to get AI response first
            try {
                const aiResponse = await getAIResponse(query);
                aiResponseCount++;
                updateStats();
                
                updateAIResponse(`
                    <div style="margin-bottom: 15px;">
                        <strong>üîç Search Query:</strong> ${query}
                    </div>
                    <div style="background: white; padding: 20px; border-radius: 10px; border: 1px solid #e9ecef;">
                        <strong>ü§ñ AI Answer:</strong>
                        <p>${aiResponse}</p>
                    </div>
                    <div style="margin-top: 15px;">
                        <button class="btn btn-primary" onclick="window.open('https://www.google.com/search?q=${encodeURIComponent(query)}', '_blank')" style="padding: 10px 20px;">
                            <i class="fas fa-external-link-alt"></i> Open in Google
                        </button>
                    </div>
                `);
                
                // Also speak the response
                speakResponse(aiResponse.substring(0, 150) + '...');
                
            } catch (error) {
                console.error('AI search error:', error);
                // Fallback to regular search
                window.open(`https://www.google.com/search?q=${encodeURIComponent(query)}`, '_blank');
                updateAIResponse(`üîç <strong>Search Results:</strong><br>Opened Google search for "${query}"`);
            }
        }
        
        async function performSearch() {
            const query = document.getElementById('searchQuery').value.trim();
            if (!query) {
                showToast('Please enter a search query', 'error');
                return;
            }
            
            await performSmartSearch(query);
        }
        
        function searchWikipedia() {
            const query = document.getElementById('searchQuery').value.trim();
            if (!query) {
                showToast('Please enter a search query', 'error');
                return;
            }
            
            window.open(`https://en.wikipedia.org/wiki/Special:Search?search=${encodeURIComponent(query)}`, '_blank');
            updateAIResponse(`üìö <strong>Wikipedia Search:</strong><br>Searching for "${query}" on Wikipedia`);
            showToast('Opening Wikipedia...');
        }
        
        // ================ WEATHER FUNCTIONALITY ================
        
        function handleWeatherCommand(command) {
            let location = '';
            
            if (command.includes('weather in')) {
                location = command.split('weather in')[1]?.trim();
            } else if (command.includes('weather at')) {
                location = command.split('weather at')[1]?.trim();
            } else {
                location = prompt("Which location?", "your current location");
            }
            
            if (location) {
                getWeather(location);
            } else {
                getWeather('current location');
            }
        }
        
        async function getWeather(location) {
            updateAIResponse(`üå§Ô∏è <strong>Checking weather for:</strong> ${location}`);
            speakResponse(`Checking weather for ${location}`);
            
            // For demo, simulate weather data
            const weatherData = {
                location: location,
                temperature: Math.floor(Math.random() * 30) + 15,
                condition: ['Sunny', 'Cloudy', 'Rainy', 'Partly Cloudy'][Math.floor(Math.random() * 4)],
                humidity: Math.floor(Math.random() * 60) + 30,
                wind: Math.floor(Math.random() * 20) + 5
            };
            
            setTimeout(() => {
                updateAIResponse(`
                    <div style="background: linear-gradient(135deg, #667eea, #764ba2); color: white; padding: 25px; border-radius: 12px;">
                        <h4 style="margin-bottom: 15px;">üå§Ô∏è Weather for ${weatherData.location}</h4>
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px;">
                            <div>
                                <strong>Temperature:</strong><br>
                                <span style="font-size: 2em;">${weatherData.temperature}¬∞C</span>
                            </div>
                            <div>
                                <strong>Condition:</strong><br>
                                <span style="font-size: 1.5em;">${weatherData.condition}</span>
                            </div>
                            <div>
                                <strong>Humidity:</strong><br>
                                ${weatherData.humidity}%
                            </div>
                            <div>
                                <strong>Wind Speed:</strong><br>
                                ${weatherData.wind} km/h
                            </div>
                        </div>
                        <div style="margin-top: 20px;">
                            <button class="btn" onclick="window.open('https://www.google.com/search?q=weather+${encodeURIComponent(location)}', '_blank')" style="background: white; color: #764ba2;">
                                <i class="fas fa-external-link-alt"></i> More Details
                            </button>
                        </div>
                    </div>
                `);
                
                speakResponse(`Weather in ${location}: ${weatherData.temperature} degrees, ${weatherData.condition}`);
            }, 1500);
        }
        
        // ================ AI RESPONSES ================
        
        async function handleAIQuestion(question) {
            aiResponseCount++;
            updateStats();
            
            updateAIResponse('<div class="typing-indicator"><div class="typing-dot"></div><div class="typing-dot"></div><div class="typing-dot"></div></div> Thinking...');
            
            try {
                const response = await getAIResponse(question);
                updateAIResponse(`
                    <div style="margin-bottom: 10px;">
                        <strong>ü§ñ Question:</strong> ${question}
                    </div>
                    <div style="background: white; padding: 20px; border-radius: 10px; border: 1px solid #e9ecef;">
                        <strong>üí° Answer:</strong>
                        <p>${response}</p>
                    </div>
                `);
                speakResponse(response.substring(0, 100) + '...');
            } catch (error) {
                console.error('AI error:', error);
                const fallback = getLocalAIResponse(question);
                updateAIResponse(fallback);
                speakResponse("Here's what I can tell you about that.");
            }
        }
        
        async function getAIResponse(query) {
            // Try multiple free AI endpoints
            const endpoints = [
                {
                    url: 'https://api.deepinfra.com/v1/inference/meta-llama/Llama-2-70b-chat-hf',
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer dc2bc3e2cdd2c6ccad9f5df96d0df850c4e284b7'
                    },
                    body: {
                        input: query,
                        max_new_tokens: 150
                    }
                },
                {
                    url: 'https://free.churchless.tech/v1/chat/completions',
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: {
                        model: "gpt-3.5-turbo",
                        messages: [{ role: "user", content: query }],
                        max_tokens: 200
                    }
                }
            ];
            
            for (const endpoint of endpoints) {
                try {
                    const response = await fetch(endpoint.url, {
                        method: endpoint.method,
                        headers: endpoint.headers,
                        body: JSON.stringify(endpoint.body)
                    });
                    
                    if (response.ok) {
                        const data = await response.json();
                        if (data.choices?.[0]?.message?.content) {
                            return data.choices[0].message.content;
                        }
                        if (data.results?.[0]?.generated_text) {
                            return data.results[0].generated_text;
                        }
                    }
                } catch (error) {
                    continue;
                }
            }
            
            // Fallback to local responses
            return getLocalAIResponse(query);
        }
        
        function getLocalAIResponse(query) {
            const lowerQuery = query.toLowerCase();
            
            // Common questions and answers
            const responses = {
                greeting: ["Hello! How can I help you today?", "Hi there! What can I do for you?", "Hey! Ready to assist you."],
                time: [`The current time is ${new Date().toLocaleTimeString()}`],
                date: [`Today is ${new Date().toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}`],
                help: "I can help with: üìù Notes, ‚è∞ Reminders, üîç Web search, üå§Ô∏è Weather, üë• Contacts, and answering questions!",
                ai: "Artificial Intelligence (AI) refers to computer systems that can perform tasks that normally require human intelligence, like understanding language, recognizing images, or making decisions.",
                weather: "I can check weather for any location. Just say 'weather in [city name]'.",
                note: "To add a note, say 'Add note [your note]' or type in the Notes tab.",
                reminder: "To set a reminder, say 'Remind me to [task] [time]' or use the Reminders tab."
            };
            
            if (/(hello|hi|hey)/.test(lowerQuery)) {
                return responses.greeting[Math.floor(Math.random() * responses.greeting.length)];
            }
            if (/(time|what.time)/.test(lowerQuery)) {
                return responses.time[0];
            }
            if (/(date|today|what.date)/.test(lowerQuery)) {
                return responses.date[0];
            }
            if (/(help|what.can.you.do)/.test(lowerQuery)) {
                return responses.help;
            }
            if (/(artificial.intelligence|what.is.ai)/.test(lowerQuery)) {
                return responses.ai;
            }
            if (/(note|notes)/.test(lowerQuery)) {
                return responses.note;
            }
            if (/(remind|reminder)/.test(lowerQuery)) {
                return responses.reminder;
            }
            
            return `I understand you're asking about "${query}". I can help you search for this information or you can ask me specific questions.`;
        }
        
        // ================ QUICK ACTIONS ================
        
        function quickAction(action) {
            switch(action) {
                case 'add_contact':
                    showAddContactModal();
                    break;
                case 'add_note':
                    const note = prompt("Enter your note:");
                    if (note) addNote(note);
                    break;
                case 'add_reminder':
                    openTab('reminders');
                    document.getElementById('reminderText').focus();
                    break;
                case 'search_web':
                    const search = prompt("What to search for?");
                    if (search) performSmartSearch(search);
                    break;
                case 'check_weather':
                    const location = prompt("Weather location?", "Nairobi");
                    if (location) getWeather(location);
                    break;
                case 'ask_ai':
                    const question = prompt("Ask me anything:");
                    if (question) handleAIQuestion(question);
                    break;
            }
        }
        
        function speakCommand(command) {
            document.getElementById('transcript').textContent = command;
            handleVoiceCommand(command);
        }
        
        // ================ UI UPDATES ================
        
        function openTab(tabId) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Remove active from all buttons
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Show selected tab
            document.getElementById(tabId).classList.add('active');
            
            // Add active to clicked button
            event.target.classList.add('active');
            
            // Focus appropriate field
            if (tabId === 'search') {
                setTimeout(() => document.getElementById('searchQuery').focus(), 100);
            } else if (tabId === 'notes') {
                setTimeout(() => document.getElementById('notesTextarea').focus(), 100);
            }
        }
        
        function updateContactsDisplay() {
            const container = document.getElementById('contactsList');
            
            if (contacts.length === 0) {
                container.innerHTML = '<p style="text-align: center; padding: 40px; color: #666;">No contacts yet. Add your first contact!</p>';
                return;
            }
            
            container.innerHTML = contacts.map(contact => `
                <div class="contact-item">
                    <div>
                        <strong style="font-size: 1.1em;">${contact.name}</strong><br>
                        <span>üìû ${contact.phone}</span>
                        ${contact.email ? `<br><span>üìß ${contact.email}</span>` : ''}
                        ${contact.group ? `<br><span style="background: #e9ecef; padding: 2px 8px; border-radius: 12px; font-size: 0.9em;">${contact.group}</span>` : ''}
                    </div>
                    <div>
                        <button onclick="deleteContact(${contact.id})" style="padding: 8px 15px; background: var(--danger); color: white; border: none; border-radius: 8px; cursor: pointer;">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            `).join('');
            
            updateStats();
        }
        
        function updateNotesDisplay() {
            const container = document.getElementById('notesList');
            const notesText = document.getElementById('notesTextarea').value;
            
            if (!notesText.trim()) {
                container.innerHTML = '<p style="text-align: center; padding: 40px; color: #666;">No notes yet. Start typing above!</p>';
                return;
            }
            
            // Show last 5 notes
            const lines = notesText.split('\n').filter(line => line.trim());
            const recentNotes = lines.slice(0, 5);
            
            container.innerHTML = recentNotes.map(note => `
                <div class="note-item">
                    <p>${note}</p>
                </div>
            `).join('');
            
            updateStats();
        }
        
        function updateRemindersDisplay() {
            const container = document.getElementById('remindersList');
            const now = new Date();
            
            if (reminders.length === 0) {
                container.innerHTML = '<p style="text-align: center; padding: 40px; color: #666;">No reminders scheduled</p>';
                return;
            }
            
            const activeReminders = reminders.filter(r => r.active);
            
            if (activeReminders.length === 0) {
                container.innerHTML = '<p style="text-align: center; padding: 40px; color: #666;">No active reminders</p>';
                return;
            }
            
            container.innerHTML = activeReminders.map(reminder => {
                const time = new Date(reminder.time);
                const isDue = time <= now;
                
                return `
                    <div class="reminder-item ${isDue ? 'due' : ''}">
                        <p><strong>${reminder.text}</strong></p>
                        <p style="color: #666; margin-top: 10px;">
                            <i class="fas fa-clock"></i> ${time.toLocaleString()}
                        </p>
                        <button onclick="deleteReminder(${reminder.id})" style="margin-top: 10px; padding: 8px 15px; background: var(--danger); color: white; border: none; border-radius: 8px; cursor: pointer;">
                            <i class="fas fa-trash"></i> Delete
                        </button>
                    </div>
                `;
            }).join('');
            
            updateStats();
        }
        
        function updateStats() {
            document.getElementById('contactCount').textContent = contacts.length;
            document.getElementById('noteCount').textContent = document.getElementById('notesTextarea').value.split('\n').filter(l => l.trim()).length;
            document.getElementById('reminderCount').textContent = reminders.filter(r => r.active).length;
            document.getElementById('aiCount').textContent = aiResponseCount;
        }
        
        function updateAIResponse(html) {
            document.getElementById('aiOutput').innerHTML = html;
        }
        
        function addToHistory(command) {
            commandHistory.unshift({
                command: command,
                time: new Date().toLocaleTimeString()
            });
            
            if (commandHistory.length > 5) {
                commandHistory = commandHistory.slice(0, 5);
            }
            
            // Update history display
            const container = document.getElementById('commandHistory');
            container.innerHTML = commandHistory.map(item => `
                <div style="padding: 10px; border-bottom: 1px solid #e9ecef;">
                    <div style="color: #666; font-size: 0.9em;">${item.time}</div>
                    <div>"${item.command.substring(0, 40)}${item.command.length > 40 ? '...' : ''}"</div>
                </div>
            `).join('');
            
            saveHistory();
        }
        
        // ================ DATA MANAGEMENT ================
        
        function loadAllData() {
            // Load contacts
            const savedContacts = localStorage.getItem('altech_contacts');
            contacts = savedContacts ? JSON.parse(savedContacts) : [];
            
            // Load notes
            const savedNotes = localStorage.getItem('altech_notes');
            document.getElementById('notesTextarea').value = savedNotes || '';
            
            // Load reminders
            const savedReminders = localStorage.getItem('altech_reminders');
            reminders = savedReminders ? JSON.parse(savedReminders) : [];
            
            // Load history
            const savedHistory = localStorage.getItem('altech_history');
            commandHistory = savedHistory ? JSON.parse(savedHistory) : [];
            
            // Load AI count
            aiResponseCount = parseInt(localStorage.getItem('altech_ai_count') || '0');
            
            // Update displays
            updateContactsDisplay();
            updateNotesDisplay();
            updateRemindersDisplay();
            updateStats();
        }
        
        function saveContacts() {
            localStorage.setItem('altech_contacts', JSON.stringify(contacts));
            updateStats();
        }
        
        function saveNotes() {
            localStorage.setItem('altech_notes', document.getElementById('notesTextarea').value);
            updateStats();
        }
        
        function saveReminders() {
            localStorage.setItem('altech_reminders', JSON.stringify(reminders));
            updateStats();
        }
        
        function saveHistory() {
            localStorage.setItem('altech_history', JSON.stringify(commandHistory));
            localStorage.setItem('altech_ai_count', aiResponseCount.toString());
        }
        
        // ================ UTILITY FUNCTIONS ================
        
        function showToast(message, type = 'info') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.style.background = type === 'error' ? 'var(--danger)' : 
                                  type === 'success' ? 'var(--success)' : 'var(--dark)';
            toast.style.display = 'block';
            
            setTimeout(() => {
                toast.style.display = 'none';
            }, 3000);
        }
        
        function speakResponse(text) {
            if (!text) return;
            
            try {
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.rate = 1.0;
                utterance.pitch = 1.0;
                utterance.volume = 1.0;
                window.speechSynthesis.speak(utterance);
            } catch (error) {
                console.error('Speech synthesis error:', error);
            }
        }
        
        function setupAutoSave() {
            // Auto-save notes every 30 seconds
            setInterval(() => {
                if (document.getElementById('notesTextarea').value.trim()) {
                    saveNotes();
                }
            }, 30000);
            
            // Auto-save other data every minute
            setInterval(() => {
                saveContacts();
                saveReminders();
                saveHistory();
            }, 60000);
        }
        
        function setupReminderChecks() {
            // Check reminders every minute
            setInterval(() => {
                const now = new Date();
                reminders.forEach(reminder => {
                    if (reminder.active) {
                        const time = new Date(reminder.time);
                        const timeDiff = time - now;
                        
                        // Check if reminder is due (within 1 minute)
                        if (timeDiff > 0 && timeDiff < 60000) {
                            showToast(`‚è∞ Reminder: ${reminder.text}`, 'warning');
                            speakResponse(`Reminder: ${reminder.text}`);
                            reminder.active = false;
                            saveReminders();
                            updateRemindersDisplay();
                        }
                    }
                });
            }, 60000);
        }
        
        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            // Ctrl/Cmd + / to focus search
            if ((e.ctrlKey || e.metaKey) && e.key === '/') {
                e.preventDefault();
                openTab('search');
            }
            
            // Escape to close modals
            if (e.key === 'Escape') {
                closeModal('addContactModal');
            }
        });
        
        console.log('‚úÖ ALTECH AI Assistant fully loaded and ready!');
    </script>
</body>
</html>
